(()=>{"use strict";chrome.runtime.onInstalled.addListener(()=>{console.log("[Mobius OS] Extension installed");const e="mobius.allowedDomains";chrome.storage.local.get([e],o=>{const r=o[e],s=Array.isArray(r)?r:[],t=["localhost","127.0.0.1","example.com","google.com","www.google.com"],l=new Set(s.map(e=>String(e).toLowerCase()).filter(Boolean));for(const e of t)l.add(e);chrome.storage.local.set({[e]:Array.from(l).sort()},()=>{console.log("[Mobius OS] Ensured allowlist entries for testing:",t)})})});const e=["mobius.auth.refreshToken","mobius.auth.userProfile"];chrome.runtime.onMessage.addListener((o,r,s)=>{if(!o||!o.type)return!1;if("mobius:auth:getStorage"===o.type){const r=o.keys,t=r.filter(o=>!e.includes(o)),l=r.filter(o=>e.includes(o));return Promise.all([t.length>0?chrome.storage.session.get(t):Promise.resolve({}),l.length>0?chrome.storage.local.get(l):Promise.resolve({})]).then(([e,o])=>{s({ok:!0,data:{...e,...o}})}).catch(e=>{console.error("[Mobius Background] Storage get error:",e),s({ok:!1,error:String(e)})}),!0}if("mobius:auth:setStorage"===o.type){const r=o.items,t={},l={};for(const[o,s]of Object.entries(r))e.includes(o)?l[o]=s:t[o]=s;return Promise.all([Object.keys(t).length>0?chrome.storage.session.set(t):Promise.resolve(),Object.keys(l).length>0?chrome.storage.local.set(l):Promise.resolve()]).then(()=>{s({ok:!0})}).catch(e=>{console.error("[Mobius Background] Storage set error:",e),s({ok:!1,error:String(e)})}),!0}if("mobius:auth:clearStorage"===o.type){const r=o.keys;if(r){const o=r.filter(o=>!e.includes(o)),t=r.filter(o=>e.includes(o));Promise.all([o.length>0?chrome.storage.session.remove(o):Promise.resolve(),t.length>0?chrome.storage.local.remove(t):Promise.resolve()]).then(()=>{s({ok:!0})}).catch(e=>{console.error("[Mobius Background] Storage clear error:",e),s({ok:!1,error:String(e)})})}else Promise.all([chrome.storage.session.clear(),chrome.storage.local.remove(e)]).then(()=>{s({ok:!0})}).catch(e=>{console.error("[Mobius Background] Storage clear error:",e),s({ok:!1,error:String(e)})});return!0}return!1})})();
//# sourceMappingURL=background.js.map