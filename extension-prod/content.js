(()=>{"use strict";var n={56(n,e,o){n.exports=function(n){var e=o.nc;e&&n.setAttribute("nonce",e)}},72(n){var e=[];function o(n){for(var o=-1,t=0;t<e.length;t++)if(e[t].identifier===n){o=t;break}return o}function t(n,t){for(var s={},r=[],a=0;a<n.length;a++){var d=n[a],c=t.base?d[0]+t.base:d[0],l=s[c]||0,m="".concat(c," ").concat(l);s[c]=l+1;var b=o(m),u={css:d[1],media:d[2],sourceMap:d[3],supports:d[4],layer:d[5]};if(-1!==b)e[b].references++,e[b].updater(u);else{var p=i(u,t);t.byIndex=a,e.splice(a,0,{identifier:m,updater:p,references:1})}r.push(m)}return r}function i(n,e){var o=e.domAPI(e);return o.update(n),function(e){if(e){if(e.css===n.css&&e.media===n.media&&e.sourceMap===n.sourceMap&&e.supports===n.supports&&e.layer===n.layer)return;o.update(n=e)}else o.remove()}}n.exports=function(n,i){var s=t(n=n||[],i=i||{});return function(n){n=n||[];for(var r=0;r<s.length;r++){var a=o(s[r]);e[a].references--}for(var d=t(n,i),c=0;c<s.length;c++){var l=o(s[c]);0===e[l].references&&(e[l].updater(),e.splice(l,1))}s=d}}},113(n){n.exports=function(n,e){if(e.styleSheet)e.styleSheet.cssText=n;else{for(;e.firstChild;)e.removeChild(e.firstChild);e.appendChild(document.createTextNode(n))}}},314(n){n.exports=function(n){var e=[];return e.toString=function(){return this.map(function(e){var o="",t=void 0!==e[5];return e[4]&&(o+="@supports (".concat(e[4],") {")),e[2]&&(o+="@media ".concat(e[2]," {")),t&&(o+="@layer".concat(e[5].length>0?" ".concat(e[5]):""," {")),o+=n(e),t&&(o+="}"),e[2]&&(o+="}"),e[4]&&(o+="}"),o}).join("")},e.i=function(n,o,t,i,s){"string"==typeof n&&(n=[[null,n,void 0]]);var r={};if(t)for(var a=0;a<this.length;a++){var d=this[a][0];null!=d&&(r[d]=!0)}for(var c=0;c<n.length;c++){var l=[].concat(n[c]);t&&r[l[0]]||(void 0!==s&&(void 0===l[5]||(l[1]="@layer".concat(l[5].length>0?" ".concat(l[5]):""," {").concat(l[1],"}")),l[5]=s),o&&(l[2]?(l[1]="@media ".concat(l[2]," {").concat(l[1],"}"),l[2]=o):l[2]=o),i&&(l[4]?(l[1]="@supports (".concat(l[4],") {").concat(l[1],"}"),l[4]=i):l[4]="".concat(i)),e.push(l))}},e}},340(n,e,o){o.d(e,{A:()=>a});var t=o(601),i=o.n(t),s=o(314),r=o.n(s)()(i());r.push([n.id,"/**\n * Sidebar-only styles for Mobius OS (content script injection)\n * IMPORTANT: Must not style host page elements like html/body.\n * Everything is scoped under #mobius-os-sidebar to avoid collisions.\n */\n\n#mobius-os-sidebar,\n#mobius-os-sidebar * {\n  box-sizing: border-box;\n}\n\n#mobius-os-sidebar {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Google Sans', sans-serif;\n  background: var(--mobius-bg-primary, #ffffff);\n  color: var(--mobius-text-primary, #0b1220);\n  font-size: var(--mobius-font-base, 12px);\n  font-weight: 400;\n}\n\n/* Subtle, modern look - matching Mini */\n#mobius-os-sidebar {\n  border-left: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  box-shadow: -4px 0 24px var(--mobius-shadow, rgba(2, 6, 23, 0.08));\n}\n\n#mobius-os-sidebar button,\n#mobius-os-sidebar input,\n#mobius-os-sidebar select {\n  font: inherit;\n}\n\n#mobius-os-sidebar button {\n  cursor: pointer;\n}\n\n#mobius-os-sidebar .top-row,\n#mobius-os-sidebar .second-row,\n#mobius-os-sidebar .tasks-panel,\n#mobius-os-sidebar .chat-input-area,\n#mobius-os-sidebar .record-id-input,\n#mobius-os-sidebar .workflow-buttons,\n#mobius-os-sidebar .footer {\n  padding-left: var(--mobius-space-md, 14px);\n  padding-right: var(--mobius-space-md, 14px);\n}\n\n/* Top Row / Header */\n#mobius-os-sidebar .top-row {\n  display: flex;\n  align-items: center;\n  justify-content: flex-start;\n  gap: var(--mobius-space-sm, 8px);\n  padding-top: var(--mobius-space-sm, 8px);\n  padding-bottom: var(--mobius-space-sm, 10px);\n  border-bottom: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.12));\n  background: var(--mobius-bg-primary, white);\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .header-actions {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 8px);\n  margin-left: auto;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .header-left {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-md, 12px);\n  flex: 0 1 auto;\n  min-width: 0;\n}\n\n#mobius-os-sidebar .client-logo {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  font-size: var(--mobius-font-sm, 11px);\n  color: var(--mobius-text-secondary, #5f6368);\n  min-width: 100px;\n}\n\n#mobius-os-sidebar .client-logo img {\n  width: 24px;\n  height: 24px;\n  border-radius: 4px;\n}\n\n#mobius-os-sidebar .client-logo-svg {\n  width: 24px;\n  height: 24px;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .client-logo-svg svg {\n  width: 100%;\n  height: 100%;\n  display: block;\n}\n\n#mobius-os-sidebar .client-logo-placeholder {\n  width: 24px;\n  height: 24px;\n  background: var(--mobius-bg-tertiary, #e8eaed);\n  border-radius: var(--mobius-radius-sm, 4px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: var(--mobius-font-sm, 10px);\n  color: var(--mobius-text-secondary, #5f6368);\n}\n\n#mobius-os-sidebar .client-name {\n  font-weight: 400;\n  color: var(--mobius-text-primary, #202124);\n}\n\n#mobius-os-sidebar .logo-section {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 8px);\n  flex-wrap: nowrap;\n  min-width: 0;\n}\n\n#mobius-os-sidebar .mobius-logo {\n  width: 32px;\n  height: 32px;\n  position: relative;\n}\n\n#mobius-os-sidebar .mobius-logo svg {\n  width: 100%;\n  height: 100%;\n}\n\n#mobius-os-sidebar .mobius-logo .path-normal {\n  display: none;\n}\n\n#mobius-os-sidebar .mobius-logo .path-processing {\n  display: block;\n}\n\n#mobius-os-sidebar .mobius-logo:not(.status-processing) .path-normal {\n  display: block;\n}\n\n#mobius-os-sidebar .mobius-logo:not(.status-processing) .path-processing {\n  display: none;\n}\n\n#mobius-os-sidebar .logo-label {\n  font-weight: 500;\n  font-size: var(--mobius-font-base, 12px);\n  color: var(--mobius-text-primary, #202124);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  max-width: 120px;\n}\n\n#mobius-os-sidebar .context-display {\n  flex: 1 1 auto;\n  margin: 0;\n  font-size: var(--mobius-font-sm, 11px);\n  color: var(--mobius-text-secondary, #5f6368);\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  justify-content: center;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-width: 0;\n}\n\n#mobius-os-sidebar .status-indicator {\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .status-proceed,\n#mobius-os-sidebar .status-green {\n  background: var(--mobius-success, #16a34a);\n  box-shadow: 0 0 4px color-mix(in srgb, var(--mobius-success, #16a34a) 60%, transparent);\n}\n\n#mobius-os-sidebar .status-pending,\n#mobius-os-sidebar .status-yellow {\n  background: var(--mobius-warning, #f59e0b);\n  box-shadow: 0 0 4px color-mix(in srgb, var(--mobius-warning, #f59e0b) 60%, transparent);\n}\n\n#mobius-os-sidebar .status-error,\n#mobius-os-sidebar .status-red {\n  background: var(--mobius-error, #dc2626);\n  box-shadow: 0 0 4px color-mix(in srgb, var(--mobius-error, #dc2626) 60%, transparent);\n}\n\n#mobius-os-sidebar .status-blue {\n  background: var(--mobius-accent, #2563eb);\n  box-shadow: 0 0 4px color-mix(in srgb, var(--mobius-accent, #2563eb) 60%, transparent);\n}\n\n#mobius-os-sidebar .status-grey {\n  background: var(--mobius-text-muted, #94a3b8);\n  box-shadow: 0 0 4px color-mix(in srgb, var(--mobius-text-muted, #94a3b8) 60%, transparent);\n}\n\n#mobius-os-sidebar .mode-badge {\n  display: inline-block;\n  padding: var(--mobius-space-xs, 3px) var(--mobius-space-sm, 8px);\n  background: color-mix(in srgb, var(--mobius-accent, #1a73e8) 10%, transparent);\n  color: var(--mobius-accent, #1a73e8);\n  border-radius: var(--mobius-radius-lg, 12px);\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 500;\n  margin-left: var(--mobius-space-sm, 8px);\n  text-transform: uppercase;\n}\n\n#mobius-os-sidebar .alert-btn,\n#mobius-os-sidebar .settings-btn {\n  width: 32px;\n  height: 32px;\n  border: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.18));\n  background: var(--mobius-bg-primary, white);\n  border-radius: var(--mobius-radius-sm, 6px);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n#mobius-os-sidebar .alert-btn {\n  font-size: var(--mobius-font-lg, 16px);\n  position: relative;\n  margin-right: var(--mobius-space-sm, 8px);\n}\n\n#mobius-os-sidebar .settings-btn {\n  font-size: var(--mobius-font-xl, 18px);\n}\n\n#mobius-os-sidebar .alert-btn:hover,\n#mobius-os-sidebar .settings-btn:hover {\n  background: var(--mobius-bg-hover, #f5f5f5);\n}\n\n/* Collapse button (added to header actions) */\n#mobius-os-sidebar .collapse-btn {\n  width: 32px;\n  height: 32px;\n  border: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.18));\n  background: var(--mobius-bg-primary, white);\n  border-radius: var(--mobius-radius-sm, 6px);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: var(--mobius-font-lg, 16px);\n  line-height: 1;\n}\n\n#mobius-os-sidebar .collapse-btn:hover {\n  background: var(--mobius-bg-hover, #f5f5f5);\n}\n\n/* Second Row */\n#mobius-os-sidebar .second-row {\n  padding-top: var(--mobius-space-sm, 10px);\n  padding-bottom: var(--mobius-space-sm, 10px);\n  border-bottom: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.12));\n  background: var(--mobius-bg-primary, white);\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .context-summary {\n  font-size: var(--mobius-font-base, 12px);\n  color: var(--mobius-text-primary, #202124);\n  margin-bottom: var(--mobius-space-sm, 6px);\n  line-height: 1.4;\n}\n\n#mobius-os-sidebar .quick-action-btn {\n  display: inline-block;\n  padding: var(--mobius-space-sm, 7px) var(--mobius-space-md, 12px);\n  background: var(--mobius-accent, #1a73e8);\n  color: var(--mobius-accent-text, white);\n  border-radius: var(--mobius-radius-base, 10px);\n  font-size: var(--mobius-font-base, 12px);\n  cursor: pointer;\n  border: none;\n}\n\n#mobius-os-sidebar .quick-action-btn:hover {\n  background: var(--mobius-accent-hover, #1565c0);\n}\n\n/* Tasks Panel */\n#mobius-os-sidebar .tasks-panel {\n  padding-top: var(--mobius-space-sm, 8px);\n  padding-bottom: var(--mobius-space-sm, 8px);\n  border-bottom: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.12));\n  background: var(--mobius-bg-primary, #fff);\n  max-height: 150px;\n  overflow-y: auto;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .tasks-panel-header {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  cursor: pointer;\n  font-size: var(--mobius-font-sm, 11px);\n  font-weight: 500;\n  color: var(--mobius-text-secondary, #5f6368);\n  margin-bottom: var(--mobius-space-sm, 6px);\n}\n\n#mobius-os-sidebar .tasks-panel-content {\n  display: none;\n}\n\n#mobius-os-sidebar .tasks-panel-content.show {\n  display: block;\n}\n\n#mobius-os-sidebar .task-item {\n  display: flex;\n  align-items: flex-start;\n  gap: var(--mobius-space-sm, 8px);\n  padding: var(--mobius-space-xs, 4px) 0;\n  font-size: var(--mobius-font-base, 12px);\n  color: var(--mobius-text-primary, #202124);\n}\n\n#mobius-os-sidebar .task-item.shared {\n  color: var(--mobius-accent, #1a73e8);\n}\n\n#mobius-os-sidebar .task-item.backend {\n  color: var(--mobius-text-secondary, #5f6368);\n  font-style: italic;\n}\n\n/* Chat Area */\n#mobius-os-sidebar .chat-area {\n  flex: 1;\n  overflow-y: auto;\n  padding: var(--mobius-space-sm, 10px) var(--mobius-space-md, 12px);\n  background: var(--mobius-bg-primary, #ffffff);\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-sm, 10px);\n  justify-content: flex-end;\n  min-height: 0;\n  flex-shrink: 1;\n}\n\n#mobius-os-sidebar .message {\n  max-width: 75%;\n  padding: var(--mobius-space-sm, 7px) var(--mobius-space-sm, 10px);\n  border-radius: var(--mobius-radius-base, 10px);\n  font-size: var(--mobius-font-sm, 11px);\n  line-height: 1.45;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n#mobius-os-sidebar .system-message {\n  /* Stretch to full width to avoid shrink-to-fit issues with inline-block bubble max-width. */\n  align-self: stretch;\n  width: 100%;\n  background: transparent;\n  border: none;\n  padding: 0;\n  max-width: 100%;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n#mobius-os-sidebar .message-content {\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n\n/* Compact assistant \"bubble\" */\n#mobius-os-sidebar .system-message .message-content {\n  margin-top: var(--mobius-space-xs, 4px);\n  display: inline-block;\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  border: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.10));\n  padding: var(--mobius-space-sm, 7px) var(--mobius-space-sm, 10px);\n  border-radius: var(--mobius-radius-base, 10px);\n  max-width: 92%;\n}\n\n/* Make tools unobtrusive (Mini-style) */\n#mobius-os-sidebar .system-message .message-header {\n  margin-bottom: var(--mobius-space-xs, 2px);\n}\n\n#mobius-os-sidebar .system-message .message-tools-btn {\n  width: 22px;\n  height: 22px;\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  border-radius: var(--mobius-radius-sm, 6px);\n  opacity: 0.0;\n  transition: opacity 0.12s ease, background 0.15s ease;\n}\n\n#mobius-os-sidebar .system-message:hover .message-tools-btn {\n  opacity: 0.85;\n}\n\n#mobius-os-sidebar .system-message .message-tools-btn:hover {\n  opacity: 1;\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n#mobius-os-sidebar .user-message {\n  align-self: flex-end;\n  background: var(--mobius-accent, #2563eb);\n  color: var(--mobius-accent-text, white);\n}\n\n/* Thinking (minimal, collapsible line) */\n#mobius-os-sidebar .thinking-line {\n  margin: 0 0 var(--mobius-space-sm, 6px) 0;\n  padding: 0;\n  border: none;\n  background: transparent;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.7));\n  font-size: var(--mobius-font-sm, 11px);\n}\n\n#mobius-os-sidebar .thinking-line summary {\n  list-style: none;\n  cursor: pointer;\n  user-select: none;\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  padding: 0;\n}\n\n#mobius-os-sidebar .thinking-line summary::-webkit-details-marker {\n  display: none;\n}\n\n#mobius-os-sidebar .thinking-line summary::after {\n  content: '▸';\n  margin-left: auto;\n  opacity: 0.7;\n}\n\n#mobius-os-sidebar .thinking-line[open] summary::after {\n  content: '▾';\n}\n\n#mobius-os-sidebar .thinking-body {\n  margin-top: var(--mobius-space-xs, 4px);\n  padding-left: var(--mobius-space-sm, 10px);\n  border-left: 2px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  white-space: pre-wrap;\n  word-break: break-word;\n}\n\n/* Chat Input */\n#mobius-os-sidebar .chat-input-area {\n  padding-top: var(--mobius-space-sm, 8px);\n  padding-bottom: var(--mobius-space-sm, 8px);\n  border-top: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  background: var(--mobius-bg-primary, white);\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 8px);\n  flex-shrink: 0;\n  width: 100%;\n}\n\n#mobius-os-sidebar .chat-input {\n  flex: 1;\n  width: 100%;\n  min-width: 0;\n  padding: var(--mobius-space-sm, 8px) var(--mobius-space-md, 12px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  border-radius: var(--mobius-radius-base, 10px);\n  font-size: var(--mobius-font-sm, 11px);\n  outline: none;\n  background: var(--mobius-bg-primary, #fff);\n  resize: none;\n  overflow: hidden;\n  line-height: 1.4;\n  -webkit-appearance: none;\n  appearance: none;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n#mobius-os-sidebar .chat-input::placeholder {\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.7));\n}\n\n#mobius-os-sidebar .chat-input:focus {\n  border-color: var(--mobius-accent, #2563eb);\n}\n\n/* Message-level tools (system messages) */\n#mobius-os-sidebar .message-header {\n  display: flex;\n  justify-content: flex-end;\n  margin-bottom: var(--mobius-space-sm, 6px);\n}\n\n#mobius-os-sidebar .message-tools {\n  position: relative;\n}\n\n#mobius-os-sidebar .message-tools-btn {\n  width: 22px;\n  height: 22px;\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  border-radius: var(--mobius-radius-sm, 6px);\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0;\n  line-height: 1;\n}\n\n#mobius-os-sidebar .message-tools-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n#mobius-os-sidebar .message-tools-dropdown {\n  position: absolute;\n  top: 100%;\n  right: 0;\n  margin-top: var(--mobius-space-sm, 6px);\n  background: var(--mobius-bg-primary, #fff);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  border-radius: var(--mobius-radius-lg, 12px);\n  box-shadow: 0 14px 28px var(--mobius-shadow-strong, rgba(2, 6, 23, 0.18));\n  display: none;\n  flex-direction: column;\n  min-width: 140px;\n  z-index: 2;\n}\n\n#mobius-os-sidebar .message-tools-dropdown.show {\n  display: flex;\n}\n\n#mobius-os-sidebar .message-tools-item {\n  padding: var(--mobius-space-sm, 10px) var(--mobius-space-md, 12px);\n  border: none;\n  background: var(--mobius-bg-primary, white);\n  text-align: left;\n  font-size: var(--mobius-font-base, 12px);\n  font-weight: 500;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n#mobius-os-sidebar .message-tools-item:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.04));\n}\n\n/* Chat tools (make compact, not stacked) */\n#mobius-os-sidebar .chat-tools {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n}\n\n#mobius-os-sidebar .chat-tool-btn {\n  width: 22px;\n  height: 22px;\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  border-radius: var(--mobius-radius-sm, 6px);\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0;\n}\n\n#mobius-os-sidebar .chat-tool-btn:hover {\n  background: var(--mobius-bg-hover, rgba(60, 64, 67, 0.06));\n}\n\n#mobius-os-sidebar .tools-menu {\n  position: relative;\n}\n\n#mobius-os-sidebar .tools-dropdown {\n  position: absolute;\n  bottom: 100%;\n  right: 0;\n  margin-bottom: var(--mobius-space-sm, 6px);\n  background: var(--mobius-bg-primary, white);\n  border: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.18));\n  border-radius: var(--mobius-radius-base, 10px);\n  box-shadow: 0 10px 24px var(--mobius-shadow-strong, rgba(0,0,0,0.10));\n  display: none;\n  flex-direction: column;\n  min-width: 140px;\n  z-index: 2;\n}\n\n#mobius-os-sidebar .tools-dropdown.show {\n  display: flex;\n}\n\n#mobius-os-sidebar .tools-dropdown button {\n  padding: var(--mobius-space-sm, 10px) var(--mobius-space-md, 12px);\n  border: none;\n  background: var(--mobius-bg-primary, white);\n  text-align: left;\n  font-size: var(--mobius-font-base, 12px);\n}\n\n#mobius-os-sidebar .tools-dropdown button:hover {\n  background: var(--mobius-bg-hover, rgba(60, 64, 67, 0.06));\n}\n\n/* Record ID Input */\n#mobius-os-sidebar .record-id-input {\n  padding-top: var(--mobius-space-sm, 8px);\n  padding-bottom: var(--mobius-space-sm, 8px);\n  border-top: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.12));\n  background: var(--mobius-bg-primary, white);\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 8px);\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .record-id-input label {\n  font-size: var(--mobius-font-sm, 11px);\n  color: var(--mobius-text-secondary, #5f6368);\n  font-weight: 500;\n  white-space: nowrap;\n}\n\n#mobius-os-sidebar .record-id-input select {\n  padding: var(--mobius-space-sm, 6px) var(--mobius-space-sm, 8px);\n  border: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.18));\n  border-radius: var(--mobius-radius-sm, 8px);\n  font-size: var(--mobius-font-base, 12px);\n  background: var(--mobius-bg-primary, #fff);\n}\n\n#mobius-os-sidebar .record-id-input input {\n  flex: 1;\n  padding: var(--mobius-space-sm, 7px) var(--mobius-space-sm, 10px);\n  border: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.18));\n  border-radius: var(--mobius-radius-sm, 8px);\n  font-size: var(--mobius-font-base, 12px);\n  outline: none;\n}\n\n/* Workflow Buttons */\n#mobius-os-sidebar .workflow-buttons {\n  padding-top: var(--mobius-space-sm, 8px);\n  padding-bottom: var(--mobius-space-sm, 8px);\n  border-top: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.12));\n  background: var(--mobius-bg-primary, #fff);\n  display: flex;\n  gap: var(--mobius-space-sm, 8px);\n  flex-wrap: wrap;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .context-button {\n  padding: var(--mobius-space-sm, 8px) var(--mobius-space-sm, 10px);\n  background: var(--mobius-bg-tertiary, rgba(60, 64, 67, 0.06));\n  border: 1px solid var(--mobius-border-light, rgba(60, 64, 67, 0.10));\n  border-radius: var(--mobius-radius-base, 10px);\n  font-size: var(--mobius-font-base, 12px);\n}\n\n#mobius-os-sidebar .context-button:hover {\n  background: var(--mobius-bg-hover, rgba(60, 64, 67, 0.10));\n}\n\n/* Footer */\n#mobius-os-sidebar .footer {\n  padding-top: var(--mobius-space-sm, 10px);\n  padding-bottom: var(--mobius-space-sm, 10px);\n  border-top: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.12));\n  background: var(--mobius-bg-primary, #fff);\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .user-details {\n  display: flex;\n  justify-content: space-between;\n  align-items: center;\n  gap: var(--mobius-space-sm, 10px);\n  flex-wrap: nowrap;\n}\n\n#mobius-os-sidebar .user-info {\n  font-size: var(--mobius-font-base, 12px);\n  color: var(--mobius-text-secondary, #5f6368);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-width: 0;\n}\n\n#mobius-os-sidebar .preferences {\n  display: flex;\n  gap: var(--mobius-space-sm, 10px);\n  font-size: var(--mobius-font-sm, 11px);\n  align-items: center;\n  white-space: nowrap;\n}\n\n#mobius-os-sidebar .preferences-panel {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-end;\n  min-width: 0;\n}\n\n#mobius-os-sidebar .preferences-expanded {\n  display: none;\n  margin-top: var(--mobius-space-sm, 6px);\n}\n\n#mobius-os-sidebar .preferences-expanded.show {\n  display: block;\n}\n\n#mobius-os-sidebar .preference-group {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 8px);\n  justify-content: flex-end;\n  margin-bottom: var(--mobius-space-sm, 6px);\n}\n\n#mobius-os-sidebar .preference-group label {\n  font-size: var(--mobius-font-sm, 11px);\n  color: var(--mobius-text-secondary, #5f6368);\n  white-space: nowrap;\n}\n\n#mobius-os-sidebar .preference-group select {\n  padding: var(--mobius-space-sm, 6px) var(--mobius-space-sm, 8px);\n  border: 1px solid var(--mobius-border, rgba(60, 64, 67, 0.18));\n  border-radius: var(--mobius-radius-sm, 8px);\n  font-size: var(--mobius-font-base, 12px);\n  background: var(--mobius-bg-primary, #fff);\n}\n\n#mobius-os-sidebar .preference-item {\n  display: inline-flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  padding: var(--mobius-space-xs, 3px) var(--mobius-space-sm, 6px);\n  border-radius: var(--mobius-radius-sm, 8px);\n}\n\n#mobius-os-sidebar .preference-item:hover {\n  background: var(--mobius-bg-hover, rgba(60, 64, 67, 0.06));\n}\n\n#mobius-os-sidebar .pref-value {\n  color: var(--mobius-accent, #1a73e8);\n  font-weight: 500;\n  font-size: var(--mobius-font-sm, 11px);\n}\n\n/* Guidance / Follow-up actions (system message CTA buttons) */\n#mobius-os-sidebar .guidance-actions {\n  margin-top: var(--mobius-space-sm, 8px);\n  padding: var(--mobius-space-sm, 6px) var(--mobius-space-sm, 8px);\n  display: flex;\n  gap: var(--mobius-space-sm, 6px);\n  flex-wrap: wrap;\n  align-items: center;\n  border-radius: var(--mobius-radius-base, 10px);\n  border: 1px solid color-mix(in srgb, var(--mobius-accent, #1a73e8) 18%, transparent);\n  background: color-mix(in srgb, var(--mobius-accent, #1a73e8) 6%, transparent);\n}\n\n#mobius-os-sidebar .guidance-action-btn {\n  appearance: none;\n  border: 1px solid color-mix(in srgb, var(--mobius-accent, #1a73e8) 28%, transparent);\n  background: color-mix(in srgb, var(--mobius-accent, #1a73e8) 10%, transparent);\n  color: var(--mobius-accent, #174ea6);\n  padding: var(--mobius-space-xs, 5px) var(--mobius-space-sm, 10px);\n  border-radius: 999px;\n  font-size: var(--mobius-font-base, 12px);\n  line-height: 1.2;\n}\n\n#mobius-os-sidebar .guidance-action-btn:hover {\n  background: color-mix(in srgb, var(--mobius-accent, #1a73e8) 16%, transparent);\n  border-color: color-mix(in srgb, var(--mobius-accent, #1a73e8) 38%, transparent);\n}\n\n/**\n * Mini widget styles (scoped; does not affect host page nor #mobius-os-sidebar).\n */\n#mobius-os-mini,\n#mobius-os-mini * {\n  box-sizing: border-box;\n}\n\n#mobius-os-mini {\n  position: fixed !important;\n  z-index: 2147483646 !important;\n  width: 300px;\n  background: var(--mobius-bg-primary, #ffffff) !important;\n  color: var(--mobius-text-primary, #0b1220) !important;\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12)) !important;\n  border-radius: var(--mobius-radius-lg, 14px) !important;\n  box-shadow: 0 16px 34px var(--mobius-shadow-strong, rgba(2, 6, 23, 0.14)) !important;\n  overflow: hidden !important;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Google Sans', sans-serif !important;\n  font-size: var(--mobius-font-base, 12px) !important;\n  font-weight: 400 !important;\n  user-select: none !important;\n}\n\n#mobius-os-mini button,\n#mobius-os-mini input {\n  font: inherit;\n}\n\n#mobius-os-mini .mobius-mini-header {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  padding: var(--mobius-space-xs, 5px) var(--mobius-space-sm, 8px);\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  background: var(--mobius-bg-secondary, rgba(11, 18, 32, 0.02));\n  cursor: grab;\n  touch-action: none;\n}\n\n#mobius-os-mini .mobius-mini-drag-handle {\n  width: 20px;\n  height: 20px;\n  border-radius: var(--mobius-radius-sm, 6px);\n  border: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.10));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  display: grid;\n  place-items: center;\n  cursor: grab;\n  flex: 0 0 auto;\n  touch-action: none;\n}\n\n#mobius-os-mini .mobius-mini-drag-handle:active {\n  cursor: grabbing;\n}\n\n#mobius-os-mini .mobius-mini-drag-dots {\n  width: 8px;\n  height: 14px;\n  background:\n    radial-gradient(circle, rgba(11,18,32,0.35) 1.5px, transparent 2px) 0 0/5px 5px;\n  border-radius: 4px;\n}\n\n#mobius-os-mini .mobius-mini-brand {\n  display: inline-flex;\n  align-items: center;\n  gap: 5px;\n  min-width: 0;\n  flex: 1 1 auto;\n}\n\n#mobius-os-mini .mobius-mini-brand .mobius-logo {\n  width: 18px;\n  height: 18px;\n}\n\n/* Client logo in Mini widget */\n#mobius-os-mini .client-logo {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  flex-shrink: 0;\n}\n\n#mobius-os-mini .client-logo.client-logo-compact {\n  gap: 0;\n}\n\n#mobius-os-mini .client-logo img {\n  width: 18px;\n  height: 18px;\n  border-radius: 3px;\n}\n\n#mobius-os-mini .client-logo-svg {\n  width: 18px;\n  height: 18px;\n  flex-shrink: 0;\n}\n\n#mobius-os-mini .client-logo-svg svg {\n  width: 100%;\n  height: 100%;\n  display: block;\n}\n\n#mobius-os-mini .client-logo-placeholder {\n  width: 18px;\n  height: 18px;\n  background: var(--mobius-bg-tertiary, #e8eaed);\n  border-radius: var(--mobius-radius-sm, 3px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: var(--mobius-font-xs, 8px);\n  color: var(--mobius-text-secondary, #5f6368);\n  font-weight: 500;\n}\n\n#mobius-os-mini .client-name {\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-secondary, #5f6368);\n  white-space: nowrap;\n}\n\n/* Divider between client logo and Mobius brand */\n#mobius-os-mini .mobius-mini-brand-divider {\n  width: 1px;\n  height: 14px;\n  background: var(--mobius-border, rgba(11, 18, 32, 0.12));\n  margin: 0 2px;\n}\n\n#mobius-os-mini .mobius-logo {\n  width: 18px;\n  height: 18px;\n  position: relative;\n}\n\n#mobius-os-mini .mobius-logo svg {\n  width: 100%;\n  height: 100%;\n}\n\n/* Match sidebar/popup behavior: show only one path depending on status */\n#mobius-os-mini .mobius-logo .path-normal {\n  display: none;\n}\n\n#mobius-os-mini .mobius-logo .path-processing {\n  display: block;\n}\n\n#mobius-os-mini .mobius-logo:not(.status-processing) .path-normal {\n  display: block;\n}\n\n#mobius-os-mini .mobius-logo:not(.status-processing) .path-processing {\n  display: none;\n}\n\n#mobius-os-mini .mobius-mini-brand-text {\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 500;\n  color: var(--mobius-text-primary, #0b1220);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n#mobius-os-mini .mobius-mini-menu-btn {\n  width: 22px;\n  height: 22px;\n  border-radius: var(--mobius-radius-sm, 6px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n  font-weight: 400;\n  font-size: var(--mobius-font-sm, 10px);\n}\n\n#mobius-os-mini .mobius-mini-expand-btn {\n  width: 22px;\n  height: 22px;\n  border-radius: var(--mobius-radius-sm, 6px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n  font-weight: 400;\n  font-size: var(--mobius-font-base, 12px);\n  line-height: 1;\n}\n\n#mobius-os-mini .mobius-mini-expand-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n#mobius-os-mini .mobius-mini-minimize-btn {\n  width: 22px;\n  height: 22px;\n  border-radius: var(--mobius-radius-sm, 6px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n  font-weight: 400;\n  font-size: var(--mobius-font-md, 14px);\n  line-height: 1;\n  color: var(--mobius-text-secondary, #374151);\n}\n\n#mobius-os-mini .mobius-mini-minimize-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n#mobius-os-mini .mobius-mini-menu-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n/* Minimized state - compact pill */\n#mobius-os-mini.mobius-mini-minimized {\n  width: auto !important;\n  min-width: unset !important;\n  max-width: unset !important;\n  padding: 0 !important;\n  border-radius: 20px !important;\n}\n\n#mobius-os-mini.mobius-mini-minimized .mobius-mini-header {\n  padding: 6px 10px;\n  gap: 8px;\n}\n\n#mobius-os-mini.mobius-mini-minimized .mobius-mini-brand {\n  display: none;\n}\n\n#mobius-os-mini.mobius-mini-minimized .mobius-mini-expand-btn,\n#mobius-os-mini.mobius-mini-minimized .mobius-mini-menu-btn {\n  display: none;\n}\n\n#mobius-os-mini.mobius-mini-minimized .mobius-mini-row,\n#mobius-os-mini.mobius-mini-minimized .mobius-mini-attention-row,\n#mobius-os-mini.mobius-mini-minimized .mobius-mini-task-badge-row,\n#mobius-os-mini.mobius-mini-minimized .mobius-mini-note-row {\n  display: none !important;\n}\n\n/* Minimized info - patient name + attention dot (hidden by default) */\n#mobius-os-mini .mobius-mini-minimized-info {\n  display: none;\n  align-items: center;\n  gap: 6px;\n  max-width: 140px;\n}\n\n#mobius-os-mini .mobius-mini-minimized-patient {\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 400;\n  color: var(--mobius-text-secondary, #374151);\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* Show minimized info only when minimized */\n#mobius-os-mini.mobius-mini-minimized .mobius-mini-minimized-info {\n  display: flex;\n}\n\n#mobius-os-mini .mobius-mini-menu {\n  position: absolute;\n  top: 42px;\n  right: 10px;\n  background: var(--mobius-bg-primary, #fff);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  border-radius: var(--mobius-radius-lg, 12px);\n  box-shadow: 0 14px 28px var(--mobius-shadow-strong, rgba(2,6,23,0.18));\n  overflow: visible;\n  z-index: 2147483647;\n  min-width: 140px;\n  pointer-events: auto !important;\n}\n\n#mobius-os-mini .mobius-mini-menu-item {\n  display: block;\n  width: 100%;\n  text-align: left;\n  padding: var(--mobius-space-sm, 10px) var(--mobius-space-md, 12px);\n  border: none;\n  background: var(--mobius-bg-primary, #fff);\n  font-size: var(--mobius-font-base, 12px);\n  font-weight: 400;\n  cursor: pointer;\n  pointer-events: auto !important;\n}\n\n#mobius-os-mini .mobius-mini-menu-item:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.04));\n}\n\n#mobius-os-mini .mobius-mini-menu-item.danger {\n  color: var(--mobius-error, #b3261e);\n}\n\n/* Theme submenu */\n#mobius-os-mini .mobius-mini-theme-trigger {\n  display: flex;\n  align-items: center;\n  cursor: pointer;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n#mobius-os-mini .mobius-mini-theme-trigger:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.04));\n}\n\n#mobius-os-mini .mobius-mini-theme-submenu {\n  background: var(--mobius-bg-secondary, #f8fafc);\n  border-top: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  margin: 0;\n  padding: 0;\n}\n\n#mobius-os-mini .mobius-mini-theme-submenu .mobius-mini-menu-item {\n  padding: var(--mobius-space-sm, 8px) var(--mobius-space-md, 12px) var(--mobius-space-sm, 8px) var(--mobius-space-lg, 16px);\n  font-size: var(--mobius-font-sm, 11px);\n  background: var(--mobius-bg-secondary, #f8fafc);\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n#mobius-os-mini .mobius-mini-theme-submenu .mobius-mini-menu-item:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.08));\n}\n\n#mobius-os-mini .mobius-mini-row {\n  padding: var(--mobius-space-sm, 6px) var(--mobius-space-sm, 10px);\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 8px);\n}\n\n#mobius-os-mini .mobius-mini-row:last-child {\n  border-bottom: none;\n}\n\n#mobius-os-mini .mobius-mini-row-label {\n  width: 48px;\n  flex: 0 0 auto;\n  font-size: var(--mobius-font-xs, 9px);\n  letter-spacing: 0.04em;\n  text-transform: uppercase;\n  color: var(--mobius-text-muted, rgba(91,102,122,0.95));\n  font-weight: 500;\n}\n\n#mobius-os-mini .mobius-mini-row-body {\n  min-width: 0;\n  flex: 1 1 auto;\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-xs, 2px);\n}\n\n#mobius-os-mini .mobius-mini-patient-name {\n  font-size: var(--mobius-font-sm, 11px);\n  font-weight: 500;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n#mobius-os-mini .mobius-mini-patient-id {\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91,102,122,0.95));\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n#mobius-os-mini .mobius-mini-patient-dob {\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91,102,122,0.95));\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n#mobius-os-mini .mobius-mini-inline-btn {\n  height: var(--mobius-button-height, 28px);\n  border-radius: var(--mobius-radius-base, 10px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  font-weight: 500;\n  font-size: var(--mobius-font-sm, 11px);\n  padding: 0 var(--mobius-space-sm, 10px);\n}\n\n#mobius-os-mini .mobius-mini-inline-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n/* Icon-only button (e.g., edit patient) */\n#mobius-os-mini .mobius-mini-icon-btn {\n  width: var(--mobius-button-height, 28px);\n  height: var(--mobius-button-height, 28px);\n  border-radius: var(--mobius-radius-base, 10px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n  padding: 0;\n}\n\n#mobius-os-mini .mobius-mini-icon-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n#mobius-os-mini .mobius-mini-icon-btn svg {\n  width: var(--mobius-icon-base, 16px);\n  height: var(--mobius-icon-base, 16px);\n  fill: var(--mobius-text-secondary, rgba(11, 18, 32, 0.80));\n}\n\n#mobius-os-mini .mobius-mini-status {\n  width: 100%;\n  border: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.10));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  border-radius: var(--mobius-radius-base, 10px);\n  padding: var(--mobius-space-xs, 5px) var(--mobius-space-sm, 8px);\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 500;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n#mobius-os-mini .mobius-mini-status:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n#mobius-os-mini .mobius-mini-dot {\n  width: 8px;\n  height: 8px;\n  border-radius: 999px;\n  flex: 0 0 auto;\n  box-shadow: 0 0 0 3px var(--mobius-shadow, rgba(148, 163, 184, 0.18));\n  background: var(--mobius-text-muted, #94a3b8);\n}\n\n#mobius-os-mini .dot-green {\n  background: var(--mobius-success, #16a34a);\n  box-shadow: 0 0 0 3px color-mix(in srgb, var(--mobius-success, #16a34a) 14%, transparent);\n}\n\n#mobius-os-mini .dot-yellow {\n  background: var(--mobius-warning, #f59e0b);\n  box-shadow: 0 0 0 3px color-mix(in srgb, var(--mobius-warning, #f59e0b) 18%, transparent);\n}\n\n#mobius-os-mini .dot-blue {\n  background: var(--mobius-accent, #2563eb);\n  box-shadow: 0 0 0 3px color-mix(in srgb, var(--mobius-accent, #2563eb) 16%, transparent);\n}\n\n#mobius-os-mini .dot-grey {\n  background: var(--mobius-text-muted, #94a3b8);\n  box-shadow: 0 0 0 3px color-mix(in srgb, var(--mobius-text-muted, #94a3b8) 18%, transparent);\n}\n\n#mobius-os-mini .dot-red {\n  background: var(--mobius-error, #dc2626);\n  box-shadow: 0 0 0 3px color-mix(in srgb, var(--mobius-error, #dc2626) 18%, transparent);\n}\n\n#mobius-os-mini .dot-purple {\n  background: var(--mobius-info, #9333ea);\n  box-shadow: 0 0 0 3px color-mix(in srgb, var(--mobius-info, #9333ea) 18%, transparent);\n}\n\n#mobius-os-mini .mobius-mini-status-text {\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  min-width: 0;\n  flex: 1;\n}\n\n/* Needs Attention row - refined spacing */\n#mobius-os-mini .mobius-mini-attention-row {\n  padding: var(--mobius-space-sm, 10px);\n  gap: var(--mobius-space-sm, 10px);\n}\n\n#mobius-os-mini .mobius-mini-attention-row .mobius-mini-row-label {\n  width: 48px;\n  font-size: var(--mobius-font-xs, 9px);\n  line-height: 1.2;\n  flex-shrink: 0;\n}\n\n#mobius-os-mini .mobius-mini-attention-content {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 8px);\n  flex-wrap: wrap;\n}\n\n#mobius-os-mini .mobius-mini-question-text {\n  flex: 1;\n  font-size: var(--mobius-font-sm, 11px);\n  color: var(--mobius-text-primary, #1e293b);\n  line-height: 1.3;\n  min-width: 100px;\n}\n\n#mobius-os-mini .mobius-mini-attention-content {\n  flex: 1;\n  display: flex;\n  align-items: flex-start;\n  gap: var(--mobius-space-sm, 8px);\n  min-width: 0;\n}\n\n#mobius-os-mini .mobius-mini-attention-content .mobius-mini-dot {\n  margin-top: 4px;\n  margin-left: 2px;\n  flex-shrink: 0;\n}\n\n#mobius-os-mini .mobius-mini-problem-text {\n  flex: 1;\n  white-space: normal;\n  word-wrap: break-word;\n  text-align: left;\n  min-width: 0;\n  font-size: var(--mobius-font-xs, 9px);\n  line-height: 1.35;\n  color: var(--mobius-text-primary, #0b1220);\n  padding-right: var(--mobius-space-sm, 6px);\n}\n\n/* Status badge - clickable */\n#mobius-os-mini .mobius-mini-status-badge {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-xs, 4px);\n  padding: var(--mobius-space-xs, 3px) var(--mobius-space-sm, 8px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.15));\n  border-radius: var(--mobius-radius-sm, 4px);\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.04));\n  cursor: pointer;\n  flex-shrink: 0;\n  font-size: var(--mobius-font-xs, 8px);\n  font-weight: 400;\n  color: var(--mobius-text-secondary, #64748b);\n  margin-left: var(--mobius-space-xs, 4px);\n}\n\n#mobius-os-mini .mobius-mini-status-badge:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.08));\n}\n\n#mobius-os-mini .mobius-mini-status-badge.status-resolved {\n  background: color-mix(in srgb, var(--mobius-success, #16a34a) 10%, transparent);\n  border-color: color-mix(in srgb, var(--mobius-success, #16a34a) 30%, transparent);\n  color: var(--mobius-success, #16a34a);\n}\n\n#mobius-os-mini .mobius-mini-status-badge.status-unresolved {\n  background: color-mix(in srgb, var(--mobius-warning, #f59e0b) 10%, transparent);\n  border-color: color-mix(in srgb, var(--mobius-warning, #f59e0b) 30%, transparent);\n  color: var(--mobius-warning, #d97706);\n}\n\n#mobius-os-mini .mobius-mini-status-badge.status-unconfirmed {\n  background: color-mix(in srgb, var(--mobius-text-muted, #94a3b8) 15%, transparent);\n  border-color: color-mix(in srgb, var(--mobius-text-muted, #94a3b8) 40%, transparent);\n  color: var(--mobius-text-secondary, #64748b);\n}\n\n#mobius-os-mini .mobius-mini-dropdown-icon {\n  font-size: var(--mobius-font-xs, 6px);\n  color: inherit;\n  opacity: 0.7;\n}\n\n/* Task badge row - compact */\n#mobius-os-mini .mobius-mini-task-badge-row {\n  padding: var(--mobius-space-sm, 6px) var(--mobius-space-sm, 10px);\n}\n\n#mobius-os-mini .mobius-mini-task-badge-row .mobius-mini-row-label {\n  width: 48px;\n  font-size: var(--mobius-font-xs, 9px);\n  line-height: 1.2;\n}\n\n#mobius-os-mini .mobius-mini-task-badge {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-xs, 4px);\n  padding: var(--mobius-space-xs, 4px) var(--mobius-space-sm, 8px);\n  border: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.10));\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 6%, transparent);\n  border-radius: var(--mobius-radius-sm, 8px);\n  cursor: pointer;\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-accent, #2563eb);\n}\n\n#mobius-os-mini .mobius-mini-task-badge:hover {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 12%, transparent);\n}\n\n#mobius-os-mini .mobius-mini-task-count {\n  font-weight: 500;\n}\n\n/* Answer dropdown styling */\n.mobius-mini-answer-dropdown {\n  background: var(--mobius-bg-primary, white) !important;\n  border-radius: var(--mobius-radius-base, 6px) !important;\n  box-shadow: 0 4px 16px var(--mobius-shadow-strong, rgba(0, 0, 0, 0.12)) !important;\n  padding: var(--mobius-space-xs, 4px) 0 !important;\n  min-width: 160px !important;\n  display: flex !important;\n  flex-direction: column !important;\n}\n\n.mobius-mini-answer-dropdown .mobius-mini-dropdown-item {\n  display: block !important;\n  width: 100% !important;\n  padding: var(--mobius-space-sm, 8px) var(--mobius-space-md, 12px) !important;\n  font-size: var(--mobius-font-sm, 10px) !important;\n  text-align: left !important;\n  background: transparent !important;\n  border: none !important;\n  cursor: pointer !important;\n  color: var(--mobius-text-primary, #1e293b) !important;\n  line-height: 1.3 !important;\n}\n\n.mobius-mini-answer-dropdown .mobius-mini-dropdown-item:hover {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 8%, transparent) !important;\n}\n\n#mobius-os-mini .mobius-mini-step-question {\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 400;\n  color: var(--mobius-text-primary, #1e293b);\n  line-height: 1.3;\n}\n\n#mobius-os-mini .mobius-mini-step-buttons {\n  display: flex;\n  flex-wrap: wrap;\n  gap: var(--mobius-space-xs, 4px);\n}\n\n#mobius-os-mini .mobius-mini-quick-answer-btn {\n  padding: var(--mobius-space-xs, 4px) var(--mobius-space-sm, 8px);\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  border: 1px solid color-mix(in srgb, var(--mobius-accent, #2563eb) 20%, transparent);\n  background: var(--mobius-bg-primary, white);\n  color: var(--mobius-accent, #2563eb);\n  border-radius: var(--mobius-radius-lg, 12px);\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n#mobius-os-mini .mobius-mini-quick-answer-btn:hover {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 8%, transparent);\n  border-color: var(--mobius-accent, #2563eb);\n}\n\n#mobius-os-mini .mobius-mini-quick-answer-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n#mobius-os-mini .mobius-mini-quick-answer-btn.suggested {\n  background: color-mix(in srgb, var(--mobius-success, #22c55e) 10%, transparent);\n  border-color: color-mix(in srgb, var(--mobius-success, #22c55e) 30%, transparent);\n  color: var(--mobius-success, #16a34a);\n}\n\n#mobius-os-mini .mobius-mini-quick-answer-btn.suggested:hover {\n  background: color-mix(in srgb, var(--mobius-success, #22c55e) 20%, transparent);\n}\n\n#mobius-os-mini .mobius-mini-open-sidecar-btn {\n  padding: var(--mobius-space-xs, 4px) var(--mobius-space-sm, 10px);\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 500;\n  border: none;\n  background: var(--mobius-accent, #2563eb);\n  color: var(--mobius-accent-text, white);\n  border-radius: var(--mobius-radius-lg, 12px);\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n#mobius-os-mini .mobius-mini-open-sidecar-btn:hover {\n  background: var(--mobius-accent-hover, #1d4ed8);\n}\n\n/* Dark theme for status row */\n#mobius-os-mini.theme-dark .mobius-mini-question-text {\n  color: #e5e7eb;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-quick-answer-btn {\n  background: rgba(255, 255, 255, 0.08);\n  border-color: rgba(255, 255, 255, 0.2);\n  color: #e5e7eb;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-quick-answer-btn:hover {\n  background: rgba(255, 255, 255, 0.15);\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-quick-answer-btn.suggested {\n  background: rgba(34, 197, 94, 0.2);\n  border-color: rgba(34, 197, 94, 0.4);\n  color: #4ade80;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-open-sidecar-btn {\n  background: #3b82f6;\n}\n\n/* User Greeting Row */\n#mobius-os-mini .mobius-mini-greeting-row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: var(--mobius-space-xs, 5px) var(--mobius-space-sm, 10px);\n  background: linear-gradient(90deg, color-mix(in srgb, var(--mobius-accent, #2563eb) 4%, transparent), color-mix(in srgb, var(--mobius-info, #6366f1) 2%, transparent));\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.06));\n  position: relative;\n}\n\n#mobius-os-mini .mobius-mini-greeting-main {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-xs, 3px);\n  background: none;\n  border: none;\n  padding: 0;\n  cursor: pointer;\n  color: inherit;\n  font: inherit;\n}\n\n#mobius-os-mini .mobius-mini-greeting-main:hover {\n  opacity: 0.8;\n}\n\n#mobius-os-mini .mobius-mini-greeting-text {\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-accent, #3b82f6);\n}\n\n#mobius-os-mini .mobius-mini-greeting-chevron {\n  color: var(--mobius-accent, #60a5fa);\n  opacity: 0.6;\n  width: 10px;\n  height: 10px;\n}\n\n#mobius-os-mini .mobius-mini-greeting-dismiss {\n  width: 16px;\n  height: 16px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: none;\n  border: none;\n  border-radius: var(--mobius-radius-sm, 3px);\n  cursor: pointer;\n  color: var(--mobius-text-muted, #94a3b8);\n  padding: 0;\n}\n\n#mobius-os-mini .mobius-mini-greeting-dismiss:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n  color: var(--mobius-text-secondary, #64748b);\n}\n\n#mobius-os-mini .mobius-mini-greeting-dismiss svg {\n  width: 10px;\n  height: 10px;\n}\n\n/* User Dropdown */\n#mobius-os-mini .mobius-mini-user-dropdown {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n}\n\n/* Locked Overlay */\n#mobius-os-mini .mobius-mini-locked-overlay {\n  padding: var(--mobius-space-lg, 16px);\n  text-align: center;\n  background: linear-gradient(180deg, var(--mobius-bg-secondary, rgba(248, 250, 252, 0.98)), var(--mobius-bg-tertiary, rgba(241, 245, 249, 0.98)));\n}\n\n/* Theme variations for greeting */\n#mobius-os-mini.theme-dark .mobius-mini-greeting-row {\n  background: linear-gradient(90deg, rgba(37, 99, 235, 0.12), rgba(99, 102, 241, 0.08));\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-greeting-text {\n  color: #93c5fd;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-greeting-chevron {\n  color: #60a5fa;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-greeting-dismiss {\n  color: rgba(148, 163, 184, 0.7);\n}\n\n#mobius-os-mini.theme-blue .mobius-mini-greeting-row {\n  background: linear-gradient(90deg, rgba(37, 99, 235, 0.1), rgba(96, 165, 250, 0.08));\n}\n\n#mobius-os-mini.theme-blue .mobius-mini-greeting-text {\n  color: #1d4ed8;\n}\n\n/* Attention dropdown - compact */\n#mobius-os-mini .mobius-mini-attention-dropdown {\n  min-width: 180px !important;\n  max-width: 220px;\n}\n\n#mobius-os-mini .mobius-mini-note-wrap {\n  width: 100%;\n  position: relative;\n  display: flex;\n  align-items: center;\n}\n\n#mobius-os-mini .mobius-mini-note-input {\n  width: 100%;\n  height: var(--mobius-button-height, 28px);\n  border-radius: var(--mobius-radius-base, 10px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.14));\n  background: var(--mobius-bg-primary, #fff);\n  padding: 0 34px 0 var(--mobius-space-sm, 8px);\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 400;\n  color: var(--mobius-text-primary, #0b1220);\n  outline: none;\n}\n\n#mobius-os-mini .mobius-mini-note-input::placeholder {\n  color: var(--mobius-text-muted, rgba(91,102,122,0.75));\n  font-weight: 400;\n}\n\n#mobius-os-mini .mobius-mini-note-input:focus {\n  border-color: color-mix(in srgb, var(--mobius-accent, #2563eb) 55%, transparent);\n}\n\n#mobius-os-mini .mobius-mini-send-btn {\n  position: absolute;\n  right: var(--mobius-space-sm, 6px);\n  width: var(--mobius-button-height, 28px);\n  height: var(--mobius-button-height, 28px);\n  border-radius: var(--mobius-radius-base, 10px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n  padding: 0;\n}\n\n#mobius-os-mini .mobius-mini-send-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n#mobius-os-mini .mobius-mini-send-btn svg {\n  width: var(--mobius-icon-base, 16px);\n  height: var(--mobius-icon-base, 16px);\n  display: block;\n  fill: var(--mobius-text-secondary, rgba(11, 18, 32, 0.85));\n}\n\n/* =============================================================================\n   Mini Widget Themes\n   ============================================================================= */\n\n/* Theme: Light (default) - already applied via base styles */\n#mobius-os-mini.theme-light {\n  background: #ffffff !important;\n  color: #0b1220 !important;\n  border-color: rgba(11, 18, 32, 0.12) !important;\n  box-shadow: 0 16px 34px rgba(2, 6, 23, 0.14) !important;\n}\n\n/* Theme: Dark */\n#mobius-os-mini.theme-dark {\n  background: #1e293b !important;\n  color: #f1f5f9 !important;\n  border-color: #334155 !important;\n  box-shadow: 0 16px 34px rgba(0, 0, 0, 0.4) !important;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-header {\n  background: rgba(255, 255, 255, 0.03);\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-brand-text {\n  color: #f1f5f9;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-row {\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-row-label {\n  color: rgba(148, 163, 184, 0.9);\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-patient-name {\n  color: #f1f5f9;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-patient-id,\n#mobius-os-mini.theme-dark .mobius-mini-patient-dob {\n  color: rgba(148, 163, 184, 0.9);\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-minimized-patient {\n  color: #e2e8f0;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-problem-text {\n  color: #e2e8f0;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-status-badge {\n  background: rgba(255, 255, 255, 0.08);\n  border-color: rgba(255, 255, 255, 0.15);\n  color: #94a3b8;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-note-input {\n  background: #0f172a;\n  border-color: rgba(255, 255, 255, 0.12);\n  color: #f1f5f9;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-note-input::placeholder {\n  color: rgba(148, 163, 184, 0.6);\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-menu-btn,\n#mobius-os-mini.theme-dark .mobius-mini-expand-btn,\n#mobius-os-mini.theme-dark .mobius-mini-minimize-btn,\n#mobius-os-mini.theme-dark .mobius-mini-drag-handle,\n#mobius-os-mini.theme-dark .mobius-mini-icon-btn,\n#mobius-os-mini.theme-dark .mobius-mini-send-btn {\n  background: rgba(255, 255, 255, 0.06);\n  border-color: rgba(255, 255, 255, 0.12);\n  color: #e5e7eb;\n}\n\n#mobius-os-mini.theme-dark .mobius-mini-task-badge {\n  background: rgba(37, 99, 235, 0.15);\n  border-color: rgba(37, 99, 235, 0.3);\n}\n\n/* Theme: Blue */\n#mobius-os-mini.theme-blue {\n  background: #eff6ff !important;\n  color: #1e3a5f !important;\n  border-color: #bfdbfe !important;\n  box-shadow: 0 16px 34px rgba(37, 99, 235, 0.15) !important;\n}\n\n#mobius-os-mini.theme-blue .mobius-mini-header {\n  background: rgba(37, 99, 235, 0.05);\n  border-bottom-color: rgba(37, 99, 235, 0.1);\n}\n\n#mobius-os-mini.theme-blue .mobius-mini-brand-text {\n  color: #1e40af;\n}\n\n#mobius-os-mini.theme-blue .mobius-mini-row {\n  border-bottom-color: rgba(37, 99, 235, 0.1);\n}\n\n#mobius-os-mini.theme-blue .mobius-mini-row-label {\n  color: #3b82f6;\n}\n\n#mobius-os-mini.theme-blue .mobius-mini-patient-name {\n  color: #1e3a5f;\n}\n\n#mobius-os-mini.theme-blue .mobius-mini-status-badge {\n  background: rgba(37, 99, 235, 0.1);\n  border-color: rgba(37, 99, 235, 0.25);\n}\n\n#mobius-os-mini.theme-blue .mobius-mini-note-input {\n  background: #ffffff;\n  border-color: #bfdbfe;\n}\n\n/* Theme: Glass */\n#mobius-os-mini.theme-glass {\n  background: rgba(255, 255, 255, 0.8) !important;\n  color: #0b1220 !important;\n  border-color: rgba(255, 255, 255, 0.5) !important;\n  box-shadow: 0 16px 34px rgba(2, 6, 23, 0.12), 0 0 0 1px rgba(255,255,255,0.2) inset !important;\n  backdrop-filter: blur(12px) !important;\n  -webkit-backdrop-filter: blur(12px) !important;\n}\n\n#mobius-os-mini.theme-glass .mobius-mini-header {\n  background: rgba(255, 255, 255, 0.3);\n  border-bottom-color: rgba(11, 18, 32, 0.06);\n}\n\n#mobius-os-mini.theme-glass .mobius-mini-row {\n  border-bottom-color: rgba(11, 18, 32, 0.06);\n}\n\n#mobius-os-mini.theme-glass .mobius-mini-note-input {\n  background: rgba(255, 255, 255, 0.6);\n}\n\n#mobius-os-mini.theme-glass .mobius-mini-menu-btn,\n#mobius-os-mini.theme-glass .mobius-mini-expand-btn,\n#mobius-os-mini.theme-glass .mobius-mini-minimize-btn,\n#mobius-os-mini.theme-glass .mobius-mini-drag-handle {\n  background: rgba(255, 255, 255, 0.4);\n}\n\n#mobius-os-mini.theme-glass .mobius-mini-minimized-patient {\n  color: #1e293b;\n}\n\n/* Patient edit modal */\n.mobius-mini-modal-overlay {\n  position: fixed;\n  inset: 0;\n  background: rgba(2, 6, 23, 0.28);\n  z-index: 2147483647;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 18px;\n}\n\n.mobius-mini-modal {\n  width: 360px;\n  max-width: calc(100vw - 36px);\n  background: #fff;\n  border: 1px solid rgba(11, 18, 32, 0.12);\n  border-radius: 14px;\n  box-shadow: 0 18px 40px rgba(2, 6, 23, 0.20);\n  overflow: hidden;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Google Sans', sans-serif;\n  color: #0b1220;\n}\n\n.mobius-mini-modal-header {\n  padding: 10px 12px;\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: var(--mobius-space-sm, 10px);\n}\n\n.mobius-mini-modal-title {\n  font-size: var(--mobius-font-base, 12px);\n  font-weight: 500;\n}\n\n.mobius-mini-modal-close {\n  width: var(--mobius-button-height, 28px);\n  height: var(--mobius-button-height, 28px);\n  border-radius: var(--mobius-radius-base, 10px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n  font-weight: 500;\n}\n\n.mobius-mini-modal-close:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n.mobius-mini-modal-body {\n  padding: var(--mobius-space-md, 14px) var(--mobius-space-lg, 16px) var(--mobius-space-md, 12px);\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-md, 12px);\n}\n\n.mobius-mini-field {\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-sm, 6px);\n}\n\n.mobius-mini-field-label {\n  font-size: var(--mobius-font-xs, 9px);\n  letter-spacing: 0.10em;\n  text-transform: uppercase;\n  color: var(--mobius-text-secondary, rgba(91,102,122,0.95));\n  font-weight: 500;\n  margin-bottom: 0;\n}\n\n.mobius-mini-search-input {\n  position: relative;\n  display: flex;\n  align-items: center;\n}\n\n.mobius-mini-search-icon {\n  position: absolute;\n  left: var(--mobius-space-sm, 10px);\n  width: var(--mobius-icon-base, 16px);\n  height: var(--mobius-icon-base, 16px);\n  display: grid;\n  place-items: center;\n  opacity: 0.75;\n  pointer-events: none;\n}\n\n.mobius-mini-search-icon svg {\n  width: var(--mobius-icon-base, 16px);\n  height: var(--mobius-icon-base, 16px);\n  fill: var(--mobius-text-secondary, rgba(91, 102, 122, 0.95));\n}\n\n.mobius-mini-input.mobius-mini-input-with-icon {\n  padding-left: 34px;\n}\n\n.mobius-mini-input {\n  width: 100%;\n  height: 34px;\n  border-radius: var(--mobius-radius-lg, 12px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.14));\n  padding: 0 var(--mobius-space-sm, 10px);\n  font-size: var(--mobius-font-base, 12px);\n  font-weight: 400;\n  outline: none;\n}\n\n.mobius-mini-input:focus {\n  border-color: color-mix(in srgb, var(--mobius-accent, #2563eb) 55%, transparent);\n}\n\n.mobius-mini-field-hint {\n  font-size: var(--mobius-font-base, 12px);\n  color: var(--mobius-text-secondary, rgba(91,102,122,0.95));\n}\n\n.mobius-mini-suggestions {\n  display: none;\n  border: 1px solid rgba(11, 18, 32, 0.12);\n  border-radius: var(--mobius-radius-lg, 12px);\n  background: var(--mobius-bg-primary, #fff);\n  overflow: hidden;\n  box-shadow: 0 12px 24px var(--mobius-shadow-strong, rgba(2,6,23,0.12));\n}\n\n.mobius-mini-suggestion {\n  width: 100%;\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: var(--mobius-space-sm, 10px);\n  padding: var(--mobius-space-sm, 10px) var(--mobius-space-md, 12px);\n  border: none;\n  background: var(--mobius-bg-primary, #fff);\n  cursor: pointer;\n  font: inherit;\n}\n\n.mobius-mini-suggestion:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.04));\n}\n\n.mobius-mini-suggestion.active {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 10%, transparent);\n}\n\n.mobius-mini-suggestion .name {\n  font-size: var(--mobius-font-base, 12px);\n  font-weight: 500;\n  color: var(--mobius-text-primary, #0b1220);\n  min-width: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.mobius-mini-suggestion .id {\n  font-size: var(--mobius-font-sm, 11px);\n  font-weight: 400;\n  color: var(--mobius-text-secondary, rgba(91,102,122,0.95));\n  white-space: nowrap;\n  flex: 0 0 auto;\n}\n\n.mobius-mini-modal-actions {\n  padding: var(--mobius-space-sm, 10px) var(--mobius-space-md, 12px);\n  border-top: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  display: flex;\n  justify-content: flex-end;\n  gap: var(--mobius-space-sm, 8px);\n}\n\n.mobius-mini-btn-secondary,\n.mobius-mini-btn-primary {\n  height: 34px;\n  border-radius: var(--mobius-radius-lg, 12px);\n  padding: 0 var(--mobius-space-md, 12px);\n  font-size: var(--mobius-font-base, 12px);\n  font-weight: 500;\n  cursor: pointer;\n}\n\n.mobius-mini-btn-secondary {\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n}\n\n.mobius-mini-btn-secondary:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n.mobius-mini-btn-primary {\n  border: 1px solid color-mix(in srgb, var(--mobius-accent, #2563eb) 22%, transparent);\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 12%, transparent);\n  color: var(--mobius-accent, #1e40af);\n}\n\n.mobius-mini-btn-primary:hover {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 16%, transparent);\n}\n\n/* Mini toast */\n.mobius-mini-toast {\n  position: fixed;\n  left: 50%;\n  top: var(--mobius-space-lg, 16px);\n  transform: translateX(-50%);\n  background: var(--mobius-text-primary, rgba(15,23,42,0.92));\n  color: var(--mobius-bg-primary, #fff);\n  padding: var(--mobius-space-sm, 10px) var(--mobius-space-md, 12px);\n  border-radius: var(--mobius-radius-lg, 12px);\n  font-size: var(--mobius-font-base, 12px);\n  font-weight: 500;\n  z-index: 2147483647;\n  box-shadow: 0 14px 28px var(--mobius-shadow-strong, rgba(2,6,23,0.22));\n}\n\n/* =============================================================================\n   SIDECAR COMPONENTS\n   Minimalist, bottleneck-focused design\n   ============================================================================= */\n\n/* Status Bar - Modern minimal design */\n.sidecar-status-bar {\n  padding: var(--mobius-space-sm, 6px) var(--mobius-space-md, 12px);\n  background: var(--mobius-bg-primary, #ffffff);\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-xs, 4px);\n}\n\n.sidecar-status-bar-title-row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: var(--mobius-space-sm, 8px);\n}\n\n.sidecar-status-bar-title {\n  font-size: var(--mobius-font-xs, 7px);\n  font-weight: 500;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.95));\n  text-transform: uppercase;\n  letter-spacing: 0.04em;\n}\n\n.sidecar-status-bar-context {\n  font-size: var(--mobius-font-xs, 8px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.8));\n  white-space: nowrap;\n}\n\n.sidecar-status-bar-progress-row {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n}\n\n.sidecar-status-bar-track-wrapper {\n  flex: 1;\n  min-width: 0;\n}\n\n.sidecar-status-bar-track {\n  position: relative;\n  height: 3px;\n  border-radius: var(--mobius-radius-sm, 2px);\n  /* Mono grey gradient - subtle, modern */\n  background: linear-gradient(90deg, \n    var(--mobius-border-light, rgba(11, 18, 32, 0.08)) 0%, \n    var(--mobius-border, rgba(11, 18, 32, 0.12)) 50%,\n    var(--mobius-border-light, rgba(11, 18, 32, 0.06)) 100%\n  );\n}\n\n/* Progress fill - darker grey to show completion */\n.sidecar-status-bar-progress {\n  position: absolute;\n  top: 0;\n  left: 0;\n  height: 100%;\n  background: var(--mobius-text-secondary, rgba(11, 18, 32, 0.35));\n  border-radius: var(--mobius-radius-sm, 2px);\n  transition: width 0.3s ease;\n}\n\n/* Current position marker */\n.sidecar-status-bar-marker {\n  position: absolute;\n  top: -3px;\n  width: 9px;\n  height: 9px;\n  border-radius: 50%;\n  transform: translateX(-50%);\n  background: var(--mobius-text-primary, #0b1220);\n  border: 2px solid var(--mobius-bg-primary, #ffffff);\n  box-shadow: 0 1px 3px var(--mobius-shadow, rgba(2, 6, 23, 0.2));\n  z-index: 2;\n}\n\n/* Percentage label */\n.sidecar-status-bar-percent {\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 500;\n  color: var(--mobius-text-primary, #0b1220);\n  white-space: nowrap;\n}\n\n/* Bottleneck Card - Core UI */\n/* Mobius Greeting */\n.sidecar-greeting {\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-xs, 2px);\n  padding-bottom: var(--mobius-space-sm, 6px);\n  margin-bottom: var(--mobius-space-xs, 4px);\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.06));\n}\n\n.sidecar-greeting-text {\n  font-size: var(--mobius-font-sm, 11px);\n  font-weight: 400;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n.sidecar-greeting-subtext {\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n}\n\n.sidecar-bottleneck-card {\n  padding: 0;\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-xs, 4px);\n  margin-bottom: var(--mobius-space-xs, 3px);\n}\n\n.sidecar-bottleneck-card--clear {\n  padding: var(--mobius-space-xs, 4px) 0;\n}\n\n.sidecar-bottleneck-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding-bottom: var(--mobius-space-xs, 4px);\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n}\n\n.sidecar-bottleneck-count {\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 400;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n.sidecar-bottleneck-hint {\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n}\n\n.sidecar-bottleneck-item {\n  background: var(--mobius-bg-primary, #ffffff);\n  border: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  border-radius: var(--mobius-radius-sm, 5px);\n  padding: var(--mobius-space-xs, 5px) var(--mobius-space-sm, 7px);\n  display: flex;\n  box-shadow: none;\n  flex-direction: column;\n  gap: 3px;\n}\n\n.sidecar-bottleneck-question-row {\n  display: flex;\n  align-items: flex-start;\n  gap: var(--mobius-space-xs, 4px);\n}\n\n.sidecar-bottleneck-question-row::before {\n  content: '';\n  display: inline-block;\n  width: 4px;\n  height: 4px;\n  min-width: 4px;\n  background: var(--mobius-accent, #3b82f6);\n  border-radius: 50%;\n  margin-top: var(--mobius-space-xs, 4px);\n  flex-shrink: 0;\n}\n\n.sidecar-bottleneck-checkbox {\n  width: var(--mobius-icon-sm, 14px);\n  height: var(--mobius-icon-sm, 14px);\n  cursor: pointer;\n  margin-top: 1px;\n}\n\n.sidecar-bottleneck-question {\n  flex: 1;\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-primary, #0b1220);\n  line-height: 1.3;\n}\n\n.sidecar-source-badge {\n  font-size: var(--mobius-font-sm, 10px);\n  opacity: 0.7;\n}\n\n.sidecar-conflict-badge {\n  font-size: var(--mobius-font-base, 12px);\n}\n\n.sidecar-bottleneck-answers {\n  display: flex;\n  gap: var(--mobius-space-sm, 6px);\n  flex-wrap: wrap;\n  margin-top: var(--mobius-space-xs, 3px);\n  padding: var(--mobius-space-xs, 3px) 0;\n  align-items: center;\n  border-top: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.04));\n}\n\n#mobius-os-sidebar .sidecar-bottleneck-answers button.sidecar-answer-btn,\n.sidecar-answer-btn {\n  /* Reset all button defaults with high specificity */\n  all: unset !important;\n  box-sizing: border-box !important;\n  /* Apply our styles - pill buttons with grey background */\n  display: inline-block !important;\n  padding: var(--mobius-space-xs, 3px) var(--mobius-space-sm, 8px) !important;\n  margin: 0 !important;\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n  font-size: var(--mobius-font-xs, 9px) !important;\n  font-weight: 400 !important;\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.06)) !important;\n  background-color: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.06)) !important;\n  border: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08)) !important;\n  border-radius: var(--mobius-radius-sm, 4px) !important;\n  color: var(--mobius-text-secondary, rgba(91, 102, 122, 0.85)) !important;\n  cursor: pointer !important;\n  transition: all 0.15s ease !important;\n  text-decoration: none !important;\n  line-height: 1.3 !important;\n  white-space: nowrap !important;\n  box-shadow: none !important;\n  outline: none !important;\n}\n\n#mobius-os-sidebar .sidecar-bottleneck-answers button.sidecar-answer-btn:hover,\n.sidecar-answer-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.1)) !important;\n  background-color: var(--mobius-bg-hover, rgba(11, 18, 32, 0.1)) !important;\n  border-color: var(--mobius-border, rgba(11, 18, 32, 0.15)) !important;\n  color: var(--mobius-text-primary, #0b1220) !important;\n}\n\n#mobius-os-sidebar .sidecar-bottleneck-answers button.sidecar-answer-btn.sidecar-answer-btn--selected,\n#mobius-os-sidebar button.sidecar-answer-btn.sidecar-answer-btn--selected,\n.sidecar-bottleneck-answers .sidecar-answer-btn.sidecar-answer-btn--selected,\n.sidecar-answer-btn.sidecar-answer-btn--selected,\n.sidecar-answer-btn--selected {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 15%, transparent) !important;\n  background-color: color-mix(in srgb, var(--mobius-accent, #2563eb) 15%, transparent) !important;\n  border: 1px solid color-mix(in srgb, var(--mobius-accent, #2563eb) 35%, transparent) !important;\n  border-color: color-mix(in srgb, var(--mobius-accent, #2563eb) 35%, transparent) !important;\n  color: var(--mobius-accent, #2563eb) !important;\n  font-weight: 500 !important;\n}\n\n/* Assignment Dropdown - compact, near question */\n.sidecar-assign-dropdown {\n  position: relative;\n  flex-shrink: 0;\n  margin-left: auto;\n}\n\n.sidecar-assign-btn {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-xs, 3px);\n  padding: var(--mobius-space-xs, 3px) var(--mobius-space-sm, 6px);\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-accent, rgba(37, 99, 235, 0.9));\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 6%, transparent);\n  border: 1px solid color-mix(in srgb, var(--mobius-accent, #2563eb) 15%, transparent);\n  border-radius: var(--mobius-radius-sm, 6px);\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.sidecar-assign-btn:hover {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 12%, transparent);\n  border-color: color-mix(in srgb, var(--mobius-accent, #2563eb) 25%, transparent);\n}\n\n.sidecar-assign-btn--assigned {\n  background: color-mix(in srgb, var(--mobius-success, #22c55e) 8%, transparent);\n  border-color: color-mix(in srgb, var(--mobius-success, #22c55e) 25%, transparent);\n  color: var(--mobius-success, rgba(34, 197, 94, 0.9));\n}\n\n.sidecar-assign-label {\n  font-size: var(--mobius-font-xs, 9px);\n}\n\n.sidecar-assign-arrow {\n  font-size: var(--mobius-font-xs, 8px);\n  opacity: 0.6;\n}\n\n.sidecar-assign-menu {\n  position: absolute;\n  top: 100%;\n  right: 0;\n  margin-top: var(--mobius-space-xs, 4px);\n  min-width: 140px;\n  background: var(--mobius-bg-primary, #ffffff);\n  border: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.10));\n  border-radius: var(--mobius-radius-sm, 8px);\n  box-shadow: 0 4px 16px var(--mobius-shadow, rgba(2, 6, 23, 0.10));\n  z-index: 100;\n  overflow: hidden;\n  padding: var(--mobius-space-xs, 4px) 0;\n}\n\n.sidecar-assign-option {\n  display: flex;\n  flex-direction: column;\n  align-items: flex-start;\n  gap: 1px;\n  width: 100%;\n  padding: var(--mobius-space-sm, 6px) var(--mobius-space-sm, 10px);\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-primary, #0b1220);\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  text-align: left;\n}\n\n.sidecar-assign-option:hover {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 6%, transparent);\n}\n\n.sidecar-assign-option-text {\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 400;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n.sidecar-assign-option-hint {\n  font-size: var(--mobius-font-xs, 8px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n}\n\n.sidecar-assign-divider {\n  height: 1px;\n  background: var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  margin: var(--mobius-space-xs, 4px) 0;\n}\n\n/* Legacy delegate row - hidden but kept for compatibility */\n.sidecar-bottleneck-delegate {\n  display: none;\n}\n\n.sidecar-bottleneck-separator {\n  font-size: var(--mobius-font-xs, 9px);\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.7));\n  text-align: center;\n}\n\n.sidecar-mode-btn {\n  padding: var(--mobius-space-xs, 3px) var(--mobius-space-sm, 8px);\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  border-radius: var(--mobius-radius-sm, 8px);\n  cursor: pointer;\n  transition: all 0.15s ease;\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n.sidecar-mode-btn--mobius {\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n}\n\n.sidecar-mode-btn--mobius:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n.sidecar-mode-btn--user {\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n}\n\n.sidecar-mode-btn--user:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n.sidecar-mode-btn--selected {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 10%, transparent);\n  border-color: color-mix(in srgb, var(--mobius-accent, #2563eb) 35%, transparent);\n  color: var(--mobius-accent, #2563eb);\n}\n\n/* Mobius tip - encourages user adoption */\n.sidecar-bottleneck-mobius-tip {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-xs, 4px);\n  margin-top: var(--mobius-space-xs, 4px);\n  padding: var(--mobius-space-xs, 3px) var(--mobius-space-sm, 6px);\n  font-size: var(--mobius-font-xs, 8px);\n  font-weight: 400;\n  color: color-mix(in srgb, var(--mobius-accent, #2563eb) 75%, transparent);\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 4%, transparent);\n  border-radius: var(--mobius-radius-sm, 4px);\n}\n\n.sidecar-bottleneck-mobius-tip:hover {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 8%, transparent);\n  color: var(--mobius-accent, #2563eb);\n}\n\n.sidecar-mobius-tip-icon {\n  font-size: var(--mobius-font-xs, 9px);\n}\n\n.sidecar-bottleneck-mobius-tip--assigned {\n  color: color-mix(in srgb, var(--mobius-success, #22c55e) 85%, transparent);\n  background: color-mix(in srgb, var(--mobius-success, #22c55e) 6%, transparent);\n  cursor: default;\n}\n\n.sidecar-bottleneck-mobius-tip--assigned:hover {\n  background: color-mix(in srgb, var(--mobius-success, #22c55e) 6%, transparent);\n  color: color-mix(in srgb, var(--mobius-success, #22c55e) 85%, transparent);\n}\n\n/* Inline note row - matches Mini note styling */\n.sidecar-bottleneck-note-row {\n  margin-top: var(--mobius-space-xs, 4px);\n  padding-top: var(--mobius-space-xs, 4px);\n  border-top: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.06));\n}\n\n.sidecar-bottleneck-note-wrap {\n  width: 100%;\n  position: relative;\n  display: flex;\n  align-items: center;\n}\n\n.sidecar-bottleneck-note-input {\n  width: 100%;\n  height: 22px;\n  border-radius: var(--mobius-radius-sm, 6px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-primary, #fff);\n  padding: 0 26px 0 var(--mobius-space-sm, 6px);\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-primary, #0b1220);\n  outline: none;\n}\n\n.sidecar-bottleneck-note-input::placeholder {\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.75));\n  font-weight: 400;\n}\n\n.sidecar-bottleneck-note-input:focus {\n  border-color: color-mix(in srgb, var(--mobius-accent, #2563eb) 55%, transparent);\n}\n\n.sidecar-bottleneck-note-send {\n  position: absolute;\n  right: 0;\n  width: 22px;\n  height: 22px;\n  border-radius: var(--mobius-radius-sm, 6px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n}\n\n.sidecar-bottleneck-note-send:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n.sidecar-bottleneck-note-send svg {\n  width: var(--mobius-icon-sm, 14px);\n  height: var(--mobius-icon-sm, 14px);\n  display: block;\n  fill: var(--mobius-text-secondary, rgba(11, 18, 32, 0.85));\n}\n\n/* Inline button (Edit, small actions) */\n.sidecar-inline-btn {\n  height: 22px;\n  padding: 0 var(--mobius-space-sm, 8px);\n  border-radius: var(--mobius-radius-sm, 8px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 500;\n  color: var(--mobius-text-primary, #0b1220);\n}\n\n.sidecar-inline-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n/* Icon-only button (pencil edit, etc) - matches Mini */\n.sidecar-icon-btn {\n  width: 22px;\n  height: 22px;\n  border-radius: var(--mobius-radius-sm, 8px);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n  padding: 0;\n}\n\n.sidecar-icon-btn:hover {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n.sidecar-icon-btn svg {\n  width: var(--mobius-icon-sm, 12px);\n  height: var(--mobius-icon-sm, 12px);\n  fill: var(--mobius-text-secondary, rgba(11, 18, 32, 0.80));\n}\n\n.sidecar-bottleneck-bulk {\n  padding-top: var(--mobius-space-md, 12px);\n  border-top: 1px solid var(--mobius-border, #e5e7eb);\n}\n\n.sidecar-bottleneck-bulk-btn {\n  width: 100%;\n  padding: var(--mobius-space-sm, 8px) var(--mobius-space-md, 12px);\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 500;\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  color: var(--mobius-text-primary, #0b1220);\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  border-radius: var(--mobius-radius-base, 10px);\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.sidecar-bottleneck-bulk-btn:hover:not(:disabled) {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.06));\n}\n\n.sidecar-bottleneck-bulk-btn:disabled {\n  opacity: 0.5;\n  cursor: not-allowed;\n}\n\n.sidecar-bottleneck-clear {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 6px 10px;\n  background: rgba(34, 197, 94, 0.08);\n  border: 1px solid rgba(34, 197, 94, 0.15);\n  border-radius: 8px;\n}\n\n.sidecar-bottleneck-clear-icon {\n  width: 20px;\n  height: 20px;\n  background: var(--mobius-success, #22c55e);\n  color: var(--mobius-bg-primary, white);\n  border-radius: 50%;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 500;\n}\n\n.sidecar-bottleneck-clear-text {\n  font-size: var(--mobius-font-sm, 10px);\n  color: var(--mobius-success, #166534);\n  font-weight: 400;\n}\n\n/* Context Expander */\n/* Context Expander - matches Mini row styling */\n.sidecar-context-expander {\n  border-top: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  margin-top: var(--mobius-space-sm, 8px);\n}\n\n.sidecar-context-expander-toggle {\n  width: 100%;\n  padding: var(--mobius-space-sm, 6px) 0;\n  background: none;\n  border: none;\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-xs, 4px);\n  cursor: pointer;\n  font-size: var(--mobius-font-sm, 10px);\n  font-weight: 400;\n  color: var(--mobius-text-secondary, rgba(91, 102, 122, 0.95));\n  transition: background 0.15s ease;\n}\n\n.sidecar-context-expander-toggle:hover {\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.02));\n}\n\n.sidecar-context-expander-arrow {\n  font-size: var(--mobius-font-xs, 8px);\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.4));\n  transition: transform 0.15s ease;\n}\n\n.sidecar-context-expander-toggle[aria-expanded=\"true\"] .sidecar-context-expander-arrow {\n  transform: none;\n}\n\n.sidecar-context-expander-label {\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.7));\n}\n\n.sidecar-context-expander-content {\n  padding: 0 0 var(--mobius-space-sm, 8px);\n}\n\n.sidecar-section-title {\n  font-size: var(--mobius-font-xs, 7px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.45));\n  text-transform: uppercase;\n  letter-spacing: 0.3px;\n  letter-spacing: 0.04em;\n  margin-bottom: var(--mobius-space-xs, 4px);\n}\n\n/* Resolved Steps Section */\n.sidecar-resolved-section {\n  margin-bottom: var(--mobius-space-sm, 10px);\n  padding-bottom: var(--mobius-space-sm, 8px);\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.06));\n}\n\n.sidecar-resolved-list {\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-xs, 4px);\n}\n\n.sidecar-resolved-item {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  padding: var(--mobius-space-xs, 4px) 0;\n  font-size: var(--mobius-font-xs, 9px);\n  color: var(--mobius-text-secondary, rgba(91, 102, 122, 0.8));\n}\n\n.sidecar-resolved-check {\n  color: var(--mobius-success, #22c55e);\n  font-size: var(--mobius-font-sm, 10px);\n  flex-shrink: 0;\n}\n\n.sidecar-resolved-text {\n  flex: 1;\n  min-width: 0;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n.sidecar-resolved-answer {\n  font-size: var(--mobius-font-xs, 8px);\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.04));\n  padding: 1px var(--mobius-space-xs, 4px);\n  border-radius: var(--mobius-radius-sm, 3px);\n  flex-shrink: 0;\n}\n\n/* Resolution Plan Section */\n.sidecar-plan-section {\n  margin-bottom: var(--mobius-space-sm, 10px);\n  padding-bottom: var(--mobius-space-sm, 8px);\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.06));\n}\n\n.sidecar-plan-summary {\n  margin-bottom: var(--mobius-space-sm, 6px);\n}\n\n.sidecar-plan-factors {\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-xs, 4px);\n}\n\n.sidecar-plan-factor {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  font-size: var(--mobius-font-xs, 9px);\n}\n\n.sidecar-plan-factor-label {\n  flex: 1;\n  color: var(--mobius-text-secondary, rgba(91, 102, 122, 0.85));\n  font-weight: 400;\n}\n\n.sidecar-plan-factor-progress {\n  font-size: var(--mobius-font-xs, 8px);\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n  font-weight: 400;\n}\n\n.sidecar-plan-factor-bar {\n  width: 40px;\n  height: 3px;\n  background: var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  border-radius: var(--mobius-radius-sm, 2px);\n  overflow: hidden;\n}\n\n.sidecar-plan-factor-fill {\n  height: 100%;\n  background: var(--mobius-text-secondary, rgba(11, 18, 32, 0.35));\n  border-radius: var(--mobius-radius-sm, 2px);\n  transition: width 0.3s ease;\n}\n\n.sidecar-plan-current {\n  display: flex;\n  align-items: flex-start;\n  gap: var(--mobius-space-xs, 4px);\n  padding: var(--mobius-space-xs, 4px) var(--mobius-space-sm, 6px);\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.03));\n  border-radius: var(--mobius-radius-sm, 6px);\n  margin-top: var(--mobius-space-sm, 6px);\n}\n\n.sidecar-plan-current-label {\n  font-size: var(--mobius-font-xs, 8px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n  flex-shrink: 0;\n}\n\n.sidecar-plan-current-text {\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-secondary, rgba(91, 102, 122, 0.85));\n  line-height: 1.3;\n}\n\n.sidecar-plan-actions {\n  font-size: var(--mobius-font-xs, 8px);\n  font-weight: 400;\n  color: var(--mobius-accent, rgba(37, 99, 235, 0.8));\n  margin-top: var(--mobius-space-xs, 4px);\n}\n\n/* Milestones - subtle, rationale-style like ChatGPT thinking */\n.sidecar-milestones-list {\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-xs, 2px);\n}\n\n.sidecar-milestone {\n  background: transparent;\n  border: none;\n  border-radius: var(--mobius-radius-sm, 4px);\n  overflow: hidden;\n}\n\n.sidecar-milestone-header {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-xs, 4px);\n  padding: var(--mobius-space-xs, 3px) var(--mobius-space-sm, 6px);\n}\n\n.sidecar-milestone-icon {\n  width: var(--mobius-icon-sm, 12px);\n  height: var(--mobius-icon-sm, 12px);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: var(--mobius-font-xs, 8px);\n  opacity: 0.6;\n}\n\n.sidecar-milestone--complete .sidecar-milestone-icon {\n  color: var(--mobius-success, #22c55e);\n}\n\n.sidecar-milestone--in_progress .sidecar-milestone-icon {\n  color: var(--mobius-warning, #f59e0b);\n}\n\n.sidecar-milestone--blocked .sidecar-milestone-icon {\n  color: var(--mobius-danger, #ef4444);\n}\n\n.sidecar-milestone--pending .sidecar-milestone-icon {\n  color: var(--mobius-text-muted, #9ca3af);\n}\n\n.sidecar-milestone-label {\n  flex: 1;\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.7));\n  font-style: italic;\n}\n\n.sidecar-milestone-arrow {\n  font-size: var(--mobius-font-xs, 8px);\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.4));\n}\n\n.sidecar-milestone-details {\n  padding: var(--mobius-space-xs, 4px) var(--mobius-space-sm, 8px) var(--mobius-space-sm, 6px) 20px;\n  border-top: none;\n}\n\n/* Prior Runs - subtle history of previous visits */\n.sidecar-prior-runs-section {\n  padding: 0;\n}\n\n.sidecar-prior-runs-list {\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-sm, 6px);\n}\n\n.sidecar-prior-run {\n  padding: var(--mobius-space-xs, 4px) 0;\n  border-bottom: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.04));\n}\n\n.sidecar-prior-run:last-child {\n  border-bottom: none;\n}\n\n.sidecar-prior-run-header {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  margin-bottom: var(--mobius-space-xs, 2px);\n}\n\n.sidecar-prior-run-date {\n  font-size: var(--mobius-font-xs, 8px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n}\n\n.sidecar-prior-run-type {\n  font-size: var(--mobius-font-xs, 8px);\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.5));\n  font-style: italic;\n}\n\n.sidecar-prior-run-outcome {\n  font-size: var(--mobius-font-xs, 7px);\n  font-weight: 400;\n  padding: 1px var(--mobius-space-xs, 4px);\n  border-radius: var(--mobius-radius-sm, 3px);\n  margin-left: auto;\n}\n\n.sidecar-prior-run-outcome--paid {\n  background: color-mix(in srgb, var(--mobius-success, #22c55e) 10%, transparent);\n  color: var(--mobius-success, #16a34a);\n}\n\n.sidecar-prior-run-outcome--issue {\n  background: color-mix(in srgb, var(--mobius-warning, #f59e0b) 10%, transparent);\n  color: var(--mobius-warning, #d97706);\n}\n\n.sidecar-prior-run-summary {\n  font-size: var(--mobius-font-xs, 8px);\n  font-style: italic;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n  line-height: 1.3;\n}\n\n/* Substeps */\n.sidecar-substeps {\n  display: flex;\n  flex-direction: column;\n  gap: var(--mobius-space-xs, 2px);\n  margin-bottom: var(--mobius-space-xs, 4px);\n}\n\n.sidecar-substep {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-xs, 4px);\n  font-size: var(--mobius-font-xs, 8px);\n  font-style: italic;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n}\n\n.sidecar-substep-icon {\n  font-size: var(--mobius-font-xs, 6px);\n  opacity: 0.6;\n}\n\n.sidecar-substep--complete .sidecar-substep-icon {\n  color: var(--mobius-success, #22c55e);\n}\n\n.sidecar-substep--current .sidecar-substep-icon {\n  color: var(--mobius-accent, #2563eb);\n}\n\n/* Timeline */\n.sidecar-timeline {\n  border-left: 2px solid var(--mobius-border, #e5e7eb);\n  padding-left: var(--mobius-space-md, 12px);\n}\n\n.sidecar-timeline-title {\n  font-size: var(--mobius-font-sm, 11px);\n  font-weight: 500;\n  color: var(--mobius-text-muted, #9ca3af);\n  margin-bottom: var(--mobius-space-sm, 8px);\n}\n\n.sidecar-timeline-entry {\n  display: flex;\n  flex-wrap: wrap;\n  align-items: center;\n  gap: var(--mobius-space-sm, 6px);\n  font-size: var(--mobius-font-base, 12px);\n  margin-bottom: var(--mobius-space-sm, 6px);\n  position: relative;\n}\n\n.sidecar-timeline-entry::before {\n  content: '';\n  position: absolute;\n  left: -16px;\n  width: 8px;\n  height: 8px;\n  background: var(--mobius-border, #e5e7eb);\n  border-radius: 50%;\n}\n\n.sidecar-timeline-actor {\n  font-weight: 400;\n  color: var(--mobius-text-secondary, #374151);\n}\n\n.sidecar-timeline-actor--mobius {\n  color: var(--mobius-accent, #2563eb);\n}\n\n.sidecar-timeline-actor--user {\n  color: var(--mobius-success, #059669);\n}\n\n.sidecar-timeline-action {\n  color: var(--mobius-text-secondary, #6b7280);\n}\n\n.sidecar-timeline-time {\n  color: var(--mobius-text-muted, #9ca3af);\n  font-size: var(--mobius-font-sm, 11px);\n}\n\n.sidecar-timeline-artifact {\n  color: var(--mobius-accent, #2563eb);\n  text-decoration: none;\n  font-size: var(--mobius-font-sm, 11px);\n}\n\n.sidecar-timeline-artifact:hover {\n  text-decoration: underline;\n}\n\n/* Payer Info */\n.sidecar-payer-section {\n  margin-top: var(--mobius-space-lg, 16px);\n  padding-top: var(--mobius-space-lg, 16px);\n  border-top: 1px solid var(--mobius-border, #e5e7eb);\n}\n\n.sidecar-payer-info {\n  background: #f9fafb;\n  border-radius: 6px;\n  padding: 12px;\n}\n\n.sidecar-payer-name {\n  font-size: 14px;\n  font-weight: 600;\n  color: #1f2937;\n  margin-bottom: 8px;\n}\n\n.sidecar-payer-phone,\n.sidecar-payer-portal,\n.sidecar-payer-response-time {\n  font-size: 12px;\n  color: #6b7280;\n  margin-bottom: 4px;\n}\n\n.sidecar-payer-phone a,\n.sidecar-payer-portal a {\n  color: #2563eb;\n  text-decoration: none;\n}\n\n.sidecar-payer-phone a:hover,\n.sidecar-payer-portal a:hover {\n  text-decoration: underline;\n}\n\n.sidecar-policy-excerpts {\n  margin-top: 12px;\n}\n\n.sidecar-excerpts-title {\n  font-size: 11px;\n  font-weight: 600;\n  color: #9ca3af;\n  margin-bottom: 8px;\n}\n\n.sidecar-policy-excerpt {\n  background: white;\n  border: 1px solid #e5e7eb;\n  border-radius: 6px;\n  padding: 10px;\n  margin-bottom: 8px;\n}\n\n.sidecar-excerpt-topic {\n  font-size: 12px;\n  font-weight: 600;\n  color: #374151;\n  margin-bottom: 4px;\n}\n\n.sidecar-excerpt-content {\n  font-size: 12px;\n  color: #6b7280;\n  line-height: 1.4;\n}\n\n.sidecar-excerpt-source {\n  font-size: 10px;\n  color: #9ca3af;\n  margin-top: 4px;\n}\n\n/* Cards Container - compact and scrollable */\n.sidecar-cards-container {\n  /* Styles applied inline, but ensure smooth scrolling */\n  scrollbar-width: thin;\n  scrollbar-color: rgba(11, 18, 32, 0.2) transparent;\n}\n\n.sidecar-cards-container::-webkit-scrollbar {\n  width: 6px;\n}\n\n.sidecar-cards-container::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.sidecar-cards-container::-webkit-scrollbar-thumb {\n  background: rgba(11, 18, 32, 0.2);\n  border-radius: 3px;\n}\n\n.sidecar-cards-container::-webkit-scrollbar-thumb:hover {\n  background: rgba(11, 18, 32, 0.3);\n}\n\n/* Chat Container */\n.sidecar-chat-container {\n  flex: 1;\n  min-height: 0;\n  display: flex;\n  flex-direction: column;\n  border-top: 1px solid rgba(11, 18, 32, 0.08);\n  background: #fafafa;\n}\n\n.sidecar-chat-header {\n  font-size: 9px;\n  font-weight: 600;\n  color: rgba(91, 102, 122, 0.7);\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n  padding: 8px 10px 6px 10px;\n  border-bottom: 1px solid rgba(11, 18, 32, 0.06);\n  background: #ffffff;\n}\n\n.sidecar-chat-content {\n  flex: 1;\n  min-height: 0;\n  overflow-y: auto;\n  padding: 8px 10px;\n  background: #ffffff;\n  scrollbar-width: thin;\n  scrollbar-color: rgba(11, 18, 32, 0.2) transparent;\n}\n\n.sidecar-chat-content::-webkit-scrollbar {\n  width: 6px;\n}\n\n.sidecar-chat-content::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.sidecar-chat-content::-webkit-scrollbar-thumb {\n  background: rgba(11, 18, 32, 0.2);\n  border-radius: 3px;\n}\n\n.sidecar-chat-content::-webkit-scrollbar-thumb:hover {\n  background: rgba(11, 18, 32, 0.3);\n}\n\n/* Quick Chat */\n/* Quick Chat - pinned at bottom, matches Mini note input styling */\n.sidecar-quick-chat {\n  flex-shrink: 0;\n  padding: var(--mobius-space-sm, 8px) var(--mobius-space-sm, 10px);\n  background: var(--mobius-bg-primary, #ffffff);\n  border-top: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.08));\n  margin-top: auto;  /* Push to bottom of flex container */\n}\n\n/* Chat Messages Container - bounded, scrollable */\n.sidecar-chat-messages {\n  height: 88px;  /* ~5-6 lines at 9px font + padding */\n  overflow-y: auto;\n  border: 1px solid var(--mobius-border-light, rgba(11, 18, 32, 0.1));\n  border-radius: var(--mobius-radius-sm, 6px);\n  background: var(--mobius-bg-secondary, #fafbfc);\n  margin-bottom: var(--mobius-space-sm, 8px);\n  padding: var(--mobius-space-sm, 6px) var(--mobius-space-sm, 8px);\n  scrollbar-width: thin;\n  scrollbar-color: var(--mobius-border, rgba(11, 18, 32, 0.15)) transparent;\n}\n\n.sidecar-chat-messages::-webkit-scrollbar {\n  width: 4px;\n}\n\n.sidecar-chat-messages::-webkit-scrollbar-track {\n  background: transparent;\n}\n\n.sidecar-chat-messages::-webkit-scrollbar-thumb {\n  background: var(--mobius-border, rgba(11, 18, 32, 0.15));\n  border-radius: var(--mobius-radius-sm, 2px);\n}\n\n.sidecar-chat-messages::-webkit-scrollbar-thumb:hover {\n  background: var(--mobius-text-muted, rgba(11, 18, 32, 0.25));\n}\n\n/* Empty state */\n.sidecar-chat-empty {\n  font-size: var(--mobius-font-xs, 9px);\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.5));\n  font-style: italic;\n  text-align: center;\n  padding: var(--mobius-space-lg, 20px) var(--mobius-space-sm, 8px);\n}\n\n/* Chat messages */\n.sidecar-chat-message {\n  font-size: var(--mobius-font-xs, 9px);\n  line-height: 1.4;\n  padding: var(--mobius-space-xs, 4px) var(--mobius-space-sm, 6px);\n  border-radius: var(--mobius-radius-sm, 4px);\n  margin-bottom: var(--mobius-space-xs, 4px);\n  max-width: 90%;\n}\n\n.sidecar-chat-message:last-child {\n  margin-bottom: 0;\n}\n\n.sidecar-chat-message.user-message {\n  background: color-mix(in srgb, var(--mobius-accent, #2563eb) 10%, transparent);\n  color: var(--mobius-accent, #1e40af);\n  margin-left: auto;\n  text-align: right;\n}\n\n.sidecar-chat-message.system-message {\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.04));\n  color: var(--mobius-text-secondary, #374151);\n}\n\n.sidecar-chat-message-text {\n  font-weight: 400;\n}\n\n.sidecar-chat-message-source {\n  font-size: var(--mobius-font-xs, 8px);\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n  margin-top: var(--mobius-space-xs, 2px);\n}\n\n.sidecar-quick-chat-wrapper {\n  display: flex;\n  align-items: center;\n  position: relative;\n}\n\n.sidecar-quick-chat-input {\n  flex: 1;\n  height: var(--mobius-button-height, 28px);\n  padding: 0 32px 0 var(--mobius-space-sm, 8px);\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  border: 1px solid var(--mobius-border, rgba(11, 18, 32, 0.12));\n  border-radius: var(--mobius-radius-sm, 6px);\n  outline: none;\n  color: var(--mobius-text-primary, #0b1220);\n  background: var(--mobius-bg-primary, #fff);\n}\n\n.sidecar-quick-chat-input::placeholder {\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.5));\n  font-weight: 400;\n}\n\n.sidecar-quick-chat-input:focus {\n  border-color: color-mix(in srgb, var(--mobius-accent, #2563eb) 35%, transparent);\n}\n\n.sidecar-quick-chat-input:disabled {\n  background: var(--mobius-bg-tertiary, rgba(11, 18, 32, 0.02));\n}\n\n.sidecar-quick-chat-send {\n  position: absolute;\n  right: 0;\n  width: var(--mobius-button-height, 28px);\n  height: var(--mobius-button-height, 28px);\n  background: transparent;\n  border: none;\n  border-radius: var(--mobius-radius-sm, 6px);\n  font-size: var(--mobius-font-base, 12px);\n  cursor: pointer;\n  transition: background 0.15s ease;\n  display: grid;\n  place-items: center;\n}\n\n.sidecar-quick-chat-send:hover:not(:disabled) {\n  background: var(--mobius-bg-hover, rgba(11, 18, 32, 0.04));\n}\n\n.sidecar-quick-chat-send:disabled {\n  cursor: not-allowed;\n}\n\n.sidecar-quick-chat-send svg {\n  width: var(--mobius-icon-sm, 14px);\n  height: var(--mobius-icon-sm, 14px);\n  display: block;\n  fill: var(--mobius-text-muted, rgba(91, 102, 122, 0.6));\n}\n\n.sidecar-quick-chat-send:hover:not(:disabled) svg {\n  fill: var(--mobius-text-secondary, rgba(91, 102, 122, 0.9));\n}\n\n.sidecar-quick-chat-send:disabled svg {\n  fill: var(--mobius-border, rgba(11, 18, 32, 0.2));\n}\n\n.sidecar-quick-chat-hint {\n  font-size: var(--mobius-font-xs, 9px);\n  font-weight: 400;\n  color: var(--mobius-text-muted, rgba(91, 102, 122, 0.5));\n  margin-top: var(--mobius-space-sm, 6px);\n}\n\n.sidecar-quick-chat-response {\n  background: var(--mobius-bg-secondary, #f0f9ff);\n  border: 1px solid var(--mobius-border, #bae6fd);\n  border-radius: var(--mobius-radius-sm, 8px);\n  padding: var(--mobius-space-md, 12px);\n  margin-bottom: var(--mobius-space-sm, 8px);\n  position: relative;\n}\n\n.sidecar-quick-chat-response-text {\n  font-size: var(--mobius-font-base, 13px);\n  color: var(--mobius-text-primary, #1e3a5f);\n  line-height: 1.4;\n}\n\n.sidecar-quick-chat-response-source {\n  font-size: var(--mobius-font-sm, 11px);\n  color: var(--mobius-text-secondary, #6b7280);\n  margin-top: var(--mobius-space-sm, 6px);\n}\n\n.sidecar-quick-chat-response-dismiss {\n  position: absolute;\n  top: 8px;\n  right: 8px;\n  background: none;\n  border: none;\n  color: #9ca3af;\n  cursor: pointer;\n  font-size: 16px;\n}\n\n/* Sidecar Menu */\n/* Sidecar Menu - matches Mini menu styling */\n.sidecar-menu {\n  position: relative;\n}\n\n.sidecar-menu-btn {\n  width: 22px;\n  height: 22px;\n  border-radius: 6px;\n  border: 1px solid rgba(11, 18, 32, 0.12);\n  background: rgba(11, 18, 32, 0.03);\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n  padding: 0;\n}\n\n.sidecar-menu-btn svg {\n  width: 14px;\n  height: 14px;\n  fill: rgba(11, 18, 32, 0.7);\n}\n\n.sidecar-menu-btn:hover {\n  background: rgba(11, 18, 32, 0.06);\n}\n\n.sidecar-menu-dropdown {\n  position: absolute;\n  top: 100%;\n  right: 0;\n  margin-top: 4px;\n  min-width: 140px;\n  background: #fff;\n  border: 1px solid rgba(11, 18, 32, 0.12);\n  border-radius: 10px;\n  box-shadow: 0 8px 24px rgba(2, 6, 23, 0.12);\n  z-index: 2147483647;\n  overflow: visible;\n  pointer-events: auto;\n  padding: 4px 0;\n}\n\n.sidecar-menu-item {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  width: 100%;\n  text-align: left;\n  padding: 8px 12px;\n  border: none;\n  background: transparent;\n  font-size: 11px;\n  font-weight: 400;\n  color: #0b1220;\n  cursor: pointer;\n  pointer-events: auto;\n  transition: background 0.15s ease;\n  position: relative;\n}\n\n.sidecar-menu-item:hover {\n  background: rgba(11, 18, 32, 0.04);\n}\n\n.sidecar-menu-item.danger {\n  color: #b3261e;\n}\n\n.sidecar-menu-icon {\n  width: 14px;\n  height: 14px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  flex-shrink: 0;\n}\n\n.sidecar-menu-icon svg {\n  width: 14px;\n  height: 14px;\n  fill: rgba(11, 18, 32, 0.6);\n}\n\n.sidecar-menu-label {\n  flex: 1;\n  font-size: 11px;\n  font-weight: 400;\n}\n\n.sidecar-menu-arrow {\n  font-size: 10px;\n  color: rgba(91, 102, 122, 0.6);\n  margin-left: auto;\n}\n\n.sidecar-menu-divider {\n  height: 1px;\n  background: rgba(11, 18, 32, 0.08);\n  margin: 4px 0;\n}\n\n/* Theme submenu - positioned to the left since sidecar is on right edge */\n.sidecar-menu-submenu {\n  position: absolute;\n  right: 100%;\n  left: auto;\n  top: 0;\n  margin-right: 4px;\n  min-width: 100px;\n  background: #fff;\n  border: 1px solid rgba(11, 18, 32, 0.12);\n  border-radius: 8px;\n  box-shadow: 0 4px 12px rgba(2, 6, 23, 0.1);\n  padding: 4px 0;\n  z-index: 2147483648;\n}\n\n.sidecar-menu-submenu-item {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 10px;\n  font-size: 10px;\n  font-weight: 400;\n  color: #0b1220;\n  cursor: pointer;\n  transition: background 0.15s ease;\n}\n\n.sidecar-menu-submenu-item:hover {\n  background: rgba(11, 18, 32, 0.04);\n}\n\n.sidecar-menu-theme-icon {\n  font-size: 8px;\n  color: rgba(91, 102, 122, 0.7);\n}\n\n.sidecar-menu-theme-label {\n  font-size: 10px;\n  font-weight: 400;\n}\n\n/* View submenu items */\n.sidecar-menu-view-icon {\n  font-size: 10px;\n  color: rgba(91, 102, 122, 0.7);\n}\n\n.sidecar-menu-view-label {\n  font-size: 10px;\n  font-weight: 400;\n  flex: 1;\n}\n\n.sidecar-menu-check {\n  font-size: 10px;\n  color: #1a73e8;\n  font-weight: 600;\n}\n\n.sidecar-menu-submenu-item.active {\n  background: rgba(26, 115, 232, 0.08);\n}\n\n.sidecar-menu-submenu-item.active .sidecar-menu-view-label {\n  color: #1a73e8;\n  font-weight: 500;\n}\n\n/* Toggle switch - matches Mini style */\n.sidecar-menu-toggle {\n  position: relative;\n  width: 32px;\n  height: 18px;\n}\n\n.sidecar-menu-toggle-input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n\n.sidecar-menu-toggle-slider {\n  position: absolute;\n  cursor: pointer;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(11, 18, 32, 0.15);\n  border-radius: 9px;\n  transition: background 0.2s ease;\n}\n\n.sidecar-menu-toggle-slider::before {\n  content: '';\n  position: absolute;\n  height: 14px;\n  width: 14px;\n  left: 2px;\n  bottom: 2px;\n  background: white;\n  border-radius: 50%;\n  transition: transform 0.2s ease;\n  box-shadow: 0 1px 3px rgba(2, 6, 23, 0.15);\n}\n\n.sidecar-menu-toggle-input:checked + .sidecar-menu-toggle-slider {\n  background: #2563eb;\n}\n\n.sidecar-menu-toggle-input:checked + .sidecar-menu-toggle-slider::before {\n  transform: translateX(14px);\n}\n\n/* Collapse button - matches Mini expand/minimize buttons */\n.sidecar-collapse-btn {\n  width: 22px;\n  height: 22px;\n  border-radius: 6px;\n  border: 1px solid rgba(11, 18, 32, 0.12);\n  background: rgba(11, 18, 32, 0.03);\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n  padding: 0;\n}\n\n.sidecar-collapse-btn svg {\n  width: 14px;\n  height: 14px;\n  fill: rgba(11, 18, 32, 0.7);\n}\n\n.sidecar-collapse-btn:hover {\n  background: rgba(11, 18, 32, 0.06);\n}\n\n/* Alert Indicator */\n/* Alert Indicator - matches Mini button styling */\n.sidecar-alert-indicator {\n  position: relative;\n  width: 22px;\n  height: 22px;\n  border-radius: 6px;\n  border: 1px solid rgba(11, 18, 32, 0.12);\n  background: rgba(11, 18, 32, 0.03);\n  cursor: pointer;\n  display: grid;\n  place-items: center;\n}\n\n.sidecar-alert-indicator:hover {\n  background: rgba(11, 18, 32, 0.06);\n}\n\n.sidecar-alert-icon {\n  width: 14px;\n  height: 14px;\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.sidecar-alert-icon svg {\n  width: 14px;\n  height: 14px;\n  display: block;\n  fill: none;\n  stroke: rgba(11, 18, 32, 0.85);\n  stroke-width: 1.6;\n  stroke-linecap: round;\n  stroke-linejoin: round;\n}\n\n.sidecar-alert-badge {\n  position: absolute;\n  top: -4px;\n  right: -4px;\n  min-width: 14px;\n  height: 14px;\n  background: #2563eb;\n  color: white;\n  font-size: 9px;\n  font-weight: 600;\n  border-radius: 7px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  padding: 0 3px;\n}\n\n.sidecar-alert-badge--high {\n  background: #dc2626;\n}\n\n.sidecar-notification-dot {\n  width: 6px;\n  height: 6px;\n  background: #2563eb;\n  border-radius: 50%;\n}\n\n.sidecar-notification-dot--high {\n  background: #dc2626;\n}\n\n/* Privacy indicator - matches Mini style */\n.sidecar-privacy-indicator {\n  font-size: 11px;\n  color: rgba(91, 102, 122, 0.95);\n}\n\n/* ========================================\n   SIDECAR THEMES\n   ======================================== */\n\n/* Dark Theme */\n#mobius-os-sidebar.theme-dark {\n  background: #1a1f2e;\n  color: #e5e7eb;\n  border-left-color: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .top-row {\n  background: rgba(255, 255, 255, 0.02);\n  border-bottom-color: rgba(255, 255, 255, 0.06);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-status-bar {\n  background: #1a1f2e;\n  border-bottom-color: rgba(255, 255, 255, 0.06);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-status-bar-context {\n  color: rgba(229, 231, 235, 0.8);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-status-bar-track {\n  background: linear-gradient(90deg, \n    rgba(255, 255, 255, 0.06) 0%, \n    rgba(255, 255, 255, 0.1) 50%,\n    rgba(255, 255, 255, 0.04) 100%\n  );\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-status-bar-progress {\n  background: rgba(255, 255, 255, 0.3);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-status-bar-marker {\n  background: #e5e7eb;\n  border-color: #1a1f2e;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-status-bar-percent {\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-item {\n  background: rgba(255, 255, 255, 0.04);\n  border-color: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-question {\n  color: #e5e7eb;\n}\n\n/* Dark theme answer buttons moved to complete dark theme section below */\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-btn,\n#mobius-os-sidebar.theme-dark .sidecar-collapse-btn,\n#mobius-os-sidebar.theme-dark .sidecar-alert-indicator {\n  background: rgba(255, 255, 255, 0.06);\n  border-color: rgba(255, 255, 255, 0.12);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-btn svg,\n#mobius-os-sidebar.theme-dark .sidecar-collapse-btn svg,\n#mobius-os-sidebar.theme-dark .sidecar-alert-icon svg {\n  fill: rgba(229, 231, 235, 0.8);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-dropdown,\n#mobius-os-sidebar.theme-dark .sidecar-menu-submenu {\n  background: #252b3b;\n  border-color: rgba(255, 255, 255, 0.1);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-item {\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-item:hover {\n  background: rgba(255, 255, 255, 0.06);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-submenu-item {\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-submenu-item:hover {\n  background: rgba(255, 255, 255, 0.06);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-submenu-item.active {\n  background: rgba(138, 180, 248, 0.15);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-submenu-item.active .sidecar-menu-view-label {\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-check {\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-view-icon {\n  color: #9ca3af;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-menu-icon svg {\n  fill: rgba(229, 231, 235, 0.6);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-quick-chat {\n  background: rgba(255, 255, 255, 0.02);\n  border-top-color: rgba(255, 255, 255, 0.06);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-quick-chat-input {\n  background: rgba(255, 255, 255, 0.06);\n  border-color: rgba(255, 255, 255, 0.12);\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-quick-chat-input::placeholder {\n  color: rgba(229, 231, 235, 0.5);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-quick-chat-send {\n  background: rgba(255, 255, 255, 0.06);\n  border-color: rgba(255, 255, 255, 0.12);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-quick-chat-send svg {\n  fill: rgba(229, 231, 235, 0.7);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-chat-messages {\n  background: rgba(255, 255, 255, 0.04);\n  border-color: rgba(255, 255, 255, 0.1);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-chat-empty {\n  color: rgba(229, 231, 235, 0.4);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-chat-message.user-message {\n  background: rgba(59, 130, 246, 0.2);\n  color: #93c5fd;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-chat-message.system-message {\n  background: rgba(255, 255, 255, 0.06);\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-chat-message-source {\n  color: rgba(229, 231, 235, 0.5);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-section-title {\n  color: rgba(229, 231, 235, 0.7);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-context-expander-toggle {\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-context-expander-toggle:hover {\n  background: rgba(255, 255, 255, 0.04);\n}\n\n/* Glass Theme */\n#mobius-os-sidebar.theme-glass {\n  background: rgba(255, 255, 255, 0.75);\n  backdrop-filter: blur(20px);\n  -webkit-backdrop-filter: blur(20px);\n  border-left-color: rgba(255, 255, 255, 0.3);\n}\n\n#mobius-os-sidebar.theme-glass .top-row {\n  background: rgba(255, 255, 255, 0.4);\n}\n\n#mobius-os-sidebar.theme-glass .sidecar-status-bar {\n  background: rgba(255, 255, 255, 0.5);\n}\n\n#mobius-os-sidebar.theme-glass .sidecar-bottleneck-item {\n  background: rgba(255, 255, 255, 0.6);\n  border-color: rgba(255, 255, 255, 0.4);\n  box-shadow: 0 2px 8px rgba(2, 6, 23, 0.06);\n}\n\n#mobius-os-sidebar.theme-glass .sidecar-menu-btn,\n#mobius-os-sidebar.theme-glass .sidecar-collapse-btn,\n#mobius-os-sidebar.theme-glass .sidecar-alert-indicator {\n  background: rgba(255, 255, 255, 0.5);\n  border-color: rgba(255, 255, 255, 0.4);\n}\n\n#mobius-os-sidebar.theme-glass .sidecar-menu-dropdown,\n#mobius-os-sidebar.theme-glass .sidecar-menu-submenu {\n  background: rgba(255, 255, 255, 0.9);\n  backdrop-filter: blur(10px);\n  -webkit-backdrop-filter: blur(10px);\n}\n\n#mobius-os-sidebar.theme-glass .sidecar-quick-chat {\n  background: rgba(255, 255, 255, 0.4);\n}\n\n#mobius-os-sidebar.theme-glass .sidecar-quick-chat-input {\n  background: rgba(255, 255, 255, 0.7);\n}\n\n/* ============================================\n   COMPLETE DARK THEME - All Sidecar Elements\n   ============================================ */\n\n/* Dark: Greeting */\n#mobius-os-sidebar.theme-dark .sidecar-greeting {\n  border-bottom-color: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-greeting-text {\n  color: #f1f5f9;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-greeting-subtext {\n  color: rgba(148, 163, 184, 0.7);\n}\n\n/* Dark: Patient Row */\n#mobius-os-sidebar.theme-dark .sidecar-patient-row {\n  border-bottom-color: rgba(255, 255, 255, 0.08) !important;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-patient-row label {\n  color: rgba(148, 163, 184, 0.8);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-patient-row span {\n  color: #f1f5f9;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-icon-btn {\n  background: rgba(255, 255, 255, 0.06);\n  border-color: rgba(255, 255, 255, 0.12);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-icon-btn svg {\n  fill: rgba(229, 231, 235, 0.7);\n}\n\n/* Dark: Status Bar Title */\n#mobius-os-sidebar.theme-dark .sidecar-status-bar-title {\n  color: rgba(148, 163, 184, 0.8);\n}\n\n/* Dark: Bottleneck Header */\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-header {\n  color: rgba(229, 231, 235, 0.8);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-count {\n  color: #f1f5f9;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-hint {\n  color: rgba(148, 163, 184, 0.6);\n}\n\n/* Dark: Answer Buttons */\n#mobius-os-sidebar.theme-dark .sidecar-answer-btn {\n  background: rgba(255, 255, 255, 0.08) !important;\n  background-color: rgba(255, 255, 255, 0.08) !important;\n  border-color: rgba(255, 255, 255, 0.12) !important;\n  color: rgba(229, 231, 235, 0.85) !important;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-answer-btn:hover {\n  background: rgba(255, 255, 255, 0.12) !important;\n  background-color: rgba(255, 255, 255, 0.12) !important;\n  border-color: rgba(255, 255, 255, 0.18) !important;\n  color: #f1f5f9 !important;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-answer-btn--selected,\n#mobius-os-sidebar.theme-dark .sidecar-answer-btn.sidecar-answer-btn--selected {\n  background: rgba(37, 99, 235, 0.25) !important;\n  background-color: rgba(37, 99, 235, 0.25) !important;\n  border-color: rgba(37, 99, 235, 0.4) !important;\n  color: #93c5fd !important;\n}\n\n/* Dark: Note Input */\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-note-row {\n  border-top-color: rgba(255, 255, 255, 0.06);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-note-input {\n  background: rgba(255, 255, 255, 0.06);\n  border-color: rgba(255, 255, 255, 0.12);\n  color: #f1f5f9;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-note-input::placeholder {\n  color: rgba(148, 163, 184, 0.5);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-note-send svg {\n  fill: rgba(229, 231, 235, 0.6);\n}\n\n/* Dark: Mobius Tip */\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-mobius-tip {\n  background: rgba(37, 99, 235, 0.15);\n  color: #93c5fd;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-bottleneck-mobius-tip--assigned {\n  background: rgba(34, 197, 94, 0.15);\n  color: #86efac;\n}\n\n/* Dark: Assign Button */\n#mobius-os-sidebar.theme-dark .sidecar-assign-btn {\n  background: rgba(37, 99, 235, 0.2);\n  border-color: rgba(37, 99, 235, 0.4);\n  color: #93c5fd;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-assign-btn:hover {\n  background: rgba(37, 99, 235, 0.3);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-assign-menu {\n  background: #252b3b;\n  border-color: rgba(255, 255, 255, 0.1);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-assign-option {\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-assign-option:hover {\n  background: rgba(255, 255, 255, 0.06);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-assign-option-hint {\n  color: rgba(148, 163, 184, 0.6);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-assign-divider {\n  background: rgba(255, 255, 255, 0.08);\n}\n\n/* Dark: Context Expander */\n#mobius-os-sidebar.theme-dark .sidecar-context-expander-arrow {\n  color: rgba(148, 163, 184, 0.6);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-context-expander-label {\n  color: rgba(148, 163, 184, 0.7);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-context-expander-content {\n  border-top-color: rgba(255, 255, 255, 0.06);\n}\n\n/* Dark: Cards Container */\n#mobius-os-sidebar.theme-dark .sidecar-cards-container {\n  background: transparent;\n}\n\n/* Dark: Brand Text */\n#mobius-os-sidebar.theme-dark .sidecar-brand-text {\n  color: #f1f5f9;\n}\n\n/* ============================================\n   BLUE THEME - All Sidecar Elements\n   ============================================ */\n\n#mobius-os-sidebar.theme-blue {\n  background: #eff6ff !important;\n  color: #1e3a5f !important;\n  border-color: rgba(37, 99, 235, 0.15) !important;\n}\n\n#mobius-os-sidebar.theme-blue .top-row {\n  background: rgba(37, 99, 235, 0.05);\n  border-bottom-color: rgba(37, 99, 235, 0.1);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-brand-text {\n  color: #1e40af;\n}\n\n/* Blue: Greeting */\n#mobius-os-sidebar.theme-blue .sidecar-greeting {\n  border-bottom-color: rgba(37, 99, 235, 0.1);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-greeting-text {\n  color: #1e3a5f;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-greeting-subtext {\n  color: #3b82f6;\n}\n\n/* Blue: Patient Row */\n#mobius-os-sidebar.theme-blue .sidecar-patient-row {\n  border-bottom-color: rgba(37, 99, 235, 0.1) !important;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-patient-row label {\n  color: #3b82f6;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-icon-btn {\n  background: rgba(37, 99, 235, 0.08);\n  border-color: rgba(37, 99, 235, 0.2);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-icon-btn svg {\n  fill: #3b82f6;\n}\n\n/* Blue: Status Bar */\n#mobius-os-sidebar.theme-blue .sidecar-status-bar {\n  background: rgba(37, 99, 235, 0.03);\n  border-bottom-color: rgba(37, 99, 235, 0.1);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-status-bar-title {\n  color: #3b82f6;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-status-bar-context {\n  color: #1e40af;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-status-bar-track {\n  background: linear-gradient(90deg, \n    rgba(37, 99, 235, 0.08) 0%, \n    rgba(37, 99, 235, 0.15) 50%, \n    rgba(37, 99, 235, 0.2) 100%);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-status-bar-progress {\n  background: rgba(37, 99, 235, 0.5);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-status-bar-marker {\n  background: #2563eb;\n  border-color: #eff6ff;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-status-bar-percent {\n  color: #1e40af;\n}\n\n/* Blue: Bottleneck Card */\n#mobius-os-sidebar.theme-blue .sidecar-bottleneck-item {\n  background: rgba(255, 255, 255, 0.7);\n  border-color: rgba(37, 99, 235, 0.15);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-bottleneck-question {\n  color: #1e3a5f;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-bottleneck-count {\n  color: #1e40af;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-bottleneck-hint {\n  color: #3b82f6;\n}\n\n/* Blue: Answer Buttons */\n#mobius-os-sidebar.theme-blue .sidecar-answer-btn {\n  background: rgba(37, 99, 235, 0.08) !important;\n  background-color: rgba(37, 99, 235, 0.08) !important;\n  border-color: rgba(37, 99, 235, 0.15) !important;\n  color: #3b82f6 !important;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-answer-btn:hover {\n  background: rgba(37, 99, 235, 0.12) !important;\n  background-color: rgba(37, 99, 235, 0.12) !important;\n  border-color: rgba(37, 99, 235, 0.25) !important;\n  color: #1e40af !important;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-answer-btn--selected,\n#mobius-os-sidebar.theme-blue .sidecar-answer-btn.sidecar-answer-btn--selected {\n  background: rgba(37, 99, 235, 0.2) !important;\n  background-color: rgba(37, 99, 235, 0.2) !important;\n  border-color: rgba(37, 99, 235, 0.4) !important;\n  color: #1d4ed8 !important;\n}\n\n/* Blue: Note Input */\n#mobius-os-sidebar.theme-blue .sidecar-bottleneck-note-row {\n  border-top-color: rgba(37, 99, 235, 0.1);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-bottleneck-note-input {\n  background: #ffffff;\n  border-color: #bfdbfe;\n}\n\n/* Blue: Mobius Tip */\n#mobius-os-sidebar.theme-blue .sidecar-bottleneck-mobius-tip {\n  background: rgba(37, 99, 235, 0.1);\n  color: #1e40af;\n}\n\n/* Blue: Assign Button */\n#mobius-os-sidebar.theme-blue .sidecar-assign-btn {\n  background: #2563eb;\n  border-color: #1d4ed8;\n  color: #ffffff;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-assign-btn:hover {\n  background: #1d4ed8;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-assign-menu {\n  background: #ffffff;\n  border-color: rgba(37, 99, 235, 0.2);\n}\n\n/* Blue: Context Expander */\n#mobius-os-sidebar.theme-blue .sidecar-context-expander-toggle:hover {\n  background: rgba(37, 99, 235, 0.06);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-context-expander-arrow {\n  color: #3b82f6;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-context-expander-label {\n  color: #3b82f6;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-context-expander-content {\n  border-top-color: rgba(37, 99, 235, 0.1);\n}\n\n/* Blue: Menu */\n#mobius-os-sidebar.theme-blue .sidecar-menu-btn,\n#mobius-os-sidebar.theme-blue .sidecar-collapse-btn,\n#mobius-os-sidebar.theme-blue .sidecar-alert-indicator {\n  background: rgba(37, 99, 235, 0.08);\n  border-color: rgba(37, 99, 235, 0.2);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-menu-btn svg,\n#mobius-os-sidebar.theme-blue .sidecar-collapse-btn svg,\n#mobius-os-sidebar.theme-blue .sidecar-alert-icon svg {\n  fill: #3b82f6;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-menu-dropdown,\n#mobius-os-sidebar.theme-blue .sidecar-menu-submenu {\n  background: #ffffff;\n  border-color: rgba(37, 99, 235, 0.15);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-menu-item {\n  color: #1e3a5f;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-menu-item:hover {\n  background: rgba(37, 99, 235, 0.08);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-menu-icon svg {\n  fill: #3b82f6;\n}\n\n/* Blue: Quick Chat */\n#mobius-os-sidebar.theme-blue .sidecar-quick-chat {\n  background: rgba(255, 255, 255, 0.7);\n  border-top-color: rgba(37, 99, 235, 0.1);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-quick-chat-input {\n  background: #ffffff;\n  border-color: #bfdbfe;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-quick-chat-input:focus {\n  border-color: #3b82f6;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-quick-chat-send svg {\n  fill: #3b82f6;\n}\n\n/* =============================================================================\n * MINI RECOMMENDATION UI (Workflow Mode)\n * =============================================================================\n */\n\n/* Recommendation UI - matches Mini row structure */\n#mobius-os-mini .mobius-mini-task-badge-row .mobius-mini-recommendation {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n  flex: 1;\n  min-width: 0;\n}\n\n#mobius-os-mini .mobius-mini-recommendation-text {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  font-size: 9px;\n  font-weight: 500;\n  color: #0b1220;\n  line-height: 1.35;\n}\n\n#mobius-os-mini .mobius-mini-rec-message {\n  font-style: italic;\n  color: #0b1220;\n  font-weight: 500;\n}\n\n#mobius-os-mini .mobius-mini-rec-confidence {\n  font-size: 8px;\n  font-weight: 500;\n  color: rgba(91, 102, 122, 0.85);\n}\n\n#mobius-os-mini .mobius-mini-recommendation-actions {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-top: 2px;\n}\n\n#mobius-os-mini .mobius-mini-accept-btn {\n  padding: 3px 8px;\n  font-size: 8px;\n  font-weight: 600;\n  background: #64748b;\n  color: #ffffff;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n  line-height: 1.2;\n  flex-shrink: 0;\n}\n\n#mobius-os-mini .mobius-mini-accept-btn:hover {\n  background: #475569;\n}\n\n#mobius-os-mini .mobius-mini-accept-btn.mobius-mini-btn-active,\n#mobius-os-mini .mobius-mini-accept-btn:active {\n  background: #475569;\n  transform: scale(0.98);\n  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.1);\n}\n\n#mobius-os-mini .mobius-mini-accept-btn:disabled {\n  opacity: 0.6;\n  cursor: not-allowed;\n}\n\n/* Delegated state - shows green check */\n#mobius-os-mini .mobius-mini-accept-btn.delegated {\n  background: #10b981;\n  color: #ffffff;\n  cursor: default;\n}\n\n#mobius-os-mini .mobius-mini-accept-btn.delegated:hover {\n  background: #10b981;\n}\n\n#mobius-os-mini .mobius-mini-accept-btn.delegated::before {\n  content: '✓ ';\n  font-weight: bold;\n}\n\n#mobius-os-mini .mobius-mini-review-btn {\n  padding: 3px 8px;\n  font-size: 8px;\n  font-weight: 500;\n  background: transparent;\n  color: #64748b;\n  border: 1px solid rgba(11, 18, 32, 0.15);\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n  line-height: 1.2;\n  display: flex;\n  align-items: center;\n  gap: 2px;\n  flex-shrink: 0;\n}\n\n#mobius-os-mini .mobius-mini-review-btn:hover {\n  background: rgba(11, 18, 32, 0.08);\n  border-color: rgba(11, 18, 32, 0.2);\n}\n\n#mobius-os-mini .mobius-mini-review-btn.mobius-mini-btn-active,\n#mobius-os-mini .mobius-mini-review-btn:active {\n  background: rgba(11, 18, 32, 0.12);\n  border-color: rgba(11, 18, 32, 0.25);\n  transform: scale(0.98);\n  box-shadow: inset 0 1px 2px rgba(0, 0, 0, 0.08);\n}\n\n/* =============================================================================\n * SIDECAR WORKFLOW MODE SELECTOR\n * =============================================================================\n */\n\n/* Override row */\n.sidecar-workflow-override-row {\n  display: flex;\n  justify-content: flex-end;\n  padding: 4px 0;\n  margin-bottom: 4px;\n}\n\n.sidecar-workflow-override-btn {\n  font-size: 10px;\n  color: #80868b;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  padding: 2px 6px;\n  border-radius: 3px;\n  transition: all 0.15s ease;\n}\n\n.sidecar-workflow-override-btn:hover {\n  background: rgba(0, 0, 0, 0.04);\n  color: #5f6368;\n}\n\n/* Problem statement */\n.sidecar-workflow-problem {\n  font-size: 13px;\n  font-weight: 500;\n  color: #0b1220;\n  line-height: 1.4;\n  margin-bottom: 8px;\n}\n\n/* Recommendation message */\n.sidecar-workflow-recommendation {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 8px 10px;\n  background: rgba(26, 115, 232, 0.06);\n  border-radius: 6px;\n  margin-bottom: 12px;\n}\n\n.sidecar-workflow-rec-icon {\n  color: #1a73e8;\n  font-size: 12px;\n}\n\n.sidecar-workflow-rec-text {\n  font-size: 11px;\n  color: #1a73e8;\n  font-style: italic;\n}\n\n/* Mode selector */\n.sidecar-workflow-mode-selector {\n  display: flex;\n  gap: 8px;\n  margin-bottom: 12px;\n}\n\n.sidecar-workflow-mode-btn {\n  flex: 1;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 6px;\n  padding: 8px 12px;\n  font-size: 11px;\n  font-weight: 500;\n  color: #5f6368;\n  background: #f8f9fa;\n  border: 1px solid rgba(0, 0, 0, 0.08);\n  border-radius: 6px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.sidecar-workflow-mode-btn:hover {\n  background: #f1f3f4;\n  border-color: rgba(0, 0, 0, 0.12);\n}\n\n.sidecar-workflow-mode-btn--selected {\n  background: rgba(26, 115, 232, 0.08);\n  border-color: rgba(26, 115, 232, 0.3);\n  color: #1a73e8;\n}\n\n.sidecar-workflow-mode-radio {\n  font-size: 10px;\n  line-height: 1;\n}\n\n.sidecar-workflow-mode-label {\n  font-size: 11px;\n}\n\n/* Divider */\n.sidecar-workflow-divider {\n  height: 1px;\n  background: rgba(0, 0, 0, 0.06);\n  margin: 8px 0;\n}\n\n/* Content area */\n.sidecar-workflow-content {\n  min-height: 60px;\n}\n\n.sidecar-workflow-prompt {\n  padding: 16px;\n  text-align: center;\n  color: #80868b;\n  font-size: 11px;\n  font-style: italic;\n}\n\n/* Mobius handle content */\n.sidecar-workflow-mobius-content {\n  padding: 12px;\n  background: rgba(26, 115, 232, 0.04);\n  border-radius: 6px;\n}\n\n.sidecar-workflow-mobius-message {\n  font-size: 12px;\n  color: #3c4043;\n  margin-bottom: 8px;\n}\n\n.sidecar-workflow-mobius-actions {\n  font-size: 11px;\n  color: #5f6368;\n}\n\n.sidecar-workflow-mobius-actions-label {\n  font-weight: 500;\n  display: block;\n  margin-bottom: 4px;\n}\n\n.sidecar-workflow-mobius-actions-list {\n  margin: 0;\n  padding-left: 16px;\n  list-style-type: disc;\n}\n\n.sidecar-workflow-mobius-actions-list li {\n  margin-bottom: 2px;\n}\n\n/* Together/Manual content */\n.sidecar-workflow-together-content,\n.sidecar-workflow-manual-content {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n}\n\n.sidecar-workflow-manual-message {\n  font-size: 11px;\n  color: #5f6368;\n  font-style: italic;\n}\n\n/* Option groups */\n.sidecar-workflow-option-group {\n  background: #f8f9fa;\n  border-radius: 6px;\n  padding: 10px;\n}\n\n.sidecar-workflow-option-group-header {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  margin-bottom: 8px;\n}\n\n.sidecar-workflow-option-group-icon {\n  font-size: 11px;\n}\n\n.sidecar-workflow-option-group-title {\n  font-size: 11px;\n  font-weight: 500;\n  color: #3c4043;\n}\n\n/* Options list */\n.sidecar-workflow-options-list {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n\n.sidecar-workflow-option {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 6px 8px;\n  background: #ffffff;\n  border: 1px solid rgba(0, 0, 0, 0.06);\n  border-radius: 4px;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n.sidecar-workflow-option:hover {\n  background: #f1f3f4;\n}\n\n.sidecar-workflow-option-checkbox {\n  width: 14px;\n  height: 14px;\n  margin: 0;\n  cursor: pointer;\n}\n\n.sidecar-workflow-option-checkbox:disabled {\n  cursor: not-allowed;\n  opacity: 0.6;\n}\n\n.sidecar-workflow-option-checkbox:disabled + .sidecar-workflow-option-label {\n  opacity: 0.7;\n  color: rgba(0, 0, 0, 0.6);\n}\n\n.sidecar-workflow-mobius-options {\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px solid rgba(0, 0, 0, 0.08);\n}\n\n.sidecar-workflow-option-label {\n  font-size: 11px;\n  color: #3c4043;\n}\n\n/* Note row */\n.sidecar-workflow-note-row {\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px solid rgba(0, 0, 0, 0.06);\n}\n\n.sidecar-workflow-note-wrap {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n}\n\n.sidecar-workflow-note-input {\n  flex: 1;\n  padding: 6px 10px;\n  font-size: 11px;\n  border: 1px solid rgba(0, 0, 0, 0.1);\n  border-radius: 4px;\n  background: #ffffff;\n  outline: none;\n  transition: border-color 0.15s ease;\n}\n\n.sidecar-workflow-note-input:focus {\n  border-color: rgba(26, 115, 232, 0.4);\n}\n\n.sidecar-workflow-note-input::placeholder {\n  color: #80868b;\n}\n\n.sidecar-workflow-note-send {\n  width: 28px;\n  height: 28px;\n  padding: 0;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  background: transparent;\n  border: none;\n  cursor: pointer;\n  border-radius: 4px;\n  transition: background 0.15s ease;\n}\n\n.sidecar-workflow-note-send:hover {\n  background: rgba(0, 0, 0, 0.04);\n}\n\n.sidecar-workflow-note-send svg {\n  width: 16px;\n  height: 16px;\n  fill: #5f6368;\n}\n\n/* Resolve Override Modal */\n.sidecar-resolve-modal {\n  position: fixed;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  z-index: 10001;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n}\n\n.sidecar-resolve-modal-backdrop {\n  position: absolute;\n  top: 0;\n  left: 0;\n  right: 0;\n  bottom: 0;\n  background: rgba(0, 0, 0, 0.4);\n}\n\n.sidecar-resolve-modal-content {\n  position: relative;\n  width: 320px;\n  background: #ffffff;\n  border-radius: 8px;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n  overflow: hidden;\n}\n\n.sidecar-resolve-modal-header {\n  padding: 12px 16px;\n  font-size: 13px;\n  font-weight: 600;\n  color: #0b1220;\n  border-bottom: 1px solid rgba(0, 0, 0, 0.08);\n}\n\n.sidecar-resolve-modal-body {\n  padding: 16px;\n}\n\n.sidecar-resolve-modal-body p {\n  margin: 0 0 12px 0;\n  font-size: 12px;\n  color: #5f6368;\n}\n\n.sidecar-resolve-modal-textarea {\n  width: 100%;\n  padding: 10px;\n  font-size: 12px;\n  font-family: inherit;\n  border: 1px solid rgba(0, 0, 0, 0.15);\n  border-radius: 6px;\n  resize: vertical;\n  outline: none;\n}\n\n.sidecar-resolve-modal-textarea:focus {\n  border-color: rgba(26, 115, 232, 0.5);\n}\n\n.sidecar-resolve-modal-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 8px;\n  padding: 12px 16px;\n  border-top: 1px solid rgba(0, 0, 0, 0.08);\n  background: #f8f9fa;\n}\n\n.sidecar-resolve-modal-cancel {\n  padding: 6px 14px;\n  font-size: 12px;\n  font-weight: 500;\n  color: #5f6368;\n  background: transparent;\n  border: 1px solid rgba(0, 0, 0, 0.1);\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n.sidecar-resolve-modal-cancel:hover {\n  background: rgba(0, 0, 0, 0.04);\n}\n\n.sidecar-resolve-modal-confirm {\n  padding: 6px 14px;\n  font-size: 12px;\n  font-weight: 500;\n  color: #ffffff;\n  background: #1a73e8;\n  border: none;\n  border-radius: 4px;\n  cursor: pointer;\n}\n\n.sidecar-resolve-modal-confirm:hover {\n  background: #1557b0;\n}\n\n/* =============================================================================\n * THEME OVERRIDES FOR WORKFLOW MODE\n * =============================================================================\n */\n\n/* Dark theme */\n#mobius-os-sidebar.theme-dark .sidecar-workflow-problem {\n  color: #e8eaed;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-recommendation {\n  background: rgba(138, 180, 248, 0.1);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-rec-icon,\n#mobius-os-sidebar.theme-dark .sidecar-workflow-rec-text {\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-mode-btn {\n  background: rgba(255, 255, 255, 0.05);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #9aa0a6;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-mode-btn:hover {\n  background: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-mode-btn--selected {\n  background: rgba(138, 180, 248, 0.15);\n  border-color: rgba(138, 180, 248, 0.3);\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-divider {\n  background: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-mobius-content {\n  background: rgba(138, 180, 248, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-mobius-message {\n  color: #e8eaed;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-option-group {\n  background: rgba(255, 255, 255, 0.05);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-option {\n  background: rgba(255, 255, 255, 0.03);\n  border-color: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-option:hover {\n  background: rgba(255, 255, 255, 0.06);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-option-label {\n  color: #e8eaed;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-note-input {\n  background: rgba(255, 255, 255, 0.05);\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #e8eaed;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-workflow-note-send svg {\n  fill: #9aa0a6;\n}\n\n/* Glass theme */\n#mobius-os-sidebar.theme-glass .sidecar-workflow-mode-btn {\n  background: rgba(255, 255, 255, 0.4);\n}\n\n#mobius-os-sidebar.theme-glass .sidecar-workflow-mode-btn--selected {\n  background: rgba(26, 115, 232, 0.15);\n}\n\n#mobius-os-sidebar.theme-glass .sidecar-workflow-option-group {\n  background: rgba(255, 255, 255, 0.4);\n}\n\n#mobius-os-sidebar.theme-glass .sidecar-workflow-option {\n  background: rgba(255, 255, 255, 0.6);\n}\n\n/* Blue theme */\n#mobius-os-sidebar.theme-blue .sidecar-workflow-recommendation {\n  background: rgba(37, 99, 235, 0.1);\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-workflow-rec-icon,\n#mobius-os-sidebar.theme-blue .sidecar-workflow-rec-text {\n  color: #2563eb;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-workflow-mode-btn--selected {\n  background: rgba(37, 99, 235, 0.12);\n  border-color: rgba(37, 99, 235, 0.3);\n  color: #2563eb;\n}\n\n#mobius-os-sidebar.theme-blue .sidecar-workflow-mobius-content {\n  background: rgba(37, 99, 235, 0.06);\n}\n\n/* =============================================================================\n * MANUAL MODE TASK CARDS WITH DROPDOWNS\n * ============================================================================= */\n\n.sidecar-manual-tasks-container {\n  display: flex;\n  flex-direction: column;\n  gap: 12px;\n  margin-top: 12px;\n}\n\n.sidecar-manual-task-card {\n  padding: 12px;\n  border: 1px solid rgba(0, 0, 0, 0.1);\n  border-radius: 6px;\n  background: #ffffff;\n}\n\n.sidecar-manual-task-question {\n  font-size: 12px;\n  font-weight: 500;\n  color: #1e293b;\n  margin-bottom: 8px;\n  line-height: 1.4;\n}\n\n.sidecar-manual-task-dropdown-wrap {\n  margin-top: 8px;\n}\n\n.sidecar-manual-task-dropdown {\n  width: 100%;\n  padding: 6px 10px;\n  font-size: 11px;\n  border: 1px solid rgba(0, 0, 0, 0.15);\n  border-radius: 4px;\n  background: #ffffff;\n  color: #1e293b;\n  cursor: pointer;\n  outline: none;\n  transition: border-color 0.15s ease;\n}\n\n.sidecar-manual-task-dropdown:hover:not(:disabled) {\n  border-color: rgba(0, 0, 0, 0.25);\n}\n\n.sidecar-manual-task-dropdown:focus {\n  border-color: rgba(26, 115, 232, 0.4);\n  box-shadow: 0 0 0 2px rgba(26, 115, 232, 0.1);\n}\n\n.sidecar-manual-task-dropdown--answered {\n  border-color: rgba(37, 99, 235, 0.3);\n  background: rgba(37, 99, 235, 0.03);\n}\n\n.sidecar-manual-task-card--answered {\n  border-color: rgba(37, 99, 235, 0.2);\n  background: rgba(37, 99, 235, 0.02);\n}\n\n.sidecar-manual-task-dropdown--answered {\n  border-color: rgba(37, 99, 235, 0.3);\n  background: rgba(37, 99, 235, 0.03);\n}\n\n.sidecar-manual-task-card--answered {\n  border-color: rgba(37, 99, 235, 0.2);\n  background: rgba(37, 99, 235, 0.02);\n}\n\n.sidecar-manual-task-card--resolved {\n  border-color: rgba(22, 163, 74, 0.3);\n  background: rgba(22, 163, 74, 0.05);\n  opacity: 0.8;\n}\n\n.sidecar-manual-task-dropdown:disabled,\n.sidecar-manual-task-dropdown--resolved {\n  background: rgba(22, 163, 74, 0.05);\n  border-color: rgba(22, 163, 74, 0.2);\n  color: #16a34a;\n  cursor: not-allowed;\n}\n\n.sidecar-manual-task-dropdown option {\n  padding: 4px;\n}\n\n/* Dark theme */\n#mobius-os-sidebar.theme-dark .sidecar-manual-task-card {\n  background: rgba(255, 255, 255, 0.05);\n  border-color: rgba(255, 255, 255, 0.1);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-manual-task-question {\n  color: #e8eaed;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-manual-task-dropdown {\n  background: rgba(255, 255, 255, 0.05);\n  border-color: rgba(255, 255, 255, 0.15);\n  color: #e8eaed;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-manual-task-dropdown:focus {\n  border-color: rgba(138, 180, 248, 0.4);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-manual-task-dropdown--answered {\n  border-color: rgba(138, 180, 248, 0.3);\n  background: rgba(138, 180, 248, 0.05);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-manual-task-card--answered {\n  border-color: rgba(138, 180, 248, 0.2);\n  background: rgba(138, 180, 248, 0.03);\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-manual-task-card--resolved {\n  border-color: rgba(22, 163, 74, 0.3);\n  background: rgba(22, 163, 74, 0.1);\n  opacity: 0.8;\n}\n\n#mobius-os-sidebar.theme-dark .sidecar-manual-task-dropdown:disabled {\n  background: rgba(22, 163, 74, 0.1);\n  border-color: rgba(22, 163, 74, 0.3);\n  color: #4ade80;\n}\n\n/* =============================================================================\n   Factor-based Sidecar (NEW - Simplified Design)\n   ============================================================================= */\n\n/* Factor List Container */\n#mobius-os-sidebar .factor-list {\n  padding: 8px 14px;\n}\n\n#mobius-os-sidebar .factor-separator {\n  height: 1px;\n  background: rgba(60, 64, 67, 0.12);\n  margin: 4px 0;\n}\n\n/* Factor Card */\n#mobius-os-sidebar .factor-card {\n  border-radius: 6px;\n  padding: 6px 10px;\n  margin: 3px 0;\n  transition: all 0.2s ease;\n}\n\n#mobius-os-sidebar .factor-card.factor-focus {\n  border: 1px solid #1a73e8;\n  background: rgba(26, 115, 232, 0.04);\n}\n\n#mobius-os-sidebar .factor-card.collapsed {\n  cursor: pointer;\n}\n\n#mobius-os-sidebar .factor-card.collapsed:hover {\n  background: rgba(60, 64, 67, 0.04);\n}\n\n/* Factor Header */\n#mobius-os-sidebar .factor-header {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  cursor: pointer;\n  padding: 2px 0;\n}\n\n#mobius-os-sidebar .factor-status-icon {\n  font-size: 11px;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .factor-label {\n  font-weight: 500;\n  font-size: 11px;\n  color: #0b1220;\n}\n\n#mobius-os-sidebar .factor-status-label {\n  font-size: 10px;\n  color: #5f6368;\n}\n\n/* Status label prominence hierarchy */\n#mobius-os-sidebar .factor-status-label.status-needs-help {\n  font-weight: 600;\n  color: #d97706;\n}\n\n#mobius-os-sidebar .factor-status-label.status-almost {\n  font-weight: 500;\n  color: #6b7280;\n}\n\n#mobius-os-sidebar .factor-status-label.status-good {\n  font-weight: 400;\n  color: rgba(91, 102, 122, 0.6);\n}\n\n/* User resolved badge (separate from system confidence) */\n#mobius-os-sidebar .factor-resolved-badge {\n  font-size: 8px;\n  font-weight: 500;\n  color: #9333ea;\n  background: rgba(147, 51, 234, 0.1);\n  padding: 2px 5px;\n  border-radius: 3px;\n  margin-left: 4px;\n}\n\n/* User flagged badge (user marked as needing work) */\n#mobius-os-sidebar .factor-flagged-badge {\n  font-size: 8px;\n  font-weight: 500;\n  color: #ea580c;\n  background: rgba(234, 88, 12, 0.1);\n  padding: 2px 5px;\n  border-radius: 3px;\n  margin-left: 4px;\n}\n\n/* User flagged styling for factor card */\n#mobius-os-sidebar .factor-card.factor-user-flagged {\n  border-color: rgba(234, 88, 12, 0.3);\n  background: rgba(234, 88, 12, 0.04);\n}\n\n#mobius-os-sidebar .factor-focus-badge {\n  font-size: 9px;\n  font-weight: 500;\n  color: #1a73e8;\n  margin-left: auto;\n  background: rgba(26, 115, 232, 0.1);\n  padding: 2px 5px;\n  border-radius: 3px;\n}\n\n/* User Override Badge - shows when user manually resolved */\n#mobius-os-sidebar .factor-override-badge {\n  font-size: 9px;\n  font-weight: 500;\n  color: #9333ea;\n  margin-left: auto;\n  background: rgba(147, 51, 234, 0.1);\n  padding: 2px 5px;\n  border-radius: 3px;\n}\n\n/* User Override Factor Card styling */\n#mobius-os-sidebar .factor-card.factor-user-override {\n  border: 1px solid #9333ea;\n  background: rgba(147, 51, 234, 0.04);\n}\n\n#mobius-os-sidebar .factor-card.factor-user-override .factor-status-icon {\n  color: #9333ea;\n}\n\n#mobius-os-sidebar .factor-card.factor-user-override .factor-status-label {\n  color: #9333ea;\n}\n\n#mobius-os-sidebar .factor-mode-indicator {\n  font-size: 10px;\n  margin-left: auto;\n}\n\n/* Status dropdown (Mini-style) in header */\n#mobius-os-sidebar .factor-status-dropdown {\n  position: relative;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .factor-status-dropdown-btn {\n  padding: 2px 6px;\n  border-radius: 4px;\n  border: 1px solid rgba(107, 114, 128, 0.3);\n  background: rgba(107, 114, 128, 0.08);\n  color: #6b7280;\n  font-size: 9px;\n  cursor: pointer;\n  white-space: nowrap;\n  transition: all 0.15s ease;\n}\n\n#mobius-os-sidebar .factor-status-dropdown-btn:hover {\n  background: rgba(107, 114, 128, 0.15);\n  border-color: rgba(107, 114, 128, 0.5);\n}\n\n#mobius-os-sidebar .factor-status-dropdown-btn.is-resolved {\n  border-color: rgba(147, 51, 234, 0.3);\n  background: rgba(147, 51, 234, 0.08);\n  color: #9333ea;\n}\n\n#mobius-os-sidebar .factor-status-dropdown-btn.is-resolved:hover {\n  background: rgba(147, 51, 234, 0.15);\n  border-color: rgba(147, 51, 234, 0.5);\n}\n\n#mobius-os-sidebar .factor-status-dropdown-btn.is-flagged {\n  border-color: rgba(234, 88, 12, 0.3);\n  background: rgba(234, 88, 12, 0.08);\n  color: #ea580c;\n}\n\n#mobius-os-sidebar .factor-status-dropdown-btn.is-flagged:hover {\n  background: rgba(234, 88, 12, 0.15);\n  border-color: rgba(234, 88, 12, 0.5);\n}\n\n#mobius-os-sidebar .factor-status-menu {\n  position: absolute;\n  top: calc(100% + 4px);\n  right: 0;\n  background: white;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n  z-index: 1000;\n  min-width: 120px;\n  padding: 4px 0;\n}\n\n#mobius-os-sidebar .factor-status-option {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  width: 100%;\n  padding: 6px 10px;\n  border: none;\n  background: transparent;\n  cursor: pointer;\n  text-align: left;\n  font-size: 11px;\n  color: #374151;\n  transition: background 0.1s;\n}\n\n#mobius-os-sidebar .factor-status-option:hover {\n  background: #f3f4f6;\n}\n\n#mobius-os-sidebar .factor-status-option.selected {\n  background: #f0fdf4;\n  color: #16a34a;\n}\n\n#mobius-os-sidebar .factor-status-option .opt-icon {\n  font-size: 12px;\n}\n\n#mobius-os-sidebar .factor-status-option .opt-label {\n  font-weight: 500;\n}\n\n#mobius-os-sidebar .factor-expand-icon {\n  font-size: 8px;\n  color: #5f6368;\n  margin-left: auto;\n}\n\n#mobius-os-sidebar .factor-focus .factor-expand-icon {\n  margin-left: 8px;\n}\n\n/* Factor Content (expanded) */\n#mobius-os-sidebar .factor-content {\n  margin-top: 12px;\n  padding-top: 12px;\n  border-top: 1px solid rgba(60, 64, 67, 0.08);\n}\n\n/* Mode Row - compact recommendation + dropdown */\n#mobius-os-sidebar .factor-mode-row {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 6px;\n  margin-bottom: 6px;\n}\n\n#mobius-os-sidebar .factor-mode-hint {\n  font-size: 9px;\n  color: rgba(91, 102, 122, 0.85);\n}\n\n#mobius-os-sidebar .factor-mode-hint strong {\n  font-weight: 600;\n  color: #374151;\n}\n\n/* Mode Dropdown */\n#mobius-os-sidebar .factor-mode-dropdown {\n  position: relative;\n}\n\n#mobius-os-sidebar .factor-mode-dropdown-btn {\n  padding: 4px 8px;\n  border: 1px solid rgba(60, 64, 67, 0.2);\n  border-radius: 4px;\n  background: white;\n  font-size: 9px;\n  font-weight: 500;\n  color: rgba(91, 102, 122, 0.8);\n  cursor: pointer;\n  transition: all 0.15s ease;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n\n#mobius-os-sidebar .factor-mode-dropdown-btn:hover {\n  border-color: #1a73e8;\n  color: #1a73e8;\n}\n\n#mobius-os-sidebar .factor-mode-dropdown-btn.has-selection {\n  background: rgba(26, 115, 232, 0.08);\n  border-color: rgba(26, 115, 232, 0.3);\n  color: #1a73e8;\n}\n\n#mobius-os-sidebar .factor-mode-dropdown-btn .dropdown-arrow {\n  font-size: 8px;\n  opacity: 0.6;\n}\n\n#mobius-os-sidebar .factor-mode-dropdown-menu {\n  position: absolute;\n  top: 100%;\n  right: 0;\n  margin-top: 2px;\n  background: white;\n  border: 1px solid rgba(60, 64, 67, 0.15);\n  border-radius: 4px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);\n  z-index: 100;\n  min-width: 90px;\n  overflow: hidden;\n}\n\n#mobius-os-sidebar .factor-mode-option {\n  padding: 5px 8px;\n  font-size: 9px;\n  color: #374151;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  transition: background 0.1s ease;\n  white-space: nowrap;\n}\n\n#mobius-os-sidebar .factor-mode-option:hover {\n  background: rgba(26, 115, 232, 0.06);\n}\n\n#mobius-os-sidebar .factor-mode-option.selected {\n  background: rgba(26, 115, 232, 0.1);\n  color: #1a73e8;\n  font-weight: 500;\n}\n\n#mobius-os-sidebar .factor-mode-option.recommended::after {\n  content: '★';\n  font-size: 8px;\n  color: #f59e0b;\n  margin-left: auto;\n}\n\n/* Select prompt when no mode chosen */\n#mobius-os-sidebar .factor-select-prompt {\n  font-size: 9px;\n  font-style: italic;\n  color: rgba(91, 102, 122, 0.6);\n  text-align: center;\n  padding: 8px;\n}\n\n/* Override/Resolve row - same pattern as Mini */\n#mobius-os-sidebar .factor-override-row {\n  margin-top: 8px;\n  padding-top: 8px;\n  border-top: 1px solid rgba(11, 18, 32, 0.06);\n  display: flex;\n  justify-content: flex-end;\n}\n\n#mobius-os-sidebar .factor-override-btn {\n  font-size: 9px;\n  font-weight: 500;\n  padding: 4px 8px;\n  border-radius: 4px;\n  border: none;\n  cursor: pointer;\n  transition: all 0.15s ease;\n}\n\n#mobius-os-sidebar .factor-override-resolve {\n  background: rgba(34, 197, 94, 0.1);\n  color: #16a34a;\n}\n\n#mobius-os-sidebar .factor-override-resolve:hover {\n  background: rgba(34, 197, 94, 0.2);\n}\n\n#mobius-os-sidebar .factor-override-undo {\n  background: rgba(107, 114, 128, 0.1);\n  color: #6b7280;\n}\n\n#mobius-os-sidebar .factor-override-undo:hover {\n  background: rgba(107, 114, 128, 0.2);\n}\n\n/* Factor Steps - Compact single-line layout */\n#mobius-os-sidebar .factor-steps {\n  display: flex;\n  flex-direction: column;\n  gap: 4px;\n}\n\n#mobius-os-sidebar .factor-step {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  gap: 6px;\n  padding: 4px 6px;\n  border-radius: 4px;\n  background: rgba(60, 64, 67, 0.03);\n  min-height: 24px;\n}\n\n#mobius-os-sidebar .factor-step.step-done {\n  opacity: 0.5;\n}\n\n#mobius-os-sidebar .factor-step.step-current {\n  background: rgba(26, 115, 232, 0.06);\n}\n\n/* Step left side: icon + label */\n#mobius-os-sidebar .step-left {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  flex: 1;\n  min-width: 0;\n  overflow: hidden;\n}\n\n#mobius-os-sidebar .step-icon {\n  font-size: 10px;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .step-number {\n  font-size: 10px;\n  font-weight: 600;\n  color: #5f6368;\n  flex-shrink: 0;\n  min-width: 14px;\n}\n\n#mobius-os-sidebar .step-label {\n  font-size: 10px;\n  color: #202124;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n/* Step right side: status or buttons */\n#mobius-os-sidebar .step-right {\n  display: flex;\n  align-items: center;\n  gap: 4px;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .step-status {\n  font-size: 9px;\n  color: #9aa0a6;\n}\n\n#mobius-os-sidebar .step-status-done,\n#mobius-os-sidebar .step-status-answered {\n  color: #16a34a;\n  max-width: 120px;\n  overflow: hidden;\n  text-overflow: ellipsis;\n  white-space: nowrap;\n}\n\n#mobius-os-sidebar .step-status-skipped {\n  color: #9ca3af;\n  font-style: italic;\n}\n\n/* Step Action Buttons - compact inline */\n#mobius-os-sidebar .step-btn {\n  padding: 2px 6px;\n  border-radius: 3px;\n  font-size: 9px;\n  font-weight: 500;\n  border: none;\n  cursor: pointer;\n  transition: all 0.1s ease;\n}\n\n#mobius-os-sidebar .step-btn.done-btn {\n  background: #1a73e8;\n  color: white;\n}\n\n#mobius-os-sidebar .step-btn.done-btn:hover {\n  background: #1557b0;\n}\n\n#mobius-os-sidebar .step-btn.skip-btn {\n  background: transparent;\n  color: #5f6368;\n  border: 1px solid rgba(60, 64, 67, 0.2);\n}\n\n#mobius-os-sidebar .step-btn.skip-btn:hover {\n  background: rgba(60, 64, 67, 0.08);\n}\n\n#mobius-os-sidebar .step-btn.delegate-btn {\n  background: transparent;\n  color: #1a73e8;\n  border: 1px solid rgba(26, 115, 232, 0.2);\n}\n\n#mobius-os-sidebar .step-btn.delegate-btn:hover {\n  background: rgba(26, 115, 232, 0.08);\n}\n\n/* Step Done dropdown container */\n#mobius-os-sidebar .step-done-container {\n  position: relative;\n}\n\n#mobius-os-sidebar .step-answer-menu {\n  position: absolute;\n  top: calc(100% + 2px);\n  right: 0;\n  background: white;\n  border: 1px solid #e2e8f0;\n  border-radius: 4px;\n  box-shadow: 0 2px 8px rgba(0, 0, 0, 0.12);\n  z-index: 100;\n  min-width: 140px;\n  max-width: 200px;\n  padding: 2px 0;\n}\n\n#mobius-os-sidebar .step-answer-option {\n  padding: 6px 10px;\n  font-size: 10px;\n  color: #374151;\n  cursor: pointer;\n  white-space: nowrap;\n  overflow: hidden;\n  text-overflow: ellipsis;\n}\n\n#mobius-os-sidebar .step-answer-option:hover {\n  background: #f3f4f6;\n}\n\n/* Evidence Link */\n#mobius-os-sidebar .factor-evidence-link {\n  margin-top: 12px;\n  font-size: 11px;\n  color: #1a73e8;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  gap: 4px;\n}\n\n#mobius-os-sidebar .factor-evidence-link:hover {\n  text-decoration: underline;\n}\n\n#mobius-os-sidebar .evidence-icon {\n  font-size: 12px;\n}\n\n/* User Remedies Section */\n#mobius-os-sidebar .factor-remedies {\n  margin-top: 12px;\n  padding-top: 8px;\n  border-top: 1px solid #e5e7eb;\n}\n\n#mobius-os-sidebar .remedies-list {\n  margin-bottom: 8px;\n}\n\n#mobius-os-sidebar .remedy-item {\n  display: flex;\n  align-items: flex-start;\n  gap: 6px;\n  padding: 4px 0;\n  font-size: 10px;\n  color: #6b7280;\n}\n\n#mobius-os-sidebar .remedy-item.remedy-worked .remedy-icon {\n  color: #16a34a;\n}\n\n#mobius-os-sidebar .remedy-item.remedy-partial .remedy-icon {\n  color: #f59e0b;\n}\n\n#mobius-os-sidebar .remedy-item.remedy-failed .remedy-icon {\n  color: #dc2626;\n}\n\n#mobius-os-sidebar .remedy-icon {\n  font-size: 10px;\n  flex-shrink: 0;\n}\n\n#mobius-os-sidebar .remedy-text {\n  flex: 1;\n}\n\n#mobius-os-sidebar .remedy-notes {\n  color: #9ca3af;\n  font-style: italic;\n}\n\n/* Add Remedy Button */\n#mobius-os-sidebar .remedy-add-row {\n  margin-top: 4px;\n}\n\n#mobius-os-sidebar .remedy-add-btn {\n  background: none;\n  border: none;\n  color: #6b7280;\n  font-size: 10px;\n  cursor: pointer;\n  padding: 4px 0;\n}\n\n#mobius-os-sidebar .remedy-add-btn:hover {\n  color: #1a73e8;\n}\n\n/* Remedy Form */\n#mobius-os-sidebar .remedy-form {\n  background: #f9fafb;\n  border-radius: 6px;\n  padding: 8px;\n  margin-top: 4px;\n}\n\n#mobius-os-sidebar .remedy-input,\n#mobius-os-sidebar .remedy-notes-input {\n  width: 100%;\n  padding: 6px 8px;\n  border: 1px solid #e5e7eb;\n  border-radius: 4px;\n  font-size: 11px;\n  margin-bottom: 6px;\n  box-sizing: border-box;\n}\n\n#mobius-os-sidebar .remedy-input:focus,\n#mobius-os-sidebar .remedy-notes-input:focus {\n  outline: none;\n  border-color: #1a73e8;\n}\n\n#mobius-os-sidebar .remedy-outcomes {\n  display: flex;\n  gap: 4px;\n  margin-bottom: 6px;\n}\n\n#mobius-os-sidebar .outcome-btn {\n  flex: 1;\n  padding: 4px 6px;\n  border: 1px solid #e5e7eb;\n  border-radius: 4px;\n  background: white;\n  font-size: 9px;\n  cursor: pointer;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 3px;\n}\n\n#mobius-os-sidebar .outcome-btn:hover {\n  background: #f3f4f6;\n}\n\n#mobius-os-sidebar .outcome-btn.selected {\n  border-color: #1a73e8;\n  background: rgba(26, 115, 232, 0.08);\n  color: #1a73e8;\n}\n\n#mobius-os-sidebar .outcome-icon {\n  font-size: 10px;\n}\n\n#mobius-os-sidebar .remedy-btn-row {\n  display: flex;\n  justify-content: flex-end;\n  gap: 6px;\n}\n\n#mobius-os-sidebar .remedy-cancel-btn,\n#mobius-os-sidebar .remedy-submit-btn {\n  padding: 4px 10px;\n  border-radius: 4px;\n  font-size: 10px;\n  cursor: pointer;\n}\n\n#mobius-os-sidebar .remedy-cancel-btn {\n  background: white;\n  border: 1px solid #e5e7eb;\n  color: #6b7280;\n}\n\n#mobius-os-sidebar .remedy-submit-btn {\n  background: #1a73e8;\n  border: none;\n  color: white;\n}\n\n#mobius-os-sidebar .remedy-cancel-btn:hover {\n  background: #f3f4f6;\n}\n\n#mobius-os-sidebar .remedy-submit-btn:hover {\n  background: #1557b0;\n}\n\n/* Mobius Status (when Mobius is handling) */\n#mobius-os-sidebar .factor-mobius-status {\n  margin-top: 12px;\n  padding: 12px;\n  background: rgba(26, 115, 232, 0.04);\n  border-radius: 8px;\n  text-align: center;\n}\n\n#mobius-os-sidebar .mobius-handling {\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  gap: 8px;\n  margin-bottom: 4px;\n}\n\n#mobius-os-sidebar .mobius-icon {\n  font-size: 16px;\n}\n\n#mobius-os-sidebar .mobius-text {\n  font-size: 13px;\n  font-weight: 500;\n  color: #202124;\n}\n\n#mobius-os-sidebar .mobius-notify {\n  font-size: 11px;\n  color: #5f6368;\n}\n\n/* Dark theme for factors */\n#mobius-os-sidebar.theme-dark .factor-card.factor-focus {\n  border-color: #8ab4f8;\n  background: rgba(138, 180, 248, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .factor-label {\n  color: #e8eaed;\n}\n\n#mobius-os-sidebar.theme-dark .factor-status-label,\n#mobius-os-sidebar.theme-dark .factor-expand-icon {\n  color: #9aa0a6;\n}\n\n#mobius-os-sidebar.theme-dark .factor-focus-badge {\n  background: rgba(138, 180, 248, 0.15);\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .factor-content {\n  border-top-color: rgba(255, 255, 255, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .factor-mode-hint {\n  color: rgba(148, 163, 184, 0.85);\n}\n\n#mobius-os-sidebar.theme-dark .factor-mode-hint strong {\n  font-weight: 600;\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .factor-mode-dropdown-btn {\n  background: #2d2e30;\n  border-color: rgba(255, 255, 255, 0.1);\n  color: #9aa0a6;\n}\n\n#mobius-os-sidebar.theme-dark .factor-mode-dropdown-btn:hover {\n  border-color: #8ab4f8;\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .factor-mode-dropdown-btn.has-selection {\n  background: rgba(138, 180, 248, 0.15);\n  border-color: rgba(138, 180, 248, 0.3);\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .factor-mode-dropdown-menu {\n  background: #2d2e30;\n  border-color: rgba(255, 255, 255, 0.1);\n}\n\n#mobius-os-sidebar.theme-dark .factor-mode-option {\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .factor-mode-option:hover {\n  background: rgba(138, 180, 248, 0.1);\n}\n\n#mobius-os-sidebar.theme-dark .factor-mode-option.selected {\n  background: rgba(138, 180, 248, 0.15);\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .factor-select-prompt {\n  color: rgba(148, 163, 184, 0.6);\n}\n\n/* Dark theme: Status dropdown */\n#mobius-os-sidebar.theme-dark .factor-status-dropdown-btn {\n  border-color: rgba(148, 163, 184, 0.3);\n  background: rgba(148, 163, 184, 0.1);\n  color: #94a3b8;\n}\n\n#mobius-os-sidebar.theme-dark .factor-status-dropdown-btn.is-resolved {\n  border-color: rgba(168, 85, 247, 0.4);\n  background: rgba(168, 85, 247, 0.15);\n  color: #a855f7;\n}\n\n#mobius-os-sidebar.theme-dark .factor-status-menu {\n  background: #1f2937;\n  border-color: #374151;\n}\n\n#mobius-os-sidebar.theme-dark .factor-status-option {\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .factor-status-option:hover {\n  background: #374151;\n}\n\n#mobius-os-sidebar.theme-dark .factor-status-option.selected {\n  background: rgba(34, 197, 94, 0.15);\n  color: #4ade80;\n}\n\n/* Dark theme: Status label prominence */\n#mobius-os-sidebar.theme-dark .factor-status-label.status-needs-help {\n  color: #fbbf24;\n}\n\n#mobius-os-sidebar.theme-dark .factor-status-label.status-almost {\n  color: #9ca3af;\n}\n\n#mobius-os-sidebar.theme-dark .factor-status-label.status-good {\n  color: rgba(148, 163, 184, 0.5);\n}\n\n#mobius-os-sidebar.theme-dark .factor-resolved-badge {\n  color: #a855f7;\n  background: rgba(168, 85, 247, 0.15);\n}\n\n#mobius-os-sidebar.theme-dark .factor-flagged-badge {\n  color: #fb923c;\n  background: rgba(251, 146, 60, 0.15);\n}\n\n#mobius-os-sidebar.theme-dark .factor-card.factor-user-flagged {\n  border-color: rgba(251, 146, 60, 0.3);\n  background: rgba(251, 146, 60, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .factor-status-dropdown-btn.is-flagged {\n  border-color: rgba(251, 146, 60, 0.4);\n  background: rgba(251, 146, 60, 0.15);\n  color: #fb923c;\n}\n\n#mobius-os-sidebar.theme-dark .factor-step {\n  background: rgba(255, 255, 255, 0.03);\n}\n\n#mobius-os-sidebar.theme-dark .factor-step.step-current {\n  background: rgba(138, 180, 248, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .step-label {\n  color: #e8eaed;\n}\n\n#mobius-os-sidebar.theme-dark .step-number {\n  color: #9ca3af;\n}\n\n#mobius-os-sidebar.theme-dark .step-status {\n  color: #6b7280;\n}\n\n#mobius-os-sidebar.theme-dark .step-answer-menu {\n  background: #1f2937;\n  border-color: #374151;\n}\n\n#mobius-os-sidebar.theme-dark .step-answer-option {\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .step-answer-option:hover {\n  background: #374151;\n}\n\n#mobius-os-sidebar.theme-dark .factor-evidence-link {\n  color: #8ab4f8;\n}\n\n/* Dark theme - User Remedies */\n#mobius-os-sidebar.theme-dark .factor-remedies {\n  border-top-color: #374151;\n}\n\n#mobius-os-sidebar.theme-dark .remedy-item {\n  color: #9ca3af;\n}\n\n#mobius-os-sidebar.theme-dark .remedy-notes {\n  color: #6b7280;\n}\n\n#mobius-os-sidebar.theme-dark .remedy-add-btn {\n  color: #9ca3af;\n}\n\n#mobius-os-sidebar.theme-dark .remedy-add-btn:hover {\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .remedy-form {\n  background: #1f2937;\n}\n\n#mobius-os-sidebar.theme-dark .remedy-input,\n#mobius-os-sidebar.theme-dark .remedy-notes-input {\n  background: #111827;\n  border-color: #374151;\n  color: #e5e7eb;\n}\n\n#mobius-os-sidebar.theme-dark .remedy-input:focus,\n#mobius-os-sidebar.theme-dark .remedy-notes-input:focus {\n  border-color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .outcome-btn {\n  background: #111827;\n  border-color: #374151;\n  color: #9ca3af;\n}\n\n#mobius-os-sidebar.theme-dark .outcome-btn:hover {\n  background: #1f2937;\n}\n\n#mobius-os-sidebar.theme-dark .outcome-btn.selected {\n  border-color: #8ab4f8;\n  background: rgba(138, 180, 248, 0.15);\n  color: #8ab4f8;\n}\n\n#mobius-os-sidebar.theme-dark .remedy-cancel-btn {\n  background: #111827;\n  border-color: #374151;\n  color: #9ca3af;\n}\n\n#mobius-os-sidebar.theme-dark .remedy-cancel-btn:hover {\n  background: #1f2937;\n}\n\n#mobius-os-sidebar.theme-dark .factor-mobius-status {\n  background: rgba(138, 180, 248, 0.08);\n}\n\n#mobius-os-sidebar.theme-dark .mobius-text {\n  color: #e8eaed;\n}\n\n#mobius-os-sidebar.theme-dark .mobius-notify {\n  color: #9aa0a6;\n}",""]);const a=r},540(n){n.exports=function(n){var e=document.createElement("style");return n.setAttributes(e,n.attributes),n.insert(e,n.options),e}},601(n){n.exports=function(n){return n[1]}},659(n){var e={};n.exports=function(n,o){var t=function(n){if(void 0===e[n]){var o=document.querySelector(n);if(window.HTMLIFrameElement&&o instanceof window.HTMLIFrameElement)try{o=o.contentDocument.head}catch(n){o=null}e[n]=o}return e[n]}(n);if(!t)throw new Error("Couldn't find a style target. This probably means that the value for the 'insert' parameter is invalid.");t.appendChild(o)}},825(n){n.exports=function(n){if("undefined"==typeof document)return{update:function(){},remove:function(){}};var e=n.insertStyleElement(n);return{update:function(o){!function(n,e,o){var t="";o.supports&&(t+="@supports (".concat(o.supports,") {")),o.media&&(t+="@media ".concat(o.media," {"));var i=void 0!==o.layer;i&&(t+="@layer".concat(o.layer.length>0?" ".concat(o.layer):""," {")),t+=o.css,i&&(t+="}"),o.media&&(t+="}"),o.supports&&(t+="}");var s=o.sourceMap;s&&"undefined"!=typeof btoa&&(t+="\n/*# sourceMappingURL=data:application/json;base64,".concat(btoa(unescape(encodeURIComponent(JSON.stringify(s))))," */")),e.styleTagTransform(t,n,e.options)}(e,n,o)},remove:function(){!function(n){if(null===n.parentNode)return!1;n.parentNode.removeChild(n)}(e)}}}}},e={};function o(t){var i=e[t];if(void 0!==i)return i.exports;var s=e[t]={id:t,exports:{}};return n[t](s,s.exports,o),s.exports}o.n=n=>{var e=n&&n.__esModule?()=>n.default:()=>n;return o.d(e,{a:e}),e},o.d=(n,e)=>{for(var t in e)o.o(e,t)&&!o.o(n,t)&&Object.defineProperty(n,t,{enumerable:!0,get:e[t]})},o.o=(n,e)=>Object.prototype.hasOwnProperty.call(n,e),o.nc=void 0;var t=o(72),i=o.n(t),s=o(825),r=o.n(s),a=o(659),d=o.n(a),c=o(56),l=o.n(c),m=o(540),b=o.n(m),u=o(113),p=o.n(u),g=o(340),f={};f.styleTagTransform=p(),f.setAttributes=l(),f.insert=d().bind(null,"head"),f.domAPI=r(),f.insertStyleElement=b(),i()(g.A,f),g.A&&g.A.locals&&g.A.locals;const x="https://mobius-os-backend-mc2ivyhdxq-uc.a.run.app",h=`${x}/api/v1`,v="current_session_id";async function y(){return new Promise(n=>{chrome.storage.local.get([v],e=>{if(e[v])n(e[v]);else{const e="session_"+crypto.randomUUID();chrome.storage.local.set({[v]:e},()=>{n(e)})}})})}const w=h,k="mobius.auth.accessToken",C="mobius.auth.refreshToken",S="mobius.auth.expiresAt",_="mobius.auth.userProfile";class E{constructor(){this.listeners=new Set,this.refreshTimer=null}on(n){return this.listeners.add(n),()=>this.listeners.delete(n)}emit(n,e){this.listeners.forEach(o=>{try{o(n,e)}catch(n){console.error("[AuthService] Error in event listener:",n)}})}async storageGet(n){return new Promise(e=>{chrome.runtime.sendMessage({type:"mobius:auth:getStorage",keys:n},n=>{if(chrome.runtime.lastError)return console.error("[AuthService] Storage get error:",chrome.runtime.lastError),void e({});e(n?.ok?n.data:{})})})}async storageSet(n){return new Promise(e=>{chrome.runtime.sendMessage({type:"mobius:auth:setStorage",items:n},n=>{chrome.runtime.lastError&&console.error("[AuthService] Storage set error:",chrome.runtime.lastError),e()})})}async storageClear(n){return new Promise(e=>{chrome.runtime.sendMessage({type:"mobius:auth:clearStorage",keys:n},n=>{chrome.runtime.lastError&&console.error("[AuthService] Storage clear error:",chrome.runtime.lastError),e()})})}async storeTokens(n){const e=Date.now()+1e3*n.expires_in;await this.storageSet({[k]:n.access_token,[C]:n.refresh_token,[S]:e}),this.scheduleTokenRefresh(n.expires_in),console.log("[AuthService] Tokens stored, expires at:",new Date(e).toISOString())}async getAccessToken(){try{const n=await this.storageGet([k,S]),e=n[k],o=n[S];return e?o&&Date.now()>o-6e4?(console.log("[AuthService] Token expired, attempting refresh..."),await this.refreshAccessToken()?await this.getAccessToken():null):e:(console.log("[AuthService] No access token, attempting restore from refresh token..."),await this.getRefreshToken()&&await this.refreshAccessToken()?this.getAccessToken():null)}catch(n){return console.error("[AuthService] Error getting access token:",n),null}}async getRefreshToken(){try{return(await this.storageGet([C]))[C]||null}catch(n){return console.error("[AuthService] Error getting refresh token:",n),null}}async clearTokens(){await this.storageClear([k,C,S,_]),this.refreshTimer&&(clearTimeout(this.refreshTimer),this.refreshTimer=null),console.log("[AuthService] Tokens cleared")}async storeUserProfile(n){await this.storageSet({[_]:n})}async getUserProfile(){try{return(await this.storageGet([_]))[_]||null}catch(n){return console.error("[AuthService] Error getting user profile:",n),null}}scheduleTokenRefresh(n){this.refreshTimer&&clearTimeout(this.refreshTimer);const e=Math.max(1e3*(n-300),6e4);this.refreshTimer=window.setTimeout(async()=>{console.log("[AuthService] Auto-refreshing token..."),await this.refreshAccessToken()},e)}async refreshAccessToken(){const n=await this.getRefreshToken();if(!n)return console.log("[AuthService] No refresh token available"),!1;try{const e=await fetch(`${w}/auth/refresh`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:n})});if(!e.ok)return console.error("[AuthService] Token refresh failed"),await this.clearTokens(),!1;const o=await e.json(),t=Date.now()+1e3*o.expires_in;return await chrome.storage.session.set({[k]:o.access_token,[S]:t}),this.scheduleTokenRefresh(o.expires_in),this.emit("tokenRefreshed"),console.log("[AuthService] Token refreshed successfully"),!0}catch(n){return console.error("[AuthService] Token refresh error:",n),!1}}async login(n,e,o){try{const t=await fetch(`${w}/auth/login`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:e,tenant_id:o})}),i=await t.json();if(!t.ok||!i.ok)return{success:!1,error:i.error||"Login failed"};let s;if(await this.storeTokens({access_token:i.access_token,refresh_token:i.refresh_token,expires_in:i.expires_in}),i.user){const n=i.user,e=n.preference||{};s={user_id:n.user_id,tenant_id:n.tenant_id||"",email:n.email,display_name:n.display_name,first_name:n.first_name,preferred_name:n.preferred_name,greeting_name:n.preferred_name||n.first_name||n.display_name,timezone:n.timezone||"America/New_York",locale:n.locale||"en-US",is_onboarded:n.is_onboarded||!1,activities:(n.activities||[]).map(n=>n.activity_code),tone:e.tone||"professional",greeting_enabled:!1!==e.greeting_enabled,autonomy_routine_tasks:e.autonomy_routine_tasks||"confirm_first",autonomy_sensitive_tasks:e.autonomy_sensitive_tasks||"manual"},await this.storeUserProfile(s)}return this.emit("login",s),{success:!0,user:s}}catch(n){return console.error("[AuthService] Login error:",n),{success:!1,error:"Network error"}}}async register(n,e,o,t,i){try{const s=await fetch(`${w}/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,password:e,display_name:o,first_name:t,tenant_id:i})}),r=await s.json();if(!s.ok||!r.ok)return{success:!1,error:r.error||"Registration failed"};let a;if(await this.storeTokens({access_token:r.access_token,refresh_token:r.refresh_token,expires_in:r.expires_in}),r.user){const n=r.user,e=n.preference||{};a={user_id:n.user_id,tenant_id:n.tenant_id||"",email:n.email,display_name:n.display_name,first_name:n.first_name,preferred_name:n.preferred_name,greeting_name:n.preferred_name||n.first_name||n.display_name,timezone:n.timezone||"America/New_York",locale:n.locale||"en-US",is_onboarded:n.is_onboarded||!1,activities:(n.activities||[]).map(n=>n.activity_code),tone:e.tone||"professional",greeting_enabled:!1!==e.greeting_enabled,autonomy_routine_tasks:e.autonomy_routine_tasks||"confirm_first",autonomy_sensitive_tasks:e.autonomy_sensitive_tasks||"manual"},await this.storeUserProfile(a)}return this.emit("login",a),{success:!0,user:a}}catch(n){return console.error("[AuthService] Registration error:",n),{success:!1,error:"Network error"}}}async logout(){const n=await this.getRefreshToken();if(n)try{await fetch(`${w}/auth/logout`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({refresh_token:n})})}catch(n){console.warn("[AuthService] Logout API call failed:",n)}await this.clearTokens(),this.emit("logout")}async getCurrentUser(){const n=await this.getAccessToken();if(!n)return null;try{const e=await fetch(`${w}/auth/me`,{method:"GET",headers:{Authorization:`Bearer ${n}`,"Content-Type":"application/json"}});if(!e.ok)return null;const o=await e.json();if(o.ok&&o.user){const n=o.user,e=n.preference||{},t={user_id:n.user_id,tenant_id:n.tenant_id,email:n.email,display_name:n.display_name,first_name:n.first_name,preferred_name:n.preferred_name,greeting_name:n.preferred_name||n.first_name||n.display_name||"there",avatar_url:n.avatar_url,timezone:n.timezone||"America/New_York",locale:n.locale||"en-US",is_onboarded:n.is_onboarded||!1,activities:(n.activities||[]).map(n=>n.activity_code),tone:e.tone||"professional",greeting_enabled:!1!==e.greeting_enabled,autonomy_routine_tasks:e.autonomy_routine_tasks||"confirm_first",autonomy_sensitive_tasks:e.autonomy_sensitive_tasks||"manual"};return await this.storeUserProfile(t),t}return null}catch(n){return console.error("[AuthService] Error fetching current user:",n),null}}async isAuthenticated(){return null!==await this.getAccessToken()}async getAuthState(){if(!await this.getAccessToken())return"unauthenticated";const n=await this.getUserProfile();return n&&!n.is_onboarded?"onboarding":"authenticated"}async checkEmail(n,e){try{const o=await fetch(`${w}/auth/check-email`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:n,tenant_id:e})}),t=await o.json();return{exists:!0===t.exists,user:t.user}}catch(n){return console.error("[AuthService] Error checking email:",n),{exists:!1}}}}let z=null;function M(){return z||(z=new E),z}const A=h;async function N(n,e={}){const o=M(),t=await o.getAccessToken(),i=new Headers(e.headers);return i.set("Content-Type","application/json"),t&&i.set("Authorization",`Bearer ${t}`),fetch(n,{...e,headers:i})}async function L(n,e){const o=await N(`${A}/mini/status`,{method:"POST",body:JSON.stringify({session_id:n,patient_key:e})});if(!o.ok){const n=await o.json();throw new Error(n.error||"Failed to fetch mini status")}return await o.json()}async function T(n,e,o,t){const i=`${A}/mini/ack`,s={session_id:n,patient_key:e,attention_status:o};t&&(s.factor_type=t),console.log("[API DEBUG] submitAttentionStatus - URL:",i),console.log("[API DEBUG] submitAttentionStatus - Body:",s);const r=await N(i,{method:"POST",body:JSON.stringify(s)});if(console.log("[API DEBUG] submitAttentionStatus - Response status:",r.status),!r.ok){const n=await r.json();throw console.log("[API DEBUG] submitAttentionStatus - Error:",n),new Error(n.error||"Failed to update attention status")}const a=await r.json();return console.log("[API DEBUG] submitAttentionStatus - Success result:",a),a}async function $(n,e,o){const t=await N(`${A}/sidecar/factor-mode`,{method:"POST",body:JSON.stringify({patient_key:n,factor_type:e,mode:o})});if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to set factor mode")}return t.json()}const P='\n<svg viewBox="0 0 32 32" fill="none" xmlns="http://www.w3.org/2000/svg">\n  <rect width="32" height="32" rx="6" fill="#0891b2"/>\n  <path d="M16 6L22 18H10L16 6Z" fill="white" opacity="0.9"/>\n  <circle cx="16" cy="22" r="4" fill="white" opacity="0.9"/>\n  <path d="M8 24C8 20 11 17 16 17C21 17 24 20 24 24" stroke="white" stroke-width="2" stroke-linecap="round" opacity="0.6"/>\n</svg>\n',q={CMHC:P,"Aspire Health":P,"Aspire Health FL":P},I={CMHC:"Aspire Health FL"};function B({logoUrl:n,clientName:e,compact:o=!1}){const t=document.createElement("div");t.className=o?"client-logo client-logo-compact":"client-logo";const i=I[e]||e,s=q[e];if(n){const e=document.createElement("img");e.src=n,e.alt=i,t.appendChild(e)}else if(s&&s.trim().startsWith("<svg")){const n=document.createElement("div");n.className="client-logo-svg";const e=o?"18px":"24px";n.style.cssText=`width: ${e}; height: ${e}; flex-shrink: 0; display: flex; align-items: center; justify-content: center;`,n.innerHTML=s.trim();const i=n.querySelector("svg");i&&(i.style.cssText="width: 100%; height: 100%; display: block;"),t.appendChild(n)}else if(s){const n=document.createElement("img");n.src=s,n.alt=i,t.appendChild(n)}else{const n=document.createElement("div");n.className="client-logo-placeholder";const e=i.split(/\s+/).filter(Boolean).map(n=>n[0]?.toUpperCase()).join("").slice(0,3);n.textContent=e||i.slice(0,1).toUpperCase(),t.appendChild(n)}if(!o){const n=document.createElement("span");n.className="client-name",n.textContent=i,t.appendChild(n)}return t}function D({status:n,size:e=32}){const o="undefined"!=typeof crypto&&"function"==typeof crypto.randomUUID?crypto.randomUUID():String(Math.random()).slice(2),t=`infinityGradNormal_${o}`,i=`infinityGradProcessing_${o}`,s=document.createElement("div");s.className=`mobius-logo status-${n}`,s.style.cssText=`width: ${e}px; height: ${e}px; display: flex; align-items: center; justify-content: center; flex-shrink: 0;`;const r=document.createElementNS("http://www.w3.org/2000/svg","svg");r.setAttribute("viewBox","0 0 100 100"),r.setAttribute("width",e.toString()),r.setAttribute("height",e.toString());const a=document.createElementNS("http://www.w3.org/2000/svg","defs"),d=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");d.setAttribute("id",t),d.setAttribute("x1","0%"),d.setAttribute("y1","50%"),d.setAttribute("x2","100%"),d.setAttribute("y2","50%");const c=document.createElementNS("http://www.w3.org/2000/svg","stop");c.setAttribute("offset","0%"),c.setAttribute("style","stop-color:#666;stop-opacity:1"),d.appendChild(c);const l=document.createElementNS("http://www.w3.org/2000/svg","stop");l.setAttribute("offset","50%"),l.setAttribute("style","stop-color:#ffffff;stop-opacity:1"),d.appendChild(l);const m=document.createElementNS("http://www.w3.org/2000/svg","stop");m.setAttribute("offset","100%"),m.setAttribute("style","stop-color:#666;stop-opacity:1"),d.appendChild(m),a.appendChild(d);const b=document.createElementNS("http://www.w3.org/2000/svg","linearGradient");b.setAttribute("id",i),b.setAttribute("x1","0%"),b.setAttribute("y1","50%"),b.setAttribute("x2","100%"),b.setAttribute("y2","50%");const u=document.createElementNS("http://www.w3.org/2000/svg","stop");u.setAttribute("offset","0%"),u.setAttribute("style","stop-color:#666;stop-opacity:1");const p=document.createElementNS("http://www.w3.org/2000/svg","animate");p.setAttribute("attributeName","stop-color"),p.setAttribute("values","#666;#ffffff;#666"),p.setAttribute("dur","2s"),p.setAttribute("repeatCount","indefinite"),u.appendChild(p),b.appendChild(u);const g=document.createElementNS("http://www.w3.org/2000/svg","stop");g.setAttribute("offset","50%"),g.setAttribute("style","stop-color:#ffffff;stop-opacity:1");const f=document.createElementNS("http://www.w3.org/2000/svg","animate");f.setAttribute("attributeName","stop-color"),f.setAttribute("values","#ffffff;#666;#ffffff"),f.setAttribute("dur","2s"),f.setAttribute("repeatCount","indefinite"),g.appendChild(f),b.appendChild(g);const x=document.createElementNS("http://www.w3.org/2000/svg","stop");x.setAttribute("offset","100%"),x.setAttribute("style","stop-color:#666;stop-opacity:1");const h=document.createElementNS("http://www.w3.org/2000/svg","animate");h.setAttribute("attributeName","stop-color"),h.setAttribute("values","#666;#ffffff;#666"),h.setAttribute("dur","2s"),h.setAttribute("repeatCount","indefinite"),x.appendChild(h),b.appendChild(x),a.appendChild(b),r.appendChild(a);const v="M 25 50 C 25 30, 35 20, 50 30 C 50 30, 50 30, 50 50 C 50 70, 70 80, 80 50 C 80 30, 70 20, 50 30 C 50 30, 50 30, 50 50 C 50 70, 30 80, 25 50",y=document.createElementNS("http://www.w3.org/2000/svg","g");y.setAttribute("class","path-normal");const w=document.createElementNS("http://www.w3.org/2000/svg","path");w.setAttribute("d",v),w.setAttribute("stroke",`url(#${t})`),w.setAttribute("stroke-width","4.5"),w.setAttribute("fill","none"),w.setAttribute("stroke-linecap","round"),y.appendChild(w),r.appendChild(y);const k=document.createElementNS("http://www.w3.org/2000/svg","g");k.setAttribute("class","path-processing");const C=document.createElementNS("http://www.w3.org/2000/svg","path");return C.setAttribute("d",v),C.setAttribute("stroke",`url(#${i})`),C.setAttribute("stroke-width","4.5"),C.setAttribute("fill","none"),C.setAttribute("stroke-linecap","round"),k.appendChild(C),r.appendChild(k),s.appendChild(r),s}const R="mobius.privacyMode";function H(n){const e=n.trim().split(/\s+/);return 0===e.length?"":e.map(n=>n.charAt(0).toUpperCase()).join(".")+"."}function j(n,e){return e?H(n.displayName):n.displayName}function U(n,e){return e?n.shortName.split(/\s+/)[0].charAt(0).toUpperCase()+".":n.shortName}function O(n,e){return e?H(n.displayName)+"'s":n.possessive}const F={isEnabled:async()=>new Promise(n=>{"undefined"!=typeof chrome&&chrome.storage?.local?chrome.storage.local.get([R],e=>{n(!0===e[R])}):n("true"===localStorage.getItem(R))}),setEnabled:async n=>new Promise(e=>{"undefined"!=typeof chrome&&chrome.storage?.local?chrome.storage.local.set({[R]:n},()=>{e()}):(localStorage.setItem(R,String(n)),e())}),async toggle(){const n=!await this.isEnabled();return await this.setEnabled(n),n}};function G(n,e){const o=document.createElement("label");o.className="sidecar-workflow-option";const t=document.createElement("input");t.type="checkbox",t.className="sidecar-workflow-option-checkbox";const i=document.createElement("span");return i.className="sidecar-workflow-option-label",i.textContent=n.label,t.addEventListener("change",()=>{e(t.checked)}),o.appendChild(t),o.appendChild(i),n.description&&(o.title=n.description),o}function Y(n,e){const o=document.createElement("div");o.className="sidecar-manual-task-card";const t=document.createElement("div");t.className="sidecar-manual-task-question",t.textContent=n.question_text,o.appendChild(t);const i=document.createElement("div");i.className="sidecar-manual-task-dropdown-wrap";const s=document.createElement("select");s.className="sidecar-manual-task-dropdown",s.innerHTML='<option value="">Select an option...</option>';for(const e of n.answer_options){const o=document.createElement("option");o.value=e.id,o.textContent=e.label,n.selected_answer===e.id&&(o.selected=!0),s.appendChild(o)}return s.addEventListener("change",t=>{const i=t.target.value;i&&(e(n.id,i),s.classList.add("sidecar-manual-task-dropdown--answered"),o.classList.add("sidecar-manual-task-card--answered"))}),i.appendChild(s),o.appendChild(i),n.selected_answer&&(s.value=n.selected_answer,s.classList.add("sidecar-manual-task-dropdown--answered"),o.classList.add("sidecar-manual-task-card--answered")),"resolved"===n.status&&(s.disabled=!0,s.classList.add("sidecar-manual-task-dropdown--resolved"),o.classList.add("sidecar-manual-task-card--resolved")),o}const W="mobius-toast-container",X="mobius.notificationsEnabled",J={win:5e3,update:3e3,reminder:0,conflict:0};let V=!1,Z=!1,K=null,Q=new Set,nn=[],en=new Map,on=!0,tn=null,sn=null;function rn(n){if(!V)return console.warn("[ToastManager] Not initialized, queueing toast"),void nn.push(n);on||"conflict"===n.type?function(n){const e=document.getElementById(W);if(!e)return void console.error("[ToastManager] Container not found");if(en.has(n.id))return;const o=document.createElement("div");o.className="mobius-toast",o.dataset.type=n.type,o.dataset.id=n.id;const t=document.createElement("span");t.className="mobius-toast-emoji",t.textContent=function(n){switch(n){case"win":return"🎉";case"update":return"✓";case"reminder":return"⏰";case"conflict":return"⚠️";default:return"📋"}}(n.type),o.appendChild(t);const i=document.createElement("div");i.className="mobius-toast-content";const s=document.createElement("div");if(s.className="mobius-toast-title",s.textContent=n.title,i.appendChild(s),n.subtitle){const e=document.createElement("div");e.className="mobius-toast-subtitle",e.textContent=n.subtitle,i.appendChild(e)}o.appendChild(i);const r=document.createElement("button");r.className="mobius-toast-close",r.innerHTML="×",r.addEventListener("click",e=>{e.stopPropagation(),an(n.id)}),o.appendChild(r),n.patient_key&&o.addEventListener("click",()=>{var e;e=n.patient_key,sn?sn(e):console.warn("[ToastManager] No jump-to-patient callback registered"),an(n.id)}),e.appendChild(o),en.set(n.id,o);const a=n.auto_dismiss_ms??J[n.type];a>0&&setTimeout(()=>{an(n.id)},a)}(n):console.log("[ToastManager] Notifications disabled, skipping toast:",n.id)}function an(n){const e=en.get(n);e&&(e.classList.add("mobius-toast-exit"),setTimeout(()=>{e.remove(),en.delete(n)},300))}async function dn(){try{const n=await async function(){const n=M(),e=await n.getAccessToken();return e?{Authorization:`Bearer ${e}`}:null}();if(!n)return;const e=await fetch("/api/v1/user/alerts",{method:"GET",headers:{"Content-Type":"application/json",...n}});if(!e.ok)return void console.error("[ToastManager] Failed to fetch alerts:",e.status);const o=await e.json(),t=o.alerts.filter(n=>!Q.has(n.id));Q=new Set(o.alerts.map(n=>n.id));for(const n of t)rn(cn(n))}catch(n){console.error("[ToastManager] Error polling alerts:",n)}}function cn(n){const e={id:n.id,type:n.type,title:n.title,subtitle:n.subtitle,patient_key:n.patient_key,auto_dismiss_ms:J[n.type]};return"reminder"===n.type&&(e.actions=[{id:"still_on_it",label:"Still on it"},{id:"hand_to_mobius",label:"Hand to Mobius"}]),e}const ln={light:{id:"light",label:"Light",icon:"☀️",colors:{bgPrimary:"#ffffff",bgSecondary:"#f8fafc",bgTertiary:"#f1f5f9",bgHover:"#e2e8f0",bgActive:"#cbd5e1",textPrimary:"#0f172a",textSecondary:"#475569",textMuted:"#94a3b8",textInverse:"#ffffff",accent:"#2563eb",accentHover:"#1d4ed8",accentText:"#ffffff",success:"#16a34a",warning:"#ca8a04",error:"#dc2626",info:"#0891b2",border:"#e2e8f0",borderLight:"#f1f5f9",shadow:"rgba(0, 0, 0, 0.05)",shadowStrong:"rgba(0, 0, 0, 0.1)",overlay:"rgba(15, 23, 42, 0.5)",glass:"rgba(255, 255, 255, 0.8)"}},dark:{id:"dark",label:"Dark",icon:"🌙",colors:{bgPrimary:"#1e293b",bgSecondary:"#0f172a",bgTertiary:"#020617",bgHover:"#334155",bgActive:"#475569",textPrimary:"#f8fafc",textSecondary:"#cbd5e1",textMuted:"#64748b",textInverse:"#0f172a",accent:"#3b82f6",accentHover:"#60a5fa",accentText:"#ffffff",success:"#22c55e",warning:"#eab308",error:"#ef4444",info:"#06b6d4",border:"#334155",borderLight:"#1e293b",shadow:"rgba(0, 0, 0, 0.3)",shadowStrong:"rgba(0, 0, 0, 0.5)",overlay:"rgba(0, 0, 0, 0.7)",glass:"rgba(30, 41, 59, 0.9)"}},midnight:{id:"midnight",label:"Midnight",icon:"🌌",colors:{bgPrimary:"#0a0a1a",bgSecondary:"#12122a",bgTertiary:"#1a1a3a",bgHover:"#252550",bgActive:"#303060",textPrimary:"#e0e0ff",textSecondary:"#a0a0d0",textMuted:"#6060a0",textInverse:"#0a0a1a",accent:"#8b5cf6",accentHover:"#a78bfa",accentText:"#ffffff",success:"#34d399",warning:"#fbbf24",error:"#f87171",info:"#38bdf8",border:"#252550",borderLight:"#1a1a3a",shadow:"rgba(0, 0, 0, 0.4)",shadowStrong:"rgba(0, 0, 0, 0.6)",overlay:"rgba(10, 10, 26, 0.8)",glass:"rgba(18, 18, 42, 0.95)"}},ocean:{id:"ocean",label:"Ocean",icon:"🌊",colors:{bgPrimary:"#f0f9ff",bgSecondary:"#e0f2fe",bgTertiary:"#bae6fd",bgHover:"#7dd3fc",bgActive:"#38bdf8",textPrimary:"#0c4a6e",textSecondary:"#0369a1",textMuted:"#0284c7",textInverse:"#f0f9ff",accent:"#0284c7",accentHover:"#0369a1",accentText:"#ffffff",success:"#059669",warning:"#d97706",error:"#dc2626",info:"#0891b2",border:"#7dd3fc",borderLight:"#bae6fd",shadow:"rgba(3, 105, 161, 0.1)",shadowStrong:"rgba(3, 105, 161, 0.2)",overlay:"rgba(12, 74, 110, 0.5)",glass:"rgba(240, 249, 255, 0.9)"}},forest:{id:"forest",label:"Forest",icon:"🌲",colors:{bgPrimary:"#f0fdf4",bgSecondary:"#dcfce7",bgTertiary:"#bbf7d0",bgHover:"#86efac",bgActive:"#4ade80",textPrimary:"#14532d",textSecondary:"#166534",textMuted:"#15803d",textInverse:"#f0fdf4",accent:"#16a34a",accentHover:"#15803d",accentText:"#ffffff",success:"#059669",warning:"#ca8a04",error:"#dc2626",info:"#0891b2",border:"#86efac",borderLight:"#bbf7d0",shadow:"rgba(22, 101, 52, 0.1)",shadowStrong:"rgba(22, 101, 52, 0.2)",overlay:"rgba(20, 83, 45, 0.5)",glass:"rgba(240, 253, 244, 0.9)"}},sunset:{id:"sunset",label:"Sunset",icon:"🌅",colors:{bgPrimary:"#fffbeb",bgSecondary:"#fef3c7",bgTertiary:"#fde68a",bgHover:"#fcd34d",bgActive:"#fbbf24",textPrimary:"#78350f",textSecondary:"#92400e",textMuted:"#b45309",textInverse:"#fffbeb",accent:"#f59e0b",accentHover:"#d97706",accentText:"#ffffff",success:"#16a34a",warning:"#ca8a04",error:"#dc2626",info:"#0891b2",border:"#fcd34d",borderLight:"#fde68a",shadow:"rgba(180, 83, 9, 0.1)",shadowStrong:"rgba(180, 83, 9, 0.2)",overlay:"rgba(120, 53, 15, 0.5)",glass:"rgba(255, 251, 235, 0.9)"}}},mn={compact:{id:"compact",label:"Compact",description:"Smaller text, more content visible",scale:{fontXs:"9px",fontSm:"10px",fontBase:"11px",fontMd:"12px",fontLg:"13px",fontXl:"14px",spaceXs:"2px",spaceSm:"4px",spaceBase:"6px",spaceMd:"8px",spaceLg:"12px",iconSm:"12px",iconBase:"14px",iconLg:"16px",avatarSm:"20px",avatarBase:"28px",buttonHeight:"24px",inputHeight:"26px",radiusSm:"3px",radiusBase:"5px",radiusLg:"8px"}},normal:{id:"normal",label:"Normal",description:"Balanced text size, matches EMR",scale:{fontXs:"11px",fontSm:"12px",fontBase:"13px",fontMd:"14px",fontLg:"15px",fontXl:"16px",spaceXs:"3px",spaceSm:"6px",spaceBase:"8px",spaceMd:"12px",spaceLg:"16px",iconSm:"14px",iconBase:"16px",iconLg:"20px",avatarSm:"24px",avatarBase:"32px",buttonHeight:"28px",inputHeight:"32px",radiusSm:"4px",radiusBase:"6px",radiusLg:"10px"}},comfortable:{id:"comfortable",label:"Comfortable",description:"Larger text, easier to read",scale:{fontXs:"12px",fontSm:"13px",fontBase:"14px",fontMd:"15px",fontLg:"17px",fontXl:"19px",spaceXs:"4px",spaceSm:"8px",spaceBase:"10px",spaceMd:"14px",spaceLg:"20px",iconSm:"16px",iconBase:"18px",iconLg:"24px",avatarSm:"28px",avatarBase:"36px",buttonHeight:"32px",inputHeight:"36px",radiusSm:"5px",radiusBase:"8px",radiusLg:"12px"}}},bn="mobius.theme",un="mobius.density";async function pn(n){try{await chrome.storage.local.set({[bn]:n})}catch(n){console.warn("[Mobius] Failed to save theme:",n)}}async function gn(){try{const n=(await chrome.storage.local.get(bn))[bn];return ln[n]?n:"light"}catch{return"light"}}async function fn(n){try{await chrome.storage.local.set({[un]:n})}catch(n){console.warn("[Mobius] Failed to save density:",n)}}async function xn(){try{const n=(await chrome.storage.local.get(un))[un];return mn[n]?n:"normal"}catch{return"normal"}}function hn(n,e,o){const t=function(n,e){const o=mn[e]||mn.normal;return`\n    ${function(n){const{colors:e}=n;return`\n    --mobius-bg-primary: ${e.bgPrimary};\n    --mobius-bg-secondary: ${e.bgSecondary};\n    --mobius-bg-tertiary: ${e.bgTertiary};\n    --mobius-bg-hover: ${e.bgHover};\n    --mobius-bg-active: ${e.bgActive};\n    --mobius-text-primary: ${e.textPrimary};\n    --mobius-text-secondary: ${e.textSecondary};\n    --mobius-text-muted: ${e.textMuted};\n    --mobius-text-inverse: ${e.textInverse};\n    --mobius-accent: ${e.accent};\n    --mobius-accent-hover: ${e.accentHover};\n    --mobius-accent-text: ${e.accentText};\n    --mobius-success: ${e.success};\n    --mobius-warning: ${e.warning};\n    --mobius-error: ${e.error};\n    --mobius-info: ${e.info};\n    --mobius-border: ${e.border};\n    --mobius-border-light: ${e.borderLight};\n    --mobius-shadow: ${e.shadow};\n    --mobius-shadow-strong: ${e.shadowStrong};\n    --mobius-overlay: ${e.overlay};\n    --mobius-glass: ${e.glass};\n  `.trim()}(ln[n]||ln.light)}\n    ${function(n){const{scale:e}=n;return`\n    --mobius-font-xs: ${e.fontXs};\n    --mobius-font-sm: ${e.fontSm};\n    --mobius-font-base: ${e.fontBase};\n    --mobius-font-md: ${e.fontMd};\n    --mobius-font-lg: ${e.fontLg};\n    --mobius-font-xl: ${e.fontXl};\n    --mobius-space-xs: ${e.spaceXs};\n    --mobius-space-sm: ${e.spaceSm};\n    --mobius-space-base: ${e.spaceBase};\n    --mobius-space-md: ${e.spaceMd};\n    --mobius-space-lg: ${e.spaceLg};\n    --mobius-icon-sm: ${e.iconSm};\n    --mobius-icon-base: ${e.iconBase};\n    --mobius-icon-lg: ${e.iconLg};\n    --mobius-avatar-sm: ${e.avatarSm};\n    --mobius-avatar-base: ${e.avatarBase};\n    --mobius-button-height: ${e.buttonHeight};\n    --mobius-input-height: ${e.inputHeight};\n    --mobius-radius-sm: ${e.radiusSm};\n    --mobius-radius-base: ${e.radiusBase};\n    --mobius-radius-lg: ${e.radiusLg};\n  `.trim()}(o)}\n  `}(e,o);n.setAttribute("style",`${n.getAttribute("style")||""}; ${t}`),n.classList.remove("theme-light","theme-dark","theme-midnight","theme-ocean","theme-forest","theme-sunset","density-compact","density-normal","density-comfortable"),n.classList.add(`theme-${e}`,`density-${o}`)}async function vn(n){const e=await gn(),o=await xn();return hn(n,e,o),{theme:e,density:o}}const yn=Object.values(ln).map(n=>({id:n.id,label:n.label,icon:n.icon})),wn=Object.values(mn).map(n=>({id:n.id,label:n.label,description:n.description})),kn=[{id:"focus",label:"My Focus",icon:"◎",desc:"Only relevant factors"},{id:"all",label:"All",icon:"☰",desc:"Show all 5 factors"}];function Cn(n){const{onHistoryClick:e,onSettingsClick:o,onHelpClick:t,onPrivacyChange:i,onNotificationsChange:s,onThemeChange:r,onDensityChange:a,onViewChange:d,currentView:c="focus",currentTheme:l="light",currentDensity:m="normal"}=n,b=document.createElement("div");b.className="sidecar-menu";const u=document.createElement("button");u.className="sidecar-menu-btn",u.innerHTML='<svg viewBox="0 0 24 24"><circle cx="12" cy="5" r="2"/><circle cx="12" cy="12" r="2"/><circle cx="12" cy="19" r="2"/></svg>',u.title="Menu";const p=document.createElement("div");p.className="sidecar-menu-dropdown",p.style.display="none",u.addEventListener("click",n=>{n.stopPropagation(),p.style.display="none"===p.style.display?"block":"none"}),document.addEventListener("click",()=>{p.style.display="none"});const g=[{label:"Notifications",icon:"bell",toggle:{key:"notifications",getState:async()=>on,onChange:async n=>{await async function(n){if(on=n,await async function(n){return new Promise(e=>{"undefined"!=typeof chrome&&chrome.storage?.local?chrome.storage.local.set({[X]:n},()=>{e()}):(localStorage.setItem(X,String(n)),e())})}(n),!n)for(const[n,e]of en.entries()){const o=e.dataset.type;"conflict"!==o&&"reminder"!==o&&an(n)}}(n),s(n)}}},{label:"Privacy mode",icon:"lock",toggle:{key:"privacy",getState:()=>F.isEnabled(),onChange:async n=>{await F.setEnabled(n),i(n)}}},{label:"divider",icon:""},{label:"Theme",icon:"palette",submenu:!0},{label:"Text Size",icon:"textsize",submenu:!0},{label:"View",icon:"view",submenu:!0},{label:"divider",icon:""},{label:"History",icon:"history",onClick:()=>{p.style.display="none",e()}},{label:"Settings",icon:"settings",onClick:()=>{p.style.display="none",o()}},{label:"Help",icon:"help",onClick:()=>{p.style.display="none",t()}}];for(const n of g){if("divider"===n.label){const n=document.createElement("div");n.className="sidecar-menu-divider",p.appendChild(n);continue}const e=document.createElement("div");e.className="sidecar-menu-item";const o=document.createElement("span");o.className="sidecar-menu-icon",o.innerHTML=Sn(n.icon),e.appendChild(o);const t=document.createElement("span");if(t.className="sidecar-menu-label",t.textContent=n.label,e.appendChild(t),n.toggle){const o=Mn(n.toggle.key,n.toggle.getState,n.toggle.onChange);e.appendChild(o)}else if(n.submenu&&"Theme"===n.label){const n=document.createElement("span");n.className="sidecar-menu-arrow",n.textContent="›",e.appendChild(n);const o=En(r);e.appendChild(o),e.addEventListener("mouseenter",()=>{o.style.display="block"}),e.addEventListener("mouseleave",()=>{o.style.display="none"})}else if(n.submenu&&"Text Size"===n.label){const n=document.createElement("span");n.className="sidecar-menu-arrow",n.textContent="›",e.appendChild(n);const o=zn(m,a,()=>{p.style.display="none"});e.appendChild(o),e.addEventListener("mouseenter",()=>{o.style.display="block"}),e.addEventListener("mouseleave",()=>{o.style.display="none"})}else if(n.submenu&&"View"===n.label){const n=document.createElement("span");n.className="sidecar-menu-arrow",n.textContent="›",e.appendChild(n);const o=_n(c,d,()=>{p.style.display="none"});e.appendChild(o),e.addEventListener("mouseenter",()=>{o.style.display="block"}),e.addEventListener("mouseleave",()=>{o.style.display="none"})}else n.onClick&&(e.addEventListener("click",n.onClick),e.style.cursor="pointer");p.appendChild(e)}return b.appendChild(u),b.appendChild(p),b}function Sn(n){return{bell:'<svg viewBox="0 0 24 24"><path d="M12 22c1.1 0 2-.9 2-2h-4c0 1.1.9 2 2 2zm6-6v-5c0-3.07-1.63-5.64-4.5-6.32V4c0-.83-.67-1.5-1.5-1.5s-1.5.67-1.5 1.5v.68C7.64 5.36 6 7.92 6 11v5l-2 2v1h16v-1l-2-2zm-2 1H8v-6c0-2.48 1.51-4.5 4-4.5s4 2.02 4 4.5v6z"/></svg>',lock:'<svg viewBox="0 0 24 24"><path d="M18 8h-1V6c0-2.76-2.24-5-5-5S7 3.24 7 6v2H6c-1.1 0-2 .9-2 2v10c0 1.1.9 2 2 2h12c1.1 0 2-.9 2-2V10c0-1.1-.9-2-2-2zm-6 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zm3.1-9H8.9V6c0-1.71 1.39-3.1 3.1-3.1 1.71 0 3.1 1.39 3.1 3.1v2z"/></svg>',palette:'<svg viewBox="0 0 24 24"><path d="M12 3c-4.97 0-9 4.03-9 9s4.03 9 9 9c.83 0 1.5-.67 1.5-1.5 0-.39-.15-.74-.39-1.01-.23-.26-.38-.61-.38-.99 0-.83.67-1.5 1.5-1.5H16c2.76 0 5-2.24 5-5 0-4.42-4.03-8-9-8zm-5.5 9c-.83 0-1.5-.67-1.5-1.5S5.67 9 6.5 9 8 9.67 8 10.5 7.33 12 6.5 12zm3-4C8.67 8 8 7.33 8 6.5S8.67 5 9.5 5s1.5.67 1.5 1.5S10.33 8 9.5 8zm5 0c-.83 0-1.5-.67-1.5-1.5S13.67 5 14.5 5s1.5.67 1.5 1.5S15.33 8 14.5 8zm3 4c-.83 0-1.5-.67-1.5-1.5S16.67 9 17.5 9s1.5.67 1.5 1.5-.67 1.5-1.5 1.5z"/></svg>',textsize:'<svg viewBox="0 0 24 24"><path d="M9 4v3h5v12h3V7h5V4H9zm-6 8h3v7h3v-7h3V9H3v3z"/></svg>',view:'<svg viewBox="0 0 24 24"><path d="M12 4.5C7 4.5 2.73 7.61 1 12c1.73 4.39 6 7.5 11 7.5s9.27-3.11 11-7.5c-1.73-4.39-6-7.5-11-7.5zM12 17c-2.76 0-5-2.24-5-5s2.24-5 5-5 5 2.24 5 5-2.24 5-5 5zm0-8c-1.66 0-3 1.34-3 3s1.34 3 3 3 3-1.34 3-3-1.34-3-3-3z"/></svg>',history:'<svg viewBox="0 0 24 24"><path d="M13 3c-4.97 0-9 4.03-9 9H1l3.89 3.89.07.14L9 12H6c0-3.87 3.13-7 7-7s7 3.13 7 7-3.13 7-7 7c-1.93 0-3.68-.79-4.94-2.06l-1.42 1.42C8.27 19.99 10.51 21 13 21c4.97 0 9-4.03 9-9s-4.03-9-9-9zm-1 5v5l4.28 2.54.72-1.21-3.5-2.08V8H12z"/></svg>',settings:'<svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg>',help:'<svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm1 17h-2v-2h2v2zm2.07-7.75l-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25z"/></svg>'}[n]||""}function _n(n,e,o){const t=document.createElement("div");t.className="sidecar-menu-submenu",t.style.display="none";for(const i of kn){const s=document.createElement("div");s.className="sidecar-menu-submenu-item "+(n===i.id?"active":""),s.innerHTML=`\n      <span class="sidecar-menu-view-icon">${i.icon}</span>\n      <span class="sidecar-menu-view-label">${i.label}</span>\n      ${n===i.id?'<span class="sidecar-menu-check">✓</span>':""}\n    `,s.title=i.desc,s.addEventListener("click",n=>{n.stopPropagation(),e?.(i.id),o?.()}),t.appendChild(s)}return t}function En(n){const e=document.createElement("div");e.className="sidecar-menu-submenu",e.style.display="none";for(const o of yn){const t=document.createElement("div");t.className="sidecar-menu-submenu-item",t.innerHTML=`\n      <span class="sidecar-menu-theme-icon">${o.icon}</span>\n      <span class="sidecar-menu-theme-label">${o.label}</span>\n    `,t.addEventListener("click",async t=>{t.stopPropagation();const i=document.getElementById("mobius-os-sidebar");if(i){const n=await xn();hn(i,o.id,n)}await pn(o.id),n?.(o.id),e.style.display="none"}),e.appendChild(t)}return e}function zn(n,e,o){const t=document.createElement("div");t.className="sidecar-menu-submenu",t.style.display="none";for(const i of wn){const s=document.createElement("div");s.className="sidecar-menu-submenu-item "+(n===i.id?"active":""),s.innerHTML=`\n      <span class="sidecar-menu-density-label">${i.label}</span>\n      <span class="sidecar-menu-density-desc">${i.description}</span>\n      ${n===i.id?'<span class="sidecar-menu-check">✓</span>':""}\n    `,s.addEventListener("click",async n=>{n.stopPropagation();const t=document.getElementById("mobius-os-sidebar");t&&hn(t,await gn(),i.id);const s=document.getElementById("mobius-mini-widget");s&&hn(s,await gn(),i.id),await fn(i.id),e?.(i.id),o?.()}),t.appendChild(s)}return t}function Mn(n,e,o){const t=document.createElement("label");t.className="sidecar-menu-toggle";const i=document.createElement("input");i.type="checkbox",i.className="sidecar-menu-toggle-input",i.dataset.key=n;const s=document.createElement("span");return s.className="sidecar-menu-toggle-slider",e().then(n=>{i.checked=n}),i.addEventListener("change",()=>{o(i.checked)}),t.addEventListener("click",n=>{n.stopPropagation()}),t.appendChild(i),t.appendChild(s),t}function An(n){const{factor:e,isExpanded:o,onModeSelect:t,onStepAction:i,onEvidenceClick:s,onToggleExpand:r,onResolve:a,onAddRemedy:d}=n,c=e.user_override,l="resolved"===c,m="unresolved"===c,b=document.createElement("div");b.className=`factor-card ${function(n,e){if("resolved"===e)return"factor-resolved factor-user-override";if("unresolved"===e)return"factor-blocked factor-user-flagged";switch(n){case"resolved":return"factor-resolved";case"blocked":return"factor-blocked";case"waiting":return"factor-waiting";default:return""}}(e.status,c)} ${e.is_focus?"factor-focus":""} ${o?"expanded":"collapsed"}`,b.dataset.factorType=e.factor_type;const u=document.createElement("div");u.className="factor-header",u.addEventListener("click",()=>r(e.factor_type));const p=document.createElement("span");p.className="factor-status-icon",p.textContent=function(n,e){if("resolved"===e)return"✓";if("unresolved"===e)return"⚠";switch(n){case"resolved":return"✓";case"blocked":return"⚠️";case"waiting":return"◯";default:return"○"}}(e.status,c),u.appendChild(p);const g=document.createElement("span");g.className="factor-label",g.textContent=e.label,u.appendChild(g);const f=document.createElement("span");if(f.className=`factor-status-label ${function(n){switch(n){case"blocked":return"status-needs-help";case"waiting":return"status-almost";case"resolved":return"status-good";default:return""}}(e.status)}`,f.textContent=`· ${function(n){switch(n){case"resolved":return"Looks good";case"blocked":return"Needs your help";case"waiting":return"Almost there";default:return"Checking..."}}(e.status)}`,u.appendChild(f),l){const n=document.createElement("span");n.className="factor-resolved-badge",n.textContent="Resolved",u.appendChild(n)}else if(m){const n=document.createElement("span");n.className="factor-flagged-badge",n.textContent="Flagged",u.appendChild(n)}if(e.is_focus){const n=document.createElement("span");n.className="factor-focus-badge",n.textContent="◀ YOUR FOCUS",u.appendChild(n)}if(a){const n=function(n){const o=document.createElement("div");o.className="factor-status-dropdown";let t="Set status ▾",i="factor-status-dropdown-btn";"resolved"===n?(t="Resolved ▾",i+=" is-resolved"):"unresolved"===n&&(t="Flagged ▾",i+=" is-flagged");const s=document.createElement("button");s.type="button",s.className=i,s.textContent=t,s.addEventListener("click",n=>{n.stopPropagation();const e=o.querySelector(".factor-status-menu");if(e){const n="block"===e.style.display;e.style.display=n?"none":"block"}}),o.appendChild(s);const r=document.createElement("div");return r.className="factor-status-menu",r.style.display="none",[{status:"resolved",label:"Resolved",icon:"✓",desc:"Mark as done"},{status:"unresolved",label:"Needs work",icon:"⚠",desc:"Flag for attention"}].forEach(o=>{const t=document.createElement("button");t.type="button",t.className="factor-status-option "+(o.status===n?"selected":""),t.innerHTML=`<span class="opt-icon">${o.icon}</span><span class="opt-label">${o.label}</span>`,t.addEventListener("click",n=>{var t;n.stopPropagation(),r.style.display="none",t=o.status,a(e.factor_type,t)}),r.appendChild(t)}),o.appendChild(r),document.addEventListener("click",()=>{r.style.display="none"}),o}(c);u.appendChild(n)}if(e.mode&&!o){const n=document.createElement("span");n.className="factor-mode-indicator",n.textContent="mobius"===e.mode?"🤖":"together"===e.mode?"🤝":"👤",u.appendChild(n)}const x=document.createElement("span");if(x.className="factor-expand-icon",x.textContent=o?"▼":"▶",u.appendChild(x),b.appendChild(u),o){const n=document.createElement("div");n.className="factor-content";const o=function(n,e){const o=document.createElement("div");if(o.className="factor-mode-row",n.recommendation){const e=document.createElement("span");e.className="factor-mode-hint";const t=Math.round(100*n.recommendation.confidence);e.innerHTML=`💡 <strong>${Nn(n.recommendation.mode)}</strong> · ${t}% success rate`,o.appendChild(e)}const t=document.createElement("div");t.className="factor-mode-dropdown";const i=document.createElement("button");i.className="factor-mode-dropdown-btn "+(n.mode?"has-selection":""),i.innerHTML=n.mode?`${function(n){switch(n){case"mobius":return"🤖";case"manual":return"👤";default:return""}}(n.mode)} ${Nn(n.mode)} <span class="dropdown-arrow">▾</span>`:'Select <span class="dropdown-arrow">▾</span>';const s=document.createElement("div");s.className="factor-mode-dropdown-menu",s.style.display="none";const r=[{mode:"mobius",icon:"🤖",label:"Mobius handles"},{mode:"manual",icon:"👤",label:"I'll handle"}];for(const o of r){const t=document.createElement("div");t.className=`factor-mode-option ${n.mode===o.mode?"selected":""} ${n.recommendation?.mode===o.mode?"recommended":""}`,t.innerHTML=`${o.icon} ${o.label}`,t.addEventListener("click",t=>{t.stopPropagation(),e(n.factor_type,o.mode),s.style.display="none"}),s.appendChild(t)}return i.addEventListener("click",n=>{n.stopPropagation();const e="none"!==s.style.display;s.style.display=e?"none":"block"}),document.addEventListener("click",()=>{s.style.display="none"}),t.appendChild(i),t.appendChild(s),o.appendChild(t),o}(e,t);if(n.appendChild(o),e.steps.length>0){if("mobius"===e.mode){const e=document.createElement("div");e.className="factor-mobius-status",e.innerHTML='\n          <div class="mobius-handling">\n            <span class="mobius-icon">🤖</span>\n            <span class="mobius-text">Mobius is handling this.</span>\n          </div>\n          <div class="mobius-notify">You\'ll be notified when complete.</div>\n        ',n.appendChild(e)}const o=function(n,e){const o=document.createElement("div");return o.className="factor-steps",n.steps.forEach((t,i)=>{const s=function(n,e,o,t){const i=document.createElement("div");i.className=`factor-step step-${n.status}`;const s=document.createElement("div");if(s.className="step-left",t){const n=document.createElement("span");n.className="step-number",n.textContent=`${t}.`,s.appendChild(n)}const r=document.createElement("span");r.className="step-icon",r.textContent=n.assignee_icon,s.appendChild(r);const a=document.createElement("span");a.className="step-label",a.textContent=n.label,s.appendChild(a),i.appendChild(s);const d=document.createElement("div");if(d.className="step-right",n.is_user_turn&&"mobius"!==e){const t=document.createElement("div");t.className="step-done-container";const i=document.createElement("button");i.className="step-btn done-btn",i.textContent="Done ▾";const s=document.createElement("div");if(s.className="step-answer-menu",s.style.display="none",n.answer_options&&n.answer_options.length>0)for(const e of n.answer_options){const t=document.createElement("div");t.className="step-answer-option",t.textContent=e.label,t.addEventListener("click",t=>{t.stopPropagation(),s.style.display="none",o(n.step_id,"done",e.code)}),s.appendChild(t)}else{const e=document.createElement("div");e.className="step-answer-option",e.textContent="✓ Mark complete",e.addEventListener("click",e=>{e.stopPropagation(),s.style.display="none",o(n.step_id,"done","completed")}),s.appendChild(e)}i.addEventListener("click",n=>{n.stopPropagation();const e="none"!==s.style.display;s.style.display=e?"none":"block"}),document.addEventListener("click",()=>{s.style.display="none"}),t.appendChild(i),t.appendChild(s),d.appendChild(t);const r=document.createElement("button");if(r.className="step-btn skip-btn",r.textContent="Skip",r.addEventListener("click",e=>{e.stopPropagation(),o(n.step_id,"skip")}),d.appendChild(r),("manual"===e||!e)&&n.can_system_handle){const e=document.createElement("button");e.className="step-btn delegate-btn",e.textContent="→ Mobius",e.addEventListener("click",e=>{e.stopPropagation(),o(n.step_id,"delegate")}),d.appendChild(e)}}else{const o=document.createElement("span");o.className=`step-status step-status-${n.status}`,"done"===n.status||"answered"===n.status?n.selected_answer_label?(o.textContent=`✓ ${n.selected_answer_label}`,o.title=n.selected_answer_label):o.textContent="✓ Done":"skipped"===n.status?o.textContent="⊘ Skipped":o.textContent="mobius"===e?"🤖 Mobius":"○",d.appendChild(o)}return i.appendChild(d),i}(t,n.mode,e,i+1);o.appendChild(s)}),o}(e,i);n.appendChild(o)}const r=function(n,e){const o=document.createElement("div");if(o.className="factor-remedies",n.remedies&&n.remedies.length>0){const e=document.createElement("div");e.className="remedies-list";for(const o of n.remedies){const n=document.createElement("div");n.className=`remedy-item remedy-${o.outcome}`;const t="worked"===o.outcome?"✓":"partial"===o.outcome?"◐":"✗";n.innerHTML=`\n        <span class="remedy-icon">${t}</span>\n        <span class="remedy-text">${o.remedy_text}</span>\n        ${o.outcome_notes?`<span class="remedy-notes">${o.outcome_notes}</span>`:""}\n      `,e.appendChild(n)}o.appendChild(e)}if(e){const t=document.createElement("div");t.className="remedy-add-row";const i=document.createElement("button");i.type="button",i.className="remedy-add-btn",i.textContent="+ Add what I tried";const s=document.createElement("div");s.className="remedy-form",s.style.display="none";const r=document.createElement("input");r.type="text",r.className="remedy-input",r.placeholder="What did you try?";const a=document.createElement("div");a.className="remedy-outcomes";let d=null;[{value:"worked",label:"Worked",icon:"✓"},{value:"partial",label:"Partial",icon:"◐"},{value:"failed",label:"Failed",icon:"✗"}].forEach(n=>{const e=document.createElement("button");e.type="button",e.className="outcome-btn",e.dataset.outcome=n.value,e.innerHTML=`<span class="outcome-icon">${n.icon}</span>${n.label}`,e.addEventListener("click",o=>{o.stopPropagation(),a.querySelectorAll(".outcome-btn").forEach(n=>n.classList.remove("selected")),e.classList.add("selected"),d=n.value}),a.appendChild(e)});const c=document.createElement("input");c.type="text",c.className="remedy-notes-input",c.placeholder="Optional notes...";const l=document.createElement("button");l.type="button",l.className="remedy-submit-btn",l.textContent="Save",l.addEventListener("click",o=>{o.stopPropagation();const t=r.value.trim();t&&d&&(e(n.factor_type,t,d,c.value.trim()||void 0),r.value="",c.value="",d=null,a.querySelectorAll(".outcome-btn").forEach(n=>n.classList.remove("selected")),s.style.display="none",i.style.display="block")});const m=document.createElement("button");m.type="button",m.className="remedy-cancel-btn",m.textContent="Cancel",m.addEventListener("click",n=>{n.stopPropagation(),s.style.display="none",i.style.display="block"});const b=document.createElement("div");b.className="remedy-btn-row",b.appendChild(m),b.appendChild(l),s.appendChild(r),s.appendChild(a),s.appendChild(c),s.appendChild(b),i.addEventListener("click",n=>{n.stopPropagation(),i.style.display="none",s.style.display="block",r.focus()}),t.appendChild(i),t.appendChild(s),o.appendChild(t)}return o}(e,d);if(n.appendChild(r),e.evidence_count>0){const o=document.createElement("div");o.className="factor-evidence-link",o.innerHTML=`<span class="evidence-icon">ⁱ</span> Why these steps? (${e.evidence_count} facts)`,o.addEventListener("click",n=>{n.stopPropagation(),s(e.factor_type)}),n.appendChild(o)}b.appendChild(n)}return b}function Nn(n){switch(n){case"mobius":return"Mobius";case"manual":return"User";default:return"Select"}}const Ln=[{attr:"data-patient-mrn",type:"mrn",source:"context",selector:"#mobius-patient-context"},{attr:"data-selected-patient-mrn",type:"mrn",source:"selected",selector:'.detail-panel[style*="block"]'},{attr:"data-selected-patient-mrn",type:"mrn",source:"selected"},{attr:"data-patient-mrn",type:"mrn",source:"epic"},{attr:"data-patient-name",type:"patient_key",source:"epic"},{attr:"data-epic-mrn",type:"mrn",source:"epic"},{attr:"data-epic-patient-id",type:"patient_key",source:"epic"},{attr:"data-cerner-mrn",type:"mrn",source:"cerner"},{attr:"data-cerner-patient",type:"patient_key",source:"cerner"},{attr:"data-cerner-patient-id",type:"patient_key",source:"cerner"},{attr:"data-athena-record-number",type:"mrn",source:"athena"},{attr:"data-athena-full-name",type:"patient_key",source:"athena"},{attr:"data-athena-patient-id",type:"patient_key",source:"athena"},{attr:"data-allscripts-id",type:"mrn",source:"allscripts"},{attr:"data-allscripts-name",type:"patient_key",source:"allscripts"},{attr:"data-allscripts-mrn",type:"mrn",source:"allscripts"},{attr:"data-netsmart-mrn",type:"mrn",source:"netsmart"},{attr:"data-netsmart-client",type:"patient_key",source:"netsmart"},{attr:"data-qualifacts-mrn",type:"mrn",source:"qualifacts"},{attr:"data-qualifacts-client",type:"patient_key",source:"qualifacts"},{attr:"data-id",type:"mrn",source:"legacy"},{attr:"data-name",type:"patient_key",source:"legacy"},{attr:"data-mrn",type:"mrn",source:"unknown"},{attr:"data-patient-id",type:"patient_key",source:"unknown"},{attr:"data-record-id",type:"mrn",source:"unknown"}],Tn=[{regex:/[?&]mrn=([^&]+)/i,type:"mrn"},{regex:/[?&]MRN=([^&]+)/,type:"mrn"},{regex:/[?&]patient_id=([^&]+)/i,type:"patient_key"},{regex:/[?&]patientId=([^&]+)/i,type:"patient_key"},{regex:/[?&]patient=([^&]+)/i,type:"patient_key"},{regex:/[?&]record_id=([^&]+)/i,type:"mrn"},{regex:/[?&]chart_id=([^&]+)/i,type:"mrn"},{regex:/\/patient\/([A-Za-z0-9-]+)/i,type:"patient_key"},{regex:/\/patients\/([A-Za-z0-9-]+)/i,type:"patient_key"},{regex:/\/chart\/([A-Za-z0-9-]+)/i,type:"mrn"},{regex:/\/record\/([A-Za-z0-9-]+)/i,type:"mrn"},{regex:/\/mrn\/([A-Za-z0-9-]+)/i,type:"mrn"},{regex:/\/Epic\/Patient\/([A-Za-z0-9-]+)/i,type:"patient_key"},{regex:/\/powerchart\/patient\/([A-Za-z0-9-]+)/i,type:"patient_key"},{regex:/\/athenaone\/patient\/([A-Za-z0-9-]+)/i,type:"patient_key"}],$n=[{regex:/MRN[:\s]+([A-Z0-9-]+)/i,type:"mrn"},{regex:/Medical\s*Record\s*(?:Number|#|No\.?)[:\s]+([A-Z0-9-]+)/i,type:"mrn"},{regex:/Record\s*#[:\s]*([A-Z0-9-]+)/i,type:"mrn"},{regex:/Chart\s*#[:\s]*([A-Z0-9-]+)/i,type:"mrn"},{regex:/Patient\s*ID[:\s]+([A-Z0-9-]+)/i,type:"patient_key"},{regex:/Patient\s*#[:\s]*([A-Z0-9-]+)/i,type:"patient_key"},{regex:/Patient\s*Number[:\s]+([A-Z0-9-]+)/i,type:"patient_key"},{regex:/Account\s*#[:\s]*([A-Z0-9-]+)/i,type:"patient_key"},{regex:/Encounter\s*#[:\s]*([A-Z0-9-]+)/i,type:"patient_key"}],Pn={dataAttributes:Ln,urlPatterns:Tn,textPatterns:$n};function qn(n=Ln,e=document){const o=document.getElementById("mobius-patient-context");if(o){const n=o.getAttribute("data-patient-mrn");if(console.log("[PatternMatcher] Context element found, MRN:",n),n&&n.trim())return{id_type:"mrn",id_value:n.trim(),source_hint:"context",confidence:"high",detected_at:(new Date).toISOString()}}for(const o of n){const n=o.selector?`${o.selector}[${o.attr}]`:`[${o.attr}]`,t=e.querySelector(n);if(t){const n=t.getAttribute(o.attr);if(n&&n.trim())return console.log("[PatternMatcher] Found:",o.attr,"=",n,"on",t.id||t.className),{id_type:o.type,id_value:n.trim(),source_hint:o.source,confidence:"high",detected_at:(new Date).toISOString()}}}return null}function In(n=Tn,e=window.location.href){for(const o of n){const n="string"==typeof o.regex?new RegExp(o.regex):o.regex,t=e.match(n);if(t){const n=t[o.captureGroup??1];if(n&&n.trim())return{id_type:o.type,id_value:decodeURIComponent(n.trim()),source_hint:"url",confidence:"high",detected_at:(new Date).toISOString()}}}return null}function Bn(n=$n,e=document){for(const o of n){const n="string"==typeof o.regex?new RegExp(o.regex):o.regex;let t;if(o.selector){const n=e.querySelector(o.selector);t=n?.textContent||""}else{const n=["header",'[class*="patient"]','[class*="header"]','[class*="banner"]','[id*="patient"]',"main"];t="";for(const o of n)e.querySelectorAll(o).forEach(n=>{t+=" "+(n.textContent||"")});t.trim()||(t=e.body?.textContent||"")}const i=t.match(n);if(i){const n=i[o.captureGroup??1];if(n&&n.trim())return{id_type:o.type,id_value:n.trim(),source_hint:"text",confidence:"medium",detected_at:(new Date).toISOString()}}}return null}function Dn(n,e){return{dataAttributes:[...e.dataAttributes||[],...n.dataAttributes],urlPatterns:[...e.urlPatterns||[],...n.urlPatterns],textPatterns:[...e.textPatterns||[],...n.textPatterns]}}const Rn={debounceMs:500,strategies:["dataAttributes","url","domText"],customPatterns:{},autoStart:!1,observeMutations:!0};class Hn{constructor(n={}){this.observer=null,this.debounceTimer=null,this.isRunning=!1,this.currentPatient=null,this.listeners=new Map,this.lastUrl="",this.options={...Rn,...n},this.patterns=Dn(Pn,this.options.customPatterns||{}),this.listeners.set("patientDetected",new Set),this.listeners.set("patientChanged",new Set),this.listeners.set("patientCleared",new Set),this.listeners.set("detectionError",new Set),this.options.autoStart&&this.start()}start(){this.isRunning?console.log("[PatientContextDetector] Already running"):(console.log("[PatientContextDetector] Starting..."),this.isRunning=!0,this.lastUrl=window.location.href,this.scheduleDetection(),this.setupUrlChangeDetection(),this.options.observeMutations&&this.setupMutationObserver())}stop(){this.isRunning&&(console.log("[PatientContextDetector] Stopping..."),this.isRunning=!1,null!==this.debounceTimer&&(window.clearTimeout(this.debounceTimer),this.debounceTimer=null),this.observer&&(this.observer.disconnect(),this.observer=null))}detect(){try{const n=function(n=["dataAttributes","url","domText"],e=Pn){for(const o of n){let n=null;switch(o){case"dataAttributes":n=qn(e.dataAttributes);break;case"url":n=In(e.urlPatterns);break;case"domText":n=Bn(e.textPatterns)}if(n)return n}return null}(this.options.strategies,this.patterns);return this.handleDetectionResult(n),n}catch(n){return console.error("[PatientContextDetector] Detection error:",n),this.emit("detectionError",null),null}}on(n,e){const o=this.listeners.get(n);return o&&o.add(e),()=>this.off(n,e)}off(n,e){const o=this.listeners.get(n);o&&o.delete(e)}getCurrentPatient(){return this.currentPatient}updatePatterns(n){this.patterns=Dn(Pn,n),this.isRunning&&this.scheduleDetection()}updatePatternsFromConfig(n){const e=function(n){if(!n||"object"!=typeof n)return{};const e={},o=n;return Array.isArray(o.dataAttributes)&&(e.dataAttributes=o.dataAttributes),Array.isArray(o.urlPatterns)&&(e.urlPatterns=o.urlPatterns.map(n=>({regex:new RegExp(n.regex),type:n.type,captureGroup:n.captureGroup}))),Array.isArray(o.textPatterns)&&(e.textPatterns=o.textPatterns.map(n=>({regex:new RegExp(n.regex),type:n.type,captureGroup:n.captureGroup,selector:n.selector}))),e}(n);this.updatePatterns(e)}isActive(){return this.isRunning}setupMutationObserver(){this.observer=new MutationObserver(n=>{n.some(n=>{if(n.addedNodes.length>0||n.removedNodes.length>0)return!0;if("attributes"===n.type){const e=n.target,o=n.attributeName||"";return(o.includes("patient")||o.includes("mrn")||o.includes("selected"))&&console.log("[PatientContextDetector] Attribute mutation:",o,"on",e.id||e.className),this.patterns.dataAttributes.some(n=>n.attr===o)||o.includes("patient")||o.includes("mrn")||o.includes("id")}return!1})&&(console.log("[PatientContextDetector] Relevant mutation detected, scheduling detection"),this.scheduleDetection())}),this.observer.observe(document.body,{childList:!0,subtree:!0,attributes:!0})}setupUrlChangeDetection(){window.addEventListener("popstate",()=>{window.location.href!==this.lastUrl&&(this.lastUrl=window.location.href,this.scheduleDetection())});const n=new MutationObserver(()=>{window.location.href!==this.lastUrl&&(this.lastUrl=window.location.href,this.scheduleDetection())}),e=document.querySelector("title");e&&n.observe(e,{childList:!0,characterData:!0}),setInterval(()=>{this.isRunning&&window.location.href!==this.lastUrl&&(this.lastUrl=window.location.href,this.scheduleDetection())},1e3)}scheduleDetection(){null!==this.debounceTimer&&window.clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.debounceTimer=null,this.detect()},this.options.debounceMs)}handleDetectionResult(n){const e=this.currentPatient;null===n&&null!==e?(this.currentPatient=null,this.emit("patientCleared",null),console.log("[PatientContextDetector] Patient context cleared")):null!==n&&null===e?(this.currentPatient=n,this.emit("patientDetected",n),console.log("[PatientContextDetector] Patient detected:",n)):null!==n&&null!==e&&(this.isSamePatient(n,e)||(this.currentPatient=n,this.emit("patientChanged",n),console.log("[PatientContextDetector] Patient changed:",n)))}isSamePatient(n,e){return n.id_type===e.id_type&&n.id_value===e.id_value}emit(n,e){const o=this.listeners.get(n);o&&o.forEach(o=>{try{o(e,n)}catch(e){console.error(`[PatientContextDetector] Error in ${n} listener:`,e)}})}}const jn=h;function Un(n){const e=document.createElement("div");return e.textContent=n,e.innerHTML}const On={"status-resolved":{title:"Resolved",description:"This item has been completed successfully.",icon:"✓",colorClass:"tooltip-green"},"status-blocked":{title:"Needs Attention",description:"This item requires action before proceeding.",icon:"⚠️",colorClass:"tooltip-yellow"},"status-waiting":{title:"In Progress",description:"Waiting for a response or external action.",icon:"◯",colorClass:"tooltip-blue"},"status-pending":{title:"Pending",description:"Not yet started.",icon:"○",colorClass:"tooltip-grey"},"user-resolved":{title:"Marked as Resolved",description:"You marked this as done. The system may still monitor it.",icon:"✓",colorClass:"tooltip-green"},"user-flagged":{title:"Flagged for Attention",description:"You flagged this as needing work.",icon:"⚠",colorClass:"tooltip-orange"},"mode-mobius":{title:"Mobius Handles",description:"Mobius will automatically complete this task. You'll be notified when done.",icon:"🤖",colorClass:"tooltip-purple"},"mode-together":{title:"Work Together",description:"Collaborate with Mobius on this task.",icon:"🤝",colorClass:"tooltip-blue"},"mode-manual":{title:"You Handle",description:"You'll complete this task yourself.",icon:"👤",colorClass:"tooltip-grey"},"action-done":{title:"Mark as Done",description:"Complete this step and record the outcome.",icon:"✓"},"action-skip":{title:"Skip Step",description:"Skip this step if not applicable.",icon:"⊘"},"action-delegate":{title:"Delegate to Mobius",description:"Let Mobius handle this step automatically.",icon:"→"},"remedy-worked":{title:"Worked",description:"This remedy resolved the issue.",icon:"✓",colorClass:"tooltip-green"},"remedy-partial":{title:"Partially Worked",description:"This remedy helped but didn't fully resolve the issue.",icon:"◐",colorClass:"tooltip-yellow"},"remedy-failed":{title:"Did Not Work",description:"This remedy did not resolve the issue.",icon:"✗",colorClass:"tooltip-red"},"readiness-high":{title:"Ready for Care",description:"Patient is ready for affordable care. All critical factors resolved.",colorClass:"tooltip-green"},"readiness-medium":{title:"Almost Ready",description:"Most factors resolved. A few items need attention.",colorClass:"tooltip-yellow"},"readiness-low":{title:"Needs Work",description:"Several factors need resolution before care can proceed.",colorClass:"tooltip-orange"},"readiness-starting":{title:"Getting Started",description:"Beginning the care preparation journey.",colorClass:"tooltip-grey"},"direction-improving":{title:"Improving",description:"Care readiness is trending upward.",icon:"↑",colorClass:"tooltip-green"},"direction-declining":{title:"Needs Attention",description:"Care readiness has decreased. Review recent changes.",icon:"↓",colorClass:"tooltip-red"},"direction-stable":{title:"Stable",description:"Care readiness is holding steady.",icon:"→",colorClass:"tooltip-blue"},"alert-bell":{title:"Alerts",description:"Click to view notifications and updates.",icon:"🔔"},"alert-high-priority":{title:"High Priority Alert",description:"Urgent items require your attention.",colorClass:"tooltip-red"},"alert-win":{title:"Success!",description:"A task was completed successfully.",colorClass:"tooltip-green"},"alert-update":{title:"Update",description:"New information is available.",colorClass:"tooltip-blue"},"alert-reminder":{title:"Reminder",description:"A follow-up is needed.",colorClass:"tooltip-yellow"},"proceed-green":{title:"Good to Proceed",description:"No blockers detected. Care can proceed.",colorClass:"tooltip-green"},"proceed-yellow":{title:"Review Needed",description:"Some items may need attention before proceeding.",colorClass:"tooltip-yellow"},"proceed-red":{title:"Blocked",description:"Critical issues must be resolved before proceeding.",colorClass:"tooltip-red"},"proceed-blue":{title:"In Progress",description:"Work is ongoing.",colorClass:"tooltip-blue"},"proceed-grey":{title:"Unknown",description:"Status is being determined.",colorClass:"tooltip-grey"},"factor-focus":{title:"Your Focus",description:"This factor is recommended for your role and should be addressed first.",icon:"◀",colorClass:"tooltip-purple"},"evidence-link":{title:"View Evidence",description:"See the facts and data behind these recommendations.",icon:"ⁱ"},"confidence-looks-good":{title:"Looks Good",description:"System is confident this factor is resolved.",colorClass:"tooltip-green"},"confidence-needs-help":{title:"Needs Your Help",description:"System detected an issue that requires human action.",colorClass:"tooltip-orange"},"confidence-almost-there":{title:"Almost There",description:"Waiting for external confirmation or response.",colorClass:"tooltip-yellow"},"mini-greeting-dismiss":{title:"Hide Greeting",description:"Dismiss this greeting. You can re-enable it in preferences."},"mini-chevron":{title:"User Menu",description:"Click for user options, preferences, and sign out."},"mini-settings":{title:"Settings",description:"Open Mobius preferences and configuration."},"assignee-mobius":{title:"Assigned to Mobius",description:"Mobius will handle this step.",icon:"🤖",colorClass:"tooltip-purple"},"assignee-user":{title:"Assigned to You",description:"This step requires your action.",icon:"👤",colorClass:"tooltip-blue"}};function Fn(n,e){const o=On[e];o?(n.dataset.mobiusTooltip=o.title,o.description&&(n.dataset.mobiusTooltipDesc=o.description),o.colorClass&&(n.dataset.mobiusTooltipColor=o.colorClass),n.classList.add("has-mobius-tooltip")):console.warn(`[Tooltips] Unknown tooltip key: ${e}`)}function Gn(n){n.querySelectorAll(".factor-status-icon").forEach(n=>{const e=n.textContent?.trim();"✓"===e?Fn(n,"status-resolved"):"⚠️"===e||"⚠"===e?Fn(n,"status-blocked"):"◯"===e?Fn(n,"status-waiting"):"○"===e&&Fn(n,"status-pending")}),n.querySelectorAll(".factor-mode-indicator, .step-icon").forEach(n=>{const e=n.textContent?.trim();"🤖"===e?Fn(n,"mode-mobius"):"🤝"===e?Fn(n,"mode-together"):"👤"===e&&Fn(n,"mode-manual")}),n.querySelectorAll(".factor-focus-badge").forEach(n=>{Fn(n,"factor-focus")}),n.querySelectorAll(".factor-evidence-link").forEach(n=>{Fn(n,"evidence-link")}),n.querySelectorAll(".factor-resolved-badge").forEach(n=>{Fn(n,"user-resolved")}),n.querySelectorAll(".factor-flagged-badge").forEach(n=>{Fn(n,"user-flagged")}),n.querySelectorAll(".done-btn").forEach(n=>{Fn(n,"action-done")}),n.querySelectorAll(".skip-btn").forEach(n=>{Fn(n,"action-skip")}),n.querySelectorAll(".delegate-btn").forEach(n=>{Fn(n,"action-delegate")}),n.querySelectorAll(".remedy-worked").forEach(n=>{Fn(n,"remedy-worked")}),n.querySelectorAll(".remedy-partial").forEach(n=>{Fn(n,"remedy-partial")}),n.querySelectorAll(".remedy-failed").forEach(n=>{Fn(n,"remedy-failed")}),n.querySelectorAll(".sidecar-alert-indicator").forEach(n=>{Fn(n,"alert-bell")}),n.querySelectorAll(".sidecar-alert-badge--high").forEach(n=>{Fn(n,"alert-high-priority")}),n.querySelectorAll(".status-indicator").forEach(n=>{const e=n.className;e.includes("status-green")||e.includes("status-proceed")?Fn(n,"proceed-green"):e.includes("status-yellow")||e.includes("status-pending")?Fn(n,"proceed-yellow"):e.includes("status-red")||e.includes("status-error")?Fn(n,"proceed-red"):e.includes("status-blue")?Fn(n,"proceed-blue"):e.includes("status-grey")&&Fn(n,"proceed-grey")}),n.querySelectorAll(".sidecar-status-bar-marker").forEach(n=>{const e=n.closest(".sidecar-status-bar"),o=e?.querySelector(".sidecar-status-bar-percent")?.textContent;if(o){const e=parseInt(o);Fn(n,e>=90?"readiness-high":e>=70?"readiness-medium":e>=30?"readiness-low":"readiness-starting")}}),n.querySelectorAll(".mobius-mini-greeting-dismiss").forEach(n=>{Fn(n,"mini-greeting-dismiss")}),n.querySelectorAll(".mobius-mini-greeting-chevron").forEach(n=>{Fn(n,"mini-chevron")})}const Yn=new WeakMap;function Wn(n){!function(){if(document.getElementById("mobius-tooltip-styles"))return;const n=document.createElement("style");n.id="mobius-tooltip-styles",n.textContent='\n/* =============================================================================\n   Mobius Tooltip Styles\n   ============================================================================= */\n\n/* Base tooltip container */\n.has-mobius-tooltip {\n  position: relative;\n  cursor: help;\n}\n\n/* Tooltip pseudo-element */\n.has-mobius-tooltip::before,\n.has-mobius-tooltip::after {\n  position: absolute;\n  opacity: 0;\n  visibility: hidden;\n  pointer-events: none;\n  transition: opacity 0.2s ease, visibility 0.2s ease, transform 0.2s ease;\n  z-index: 10000;\n}\n\n/* Tooltip arrow */\n.has-mobius-tooltip::before {\n  content: \'\';\n  border: 6px solid transparent;\n  border-top-color: #1e293b;\n  bottom: 100%;\n  left: 50%;\n  transform: translateX(-50%) translateY(4px);\n}\n\n/* Tooltip content box */\n.has-mobius-tooltip::after {\n  content: attr(data-mobius-tooltip);\n  bottom: calc(100% + 8px);\n  left: 50%;\n  transform: translateX(-50%) translateY(4px);\n  \n  /* Styling */\n  background: #1e293b;\n  color: #f8fafc;\n  padding: 6px 10px;\n  border-radius: 6px;\n  font-size: 11px;\n  font-weight: 500;\n  line-height: 1.4;\n  white-space: nowrap;\n  max-width: 280px;\n  text-align: center;\n  \n  /* Shadow */\n  box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);\n}\n\n/* Show tooltip on hover */\n.has-mobius-tooltip:hover::before,\n.has-mobius-tooltip:hover::after {\n  opacity: 1;\n  visibility: visible;\n  transform: translateX(-50%) translateY(0);\n}\n\n/* Tooltip with description (two-line) */\n.has-mobius-tooltip[data-mobius-tooltip-desc]::after {\n  content: attr(data-mobius-tooltip) "\\A" attr(data-mobius-tooltip-desc);\n  white-space: pre-wrap;\n  text-align: left;\n  min-width: 180px;\n}\n\n/* Color variants - border accent on left */\n.has-mobius-tooltip[data-mobius-tooltip-color="tooltip-green"]::after {\n  border-left: 3px solid #22c55e;\n}\n\n.has-mobius-tooltip[data-mobius-tooltip-color="tooltip-yellow"]::after {\n  border-left: 3px solid #eab308;\n}\n\n.has-mobius-tooltip[data-mobius-tooltip-color="tooltip-orange"]::after {\n  border-left: 3px solid #f97316;\n}\n\n.has-mobius-tooltip[data-mobius-tooltip-color="tooltip-red"]::after {\n  border-left: 3px solid #ef4444;\n}\n\n.has-mobius-tooltip[data-mobius-tooltip-color="tooltip-blue"]::after {\n  border-left: 3px solid #3b82f6;\n}\n\n.has-mobius-tooltip[data-mobius-tooltip-color="tooltip-purple"]::after {\n  border-left: 3px solid #a855f7;\n}\n\n.has-mobius-tooltip[data-mobius-tooltip-color="tooltip-grey"]::after {\n  border-left: 3px solid #94a3b8;\n}\n\n/* Position variants for edge cases */\n.has-mobius-tooltip.tooltip-right::before {\n  left: auto;\n  right: 50%;\n  transform: translateX(50%) translateY(4px);\n}\n\n.has-mobius-tooltip.tooltip-right::after {\n  left: auto;\n  right: 0;\n  transform: translateX(0) translateY(4px);\n}\n\n.has-mobius-tooltip.tooltip-right:hover::before,\n.has-mobius-tooltip.tooltip-right:hover::after {\n  transform: translateX(0) translateY(0);\n}\n\n.has-mobius-tooltip.tooltip-left::before {\n  left: 50%;\n  right: auto;\n  transform: translateX(-50%) translateY(4px);\n}\n\n.has-mobius-tooltip.tooltip-left::after {\n  left: 0;\n  right: auto;\n  transform: translateX(0) translateY(4px);\n}\n\n.has-mobius-tooltip.tooltip-left:hover::before,\n.has-mobius-tooltip.tooltip-left:hover::after {\n  transform: translateX(0) translateY(0);\n}\n\n/* Bottom position */\n.has-mobius-tooltip.tooltip-bottom::before {\n  top: 100%;\n  bottom: auto;\n  border-top-color: transparent;\n  border-bottom-color: #1e293b;\n  transform: translateX(-50%) translateY(-4px);\n}\n\n.has-mobius-tooltip.tooltip-bottom::after {\n  top: calc(100% + 8px);\n  bottom: auto;\n  transform: translateX(-50%) translateY(-4px);\n}\n\n.has-mobius-tooltip.tooltip-bottom:hover::before,\n.has-mobius-tooltip.tooltip-bottom:hover::after {\n  transform: translateX(-50%) translateY(0);\n}\n\n/* Disable tooltip on buttons during click (prevents flicker) */\n.has-mobius-tooltip:active::before,\n.has-mobius-tooltip:active::after {\n  opacity: 0;\n}\n\n/* Respect reduced motion preference */\n@media (prefers-reduced-motion: reduce) {\n  .has-mobius-tooltip::before,\n  .has-mobius-tooltip::after {\n    transition: none;\n  }\n}\n\n/* Dark mode support (if needed) */\n@media (prefers-color-scheme: dark) {\n  .has-mobius-tooltip::after {\n    background: #334155;\n    color: #f1f5f9;\n  }\n  \n  .has-mobius-tooltip::before {\n    border-top-color: #334155;\n  }\n  \n  .has-mobius-tooltip.tooltip-bottom::before {\n    border-bottom-color: #334155;\n  }\n}\n',document.head.appendChild(n)}(),function(n){if(Yn.has(n))return;Gn(n);const e=new MutationObserver(e=>{let o=!1;for(const n of e)if("childList"===n.type&&n.addedNodes.length>0){o=!0;break}o&&Gn(n)});e.observe(n,{childList:!0,subtree:!0}),Yn.set(n,e)}(n)}function Xn(){if(document.getElementById("mobius-base-css"))return;const n=document.createElement("style");n.id="mobius-base-css",n.textContent="\n/* =============================================================================\n   MOBIUS BASE STYLES\n   Uses CSS variables from themes.ts for consistent styling\n   ============================================================================= */\n\n/* Typography */\n.mobius-text-xs { font-size: var(--mobius-font-xs); }\n.mobius-text-sm { font-size: var(--mobius-font-sm); }\n.mobius-text-base { font-size: var(--mobius-font-base); }\n.mobius-text-md { font-size: var(--mobius-font-md); }\n.mobius-text-lg { font-size: var(--mobius-font-lg); }\n.mobius-text-xl { font-size: var(--mobius-font-xl); }\n\n.mobius-text-primary { color: var(--mobius-text-primary); }\n.mobius-text-secondary { color: var(--mobius-text-secondary); }\n.mobius-text-muted { color: var(--mobius-text-muted); }\n.mobius-text-accent { color: var(--mobius-accent); }\n.mobius-text-success { color: var(--mobius-success); }\n.mobius-text-warning { color: var(--mobius-warning); }\n.mobius-text-error { color: var(--mobius-error); }\n\n/* Spacing */\n.mobius-p-xs { padding: var(--mobius-space-xs); }\n.mobius-p-sm { padding: var(--mobius-space-sm); }\n.mobius-p-base { padding: var(--mobius-space-base); }\n.mobius-p-md { padding: var(--mobius-space-md); }\n.mobius-p-lg { padding: var(--mobius-space-lg); }\n\n.mobius-m-xs { margin: var(--mobius-space-xs); }\n.mobius-m-sm { margin: var(--mobius-space-sm); }\n.mobius-m-base { margin: var(--mobius-space-base); }\n.mobius-m-md { margin: var(--mobius-space-md); }\n.mobius-m-lg { margin: var(--mobius-space-lg); }\n\n.mobius-gap-xs { gap: var(--mobius-space-xs); }\n.mobius-gap-sm { gap: var(--mobius-space-sm); }\n.mobius-gap-base { gap: var(--mobius-space-base); }\n.mobius-gap-md { gap: var(--mobius-space-md); }\n.mobius-gap-lg { gap: var(--mobius-space-lg); }\n\n/* Backgrounds */\n.mobius-bg-primary { background-color: var(--mobius-bg-primary); }\n.mobius-bg-secondary { background-color: var(--mobius-bg-secondary); }\n.mobius-bg-tertiary { background-color: var(--mobius-bg-tertiary); }\n.mobius-bg-accent { background-color: var(--mobius-accent); }\n\n/* Borders */\n.mobius-border { border: 1px solid var(--mobius-border); }\n.mobius-border-light { border: 1px solid var(--mobius-border-light); }\n.mobius-rounded-sm { border-radius: var(--mobius-radius-sm); }\n.mobius-rounded { border-radius: var(--mobius-radius-base); }\n.mobius-rounded-lg { border-radius: var(--mobius-radius-lg); }\n\n/* Shadows */\n.mobius-shadow { box-shadow: 0 1px 3px var(--mobius-shadow); }\n.mobius-shadow-md { box-shadow: 0 4px 6px var(--mobius-shadow), 0 1px 3px var(--mobius-shadow); }\n.mobius-shadow-lg { box-shadow: 0 10px 15px var(--mobius-shadow-strong), 0 4px 6px var(--mobius-shadow); }\n\n/* =============================================================================\n   MINI WIDGET STYLES\n   ============================================================================= */\n\n.mobius-mini-widget {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  background: var(--mobius-bg-primary);\n  color: var(--mobius-text-primary);\n  border-radius: var(--mobius-radius-lg);\n  box-shadow: 0 4px 12px var(--mobius-shadow-strong);\n  border: 1px solid var(--mobius-border);\n  overflow: hidden;\n}\n\n.mobius-mini-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: var(--mobius-space-sm) var(--mobius-space-md);\n  background: var(--mobius-bg-secondary);\n  border-bottom: 1px solid var(--mobius-border-light);\n}\n\n.mobius-mini-logo {\n  font-size: var(--mobius-font-base);\n  font-weight: 600;\n  color: var(--mobius-text-primary);\n}\n\n.mobius-mini-greeting {\n  font-size: var(--mobius-font-sm);\n  color: var(--mobius-text-secondary);\n  padding: var(--mobius-space-sm) var(--mobius-space-md);\n}\n\n.mobius-mini-patient {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm);\n  padding: var(--mobius-space-sm) var(--mobius-space-md);\n  background: var(--mobius-bg-secondary);\n}\n\n.mobius-mini-patient-name {\n  font-size: var(--mobius-font-sm);\n  font-weight: 500;\n  color: var(--mobius-text-primary);\n}\n\n.mobius-mini-patient-id {\n  font-size: var(--mobius-font-xs);\n  color: var(--mobius-text-muted);\n}\n\n.mobius-mini-status {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-xs);\n  padding: var(--mobius-space-sm) var(--mobius-space-md);\n  font-size: var(--mobius-font-sm);\n}\n\n.mobius-mini-status-dot {\n  width: 8px;\n  height: 8px;\n  border-radius: 50%;\n}\n\n.mobius-mini-status-dot.green { background: var(--mobius-success); }\n.mobius-mini-status-dot.yellow { background: var(--mobius-warning); }\n.mobius-mini-status-dot.red { background: var(--mobius-error); }\n\n.mobius-mini-plan {\n  padding: var(--mobius-space-sm) var(--mobius-space-md);\n  font-size: var(--mobius-font-sm);\n}\n\n.mobius-mini-plan-link {\n  color: var(--mobius-accent);\n  cursor: pointer;\n}\n\n.mobius-mini-plan-link:hover {\n  text-decoration: underline;\n}\n\n.mobius-mini-note {\n  display: flex;\n  gap: var(--mobius-space-sm);\n  padding: var(--mobius-space-sm) var(--mobius-space-md);\n  border-top: 1px solid var(--mobius-border-light);\n}\n\n.mobius-mini-note-input {\n  flex: 1;\n  border: 1px solid var(--mobius-border);\n  border-radius: var(--mobius-radius-sm);\n  padding: var(--mobius-space-xs) var(--mobius-space-sm);\n  font-size: var(--mobius-font-sm);\n  background: var(--mobius-bg-primary);\n  color: var(--mobius-text-primary);\n}\n\n.mobius-mini-note-input::placeholder {\n  color: var(--mobius-text-muted);\n}\n\n.mobius-mini-note-btn {\n  background: var(--mobius-accent);\n  color: var(--mobius-accent-text);\n  border: none;\n  border-radius: var(--mobius-radius-sm);\n  padding: var(--mobius-space-xs) var(--mobius-space-sm);\n  cursor: pointer;\n  font-size: var(--mobius-font-sm);\n}\n\n.mobius-mini-note-btn:hover {\n  background: var(--mobius-accent-hover);\n}\n\n/* =============================================================================\n   SIDECAR STYLES\n   ============================================================================= */\n\n.mobius-sidecar {\n  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  background: var(--mobius-bg-primary);\n  color: var(--mobius-text-primary);\n  height: 100%;\n  display: flex;\n  flex-direction: column;\n}\n\n.mobius-sidecar-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: var(--mobius-space-md);\n  background: var(--mobius-bg-secondary);\n  border-bottom: 1px solid var(--mobius-border);\n}\n\n.mobius-sidecar-title {\n  font-size: var(--mobius-font-md);\n  font-weight: 600;\n}\n\n.mobius-sidecar-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: var(--mobius-space-md);\n}\n\n.mobius-sidecar-section {\n  margin-bottom: var(--mobius-space-lg);\n}\n\n.mobius-sidecar-section-title {\n  font-size: var(--mobius-font-sm);\n  font-weight: 600;\n  color: var(--mobius-text-secondary);\n  margin-bottom: var(--mobius-space-sm);\n  text-transform: uppercase;\n  letter-spacing: 0.5px;\n}\n\n/* Factor Cards */\n.mobius-factor-card {\n  background: var(--mobius-bg-secondary);\n  border: 1px solid var(--mobius-border);\n  border-radius: var(--mobius-radius-base);\n  margin-bottom: var(--mobius-space-sm);\n  overflow: hidden;\n}\n\n.mobius-factor-card-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: var(--mobius-space-sm) var(--mobius-space-md);\n  cursor: pointer;\n}\n\n.mobius-factor-card-header:hover {\n  background: var(--mobius-bg-hover);\n}\n\n.mobius-factor-card-title {\n  font-size: var(--mobius-font-sm);\n  font-weight: 500;\n}\n\n.mobius-factor-card-status {\n  font-size: var(--mobius-font-xs);\n  padding: var(--mobius-space-xs) var(--mobius-space-sm);\n  border-radius: var(--mobius-radius-sm);\n}\n\n.mobius-factor-card-status.success {\n  background: color-mix(in srgb, var(--mobius-success) 15%, transparent);\n  color: var(--mobius-success);\n}\n\n.mobius-factor-card-status.warning {\n  background: color-mix(in srgb, var(--mobius-warning) 15%, transparent);\n  color: var(--mobius-warning);\n}\n\n.mobius-factor-card-status.error {\n  background: color-mix(in srgb, var(--mobius-error) 15%, transparent);\n  color: var(--mobius-error);\n}\n\n.mobius-factor-card-body {\n  padding: var(--mobius-space-sm) var(--mobius-space-md);\n  border-top: 1px solid var(--mobius-border-light);\n}\n\n/* Steps */\n.mobius-step {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm);\n  padding: var(--mobius-space-xs) 0;\n  font-size: var(--mobius-font-sm);\n}\n\n.mobius-step-indicator {\n  width: var(--mobius-icon-sm);\n  height: var(--mobius-icon-sm);\n  border-radius: 50%;\n  border: 2px solid var(--mobius-border);\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  font-size: 8px;\n}\n\n.mobius-step-indicator.done {\n  background: var(--mobius-success);\n  border-color: var(--mobius-success);\n  color: white;\n}\n\n.mobius-step-indicator.current {\n  border-color: var(--mobius-accent);\n  background: var(--mobius-accent);\n  color: white;\n}\n\n.mobius-step-label {\n  flex: 1;\n  color: var(--mobius-text-primary);\n}\n\n.mobius-step-label.muted {\n  color: var(--mobius-text-muted);\n}\n\n/* Buttons */\n.mobius-btn {\n  display: inline-flex;\n  align-items: center;\n  justify-content: center;\n  gap: var(--mobius-space-xs);\n  height: var(--mobius-button-height);\n  padding: 0 var(--mobius-space-md);\n  font-size: var(--mobius-font-sm);\n  font-weight: 500;\n  border-radius: var(--mobius-radius-base);\n  cursor: pointer;\n  transition: all 0.15s ease;\n  border: none;\n}\n\n.mobius-btn-primary {\n  background: var(--mobius-accent);\n  color: var(--mobius-accent-text);\n}\n\n.mobius-btn-primary:hover {\n  background: var(--mobius-accent-hover);\n}\n\n.mobius-btn-secondary {\n  background: var(--mobius-bg-tertiary);\n  color: var(--mobius-text-primary);\n  border: 1px solid var(--mobius-border);\n}\n\n.mobius-btn-secondary:hover {\n  background: var(--mobius-bg-hover);\n}\n\n.mobius-btn-ghost {\n  background: transparent;\n  color: var(--mobius-text-secondary);\n}\n\n.mobius-btn-ghost:hover {\n  background: var(--mobius-bg-hover);\n  color: var(--mobius-text-primary);\n}\n\n.mobius-btn-sm {\n  height: calc(var(--mobius-button-height) - 4px);\n  padding: 0 var(--mobius-space-sm);\n  font-size: var(--mobius-font-xs);\n}\n\n/* Menu */\n.mobius-menu {\n  background: var(--mobius-bg-primary);\n  border: 1px solid var(--mobius-border);\n  border-radius: var(--mobius-radius-base);\n  box-shadow: 0 4px 12px var(--mobius-shadow-strong);\n  min-width: 180px;\n  padding: var(--mobius-space-xs) 0;\n}\n\n.mobius-menu-item {\n  display: flex;\n  align-items: center;\n  gap: var(--mobius-space-sm);\n  padding: var(--mobius-space-sm) var(--mobius-space-md);\n  font-size: var(--mobius-font-sm);\n  color: var(--mobius-text-primary);\n  cursor: pointer;\n}\n\n.mobius-menu-item:hover {\n  background: var(--mobius-bg-hover);\n}\n\n.mobius-menu-item.active {\n  background: var(--mobius-bg-active);\n}\n\n.mobius-menu-divider {\n  height: 1px;\n  background: var(--mobius-border-light);\n  margin: var(--mobius-space-xs) 0;\n}\n\n/* Input */\n.mobius-input {\n  width: 100%;\n  height: var(--mobius-input-height);\n  padding: 0 var(--mobius-space-sm);\n  font-size: var(--mobius-font-sm);\n  background: var(--mobius-bg-primary);\n  color: var(--mobius-text-primary);\n  border: 1px solid var(--mobius-border);\n  border-radius: var(--mobius-radius-base);\n}\n\n.mobius-input:focus {\n  outline: none;\n  border-color: var(--mobius-accent);\n  box-shadow: 0 0 0 3px color-mix(in srgb, var(--mobius-accent) 20%, transparent);\n}\n\n.mobius-input::placeholder {\n  color: var(--mobius-text-muted);\n}\n\n/* Badges */\n.mobius-badge {\n  display: inline-flex;\n  align-items: center;\n  padding: var(--mobius-space-xs) var(--mobius-space-sm);\n  font-size: var(--mobius-font-xs);\n  font-weight: 500;\n  border-radius: var(--mobius-radius-sm);\n}\n\n.mobius-badge-success {\n  background: color-mix(in srgb, var(--mobius-success) 15%, transparent);\n  color: var(--mobius-success);\n}\n\n.mobius-badge-warning {\n  background: color-mix(in srgb, var(--mobius-warning) 15%, transparent);\n  color: var(--mobius-warning);\n}\n\n.mobius-badge-error {\n  background: color-mix(in srgb, var(--mobius-error) 15%, transparent);\n  color: var(--mobius-error);\n}\n\n.mobius-badge-info {\n  background: color-mix(in srgb, var(--mobius-info) 15%, transparent);\n  color: var(--mobius-info);\n}\n\n/* Toggle */\n.mobius-toggle {\n  position: relative;\n  display: inline-flex;\n  width: 36px;\n  height: 20px;\n  cursor: pointer;\n}\n\n.mobius-toggle input {\n  opacity: 0;\n  width: 0;\n  height: 0;\n}\n\n.mobius-toggle-slider {\n  position: absolute;\n  inset: 0;\n  background: var(--mobius-bg-tertiary);\n  border-radius: 10px;\n  transition: 0.2s;\n}\n\n.mobius-toggle-slider:before {\n  position: absolute;\n  content: \"\";\n  height: 16px;\n  width: 16px;\n  left: 2px;\n  bottom: 2px;\n  background: white;\n  border-radius: 50%;\n  transition: 0.2s;\n  box-shadow: 0 1px 3px var(--mobius-shadow);\n}\n\n.mobius-toggle input:checked + .mobius-toggle-slider {\n  background: var(--mobius-accent);\n}\n\n.mobius-toggle input:checked + .mobius-toggle-slider:before {\n  transform: translateX(16px);\n}\n",document.head.appendChild(n)}let Jn,Vn=null;const Zn="mobius-os-mini",Kn="mobius-os-mini-modal",Qn="mobius-os-mini-toast",ne="mobius.allowedDomains",ee="mobius.miniPos",oe="mobius.patientOverride";let te="light",ie="normal",se=null,re={color:"grey",text:"Proceed: Not assessed"},ae={color:"grey",text:"Tasking: Not applicable"},de=null,ce=null,le=null,me={color:"grey",problemStatement:null,userStatus:null},be=0,ue=null,pe=0,ge=null,fe=null,xe=null,he=null,ve=null,ye=!1,we=!1;async function ke(){if(!we)try{await async function(n){V?console.log("[ToastManager] Already initialized"):(console.log("[ToastManager] Initializing..."),n?.onAction&&(tn=n.onAction),n?.onJumpToPatient&&(sn=n.onJumpToPatient),on=await async function(){return new Promise(n=>{if("undefined"!=typeof chrome&&chrome.storage?.local)chrome.storage.local.get([X],e=>{n(!1!==e[X])});else{const e=localStorage.getItem(X);n("false"!==e)}})}(),function(){const n=document.getElementById(W);n&&n.remove();const e=document.createElement("div");e.id=W,e.setAttribute("style","\n    position: fixed !important;\n    top: 16px !important;\n    right: 16px !important;\n    z-index: 2147483647 !important;\n    display: flex !important;\n    flex-direction: column !important;\n    gap: 8px !important;\n    pointer-events: none !important;\n    max-width: 320px !important;\n  "),document.body.appendChild(e),function(){const n="mobius-toast-styles";if(document.getElementById(n))return;const e=document.createElement("style");e.id=n,e.textContent="\n    .mobius-toast {\n      pointer-events: auto !important;\n      background: rgba(255, 255, 255, 0.95) !important;\n      backdrop-filter: blur(8px) !important;\n      border-radius: 6px !important;\n      box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1) !important;\n      padding: 6px 10px !important;\n      display: flex !important;\n      align-items: center !important;\n      gap: 6px !important;\n      cursor: pointer !important;\n      animation: mobius-toast-enter 0.2s ease-out !important;\n      border: 1px solid rgba(11, 18, 32, 0.08) !important;\n      max-width: 260px !important;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif !important;\n    }\n    \n    .mobius-toast-emoji {\n      font-size: 14px !important;\n      line-height: 1 !important;\n      flex-shrink: 0 !important;\n    }\n    \n    .mobius-toast-content {\n      flex: 1 !important;\n      min-width: 0 !important;\n    }\n    \n    .mobius-toast-title {\n      font-weight: 500 !important;\n      font-size: 10px !important;\n      color: #0b1220 !important;\n      margin: 0 !important;\n      line-height: 1.3 !important;\n      white-space: nowrap !important;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n    }\n    \n    .mobius-toast-subtitle {\n      font-size: 9px !important;\n      color: rgba(91, 102, 122, 0.7) !important;\n      margin: 0 !important;\n      line-height: 1.3 !important;\n      white-space: nowrap !important;\n      overflow: hidden !important;\n      text-overflow: ellipsis !important;\n    }\n    \n    .mobius-toast-close {\n      background: none !important;\n      border: none !important;\n      cursor: pointer !important;\n      color: rgba(91, 102, 122, 0.4) !important;\n      font-size: 12px !important;\n      line-height: 1 !important;\n      padding: 0 !important;\n      margin-left: 2px !important;\n      flex-shrink: 0 !important;\n    }\n    \n    .mobius-toast-close:hover {\n      color: rgba(91, 102, 122, 0.7) !important;\n    }\n    \n    .mobius-toast-exit {\n      animation: mobius-toast-exit 0.2s ease-in forwards !important;\n    }\n    \n    @keyframes mobius-toast-enter {\n      from {\n        opacity: 0;\n        transform: translateY(-8px);\n      }\n      to {\n        opacity: 1;\n        transform: translateY(0);\n      }\n    }\n    \n    @keyframes mobius-toast-exit {\n      from {\n        opacity: 1;\n        transform: translateY(0);\n      }\n      to {\n        opacity: 0;\n        transform: translateY(-8px);\n      }\n    }\n  ",document.head.appendChild(e)}()}(),V=!0,console.log("[ToastManager] Initialized, notifications enabled:",on))}({onAction:(n,e)=>{console.log("[Mobius] Toast action:",n,e)},onJumpToPatient:async n=>{console.log("[Mobius] Jump to patient:",n),de={name:"Patient",id:n},await Ie({[oe]:de}),await Ve()}}),Z?console.log("[ToastManager] Already polling"):(console.log("[ToastManager] Starting polling..."),Z=!0,dn(),K=window.setInterval(()=>{dn()},3e4)),we=!0,console.log("[Mobius] Toast manager initialized")}catch(n){console.error("[Mobius] Failed to initialize toast manager:",n)}}function Ce(){const n=document.getElementById(Zn);if(!n)return;const e=n.querySelector(".mobius-mini-question-text"),o=n.querySelector(".mobius-mini-badge-text"),t=n.querySelector(".mobius-mini-attention-row .mobius-mini-dot");if(!e)return;const i=me.color||"grey",s="resolved"===me.userStatus||"unresolved"===me.userStatus?"purple":i;e.textContent=me.problemStatement||"No issues detected",e.title=me.problemStatement||"",o&&("resolved"===me.userStatus?o.textContent="Resolved ▾":"unresolved"===me.userStatus?o.textContent="Unresolved ▾":o.textContent="Set status ▾"),t&&(t.className=`mobius-mini-dot ${Oe(s)}`)}function Se(){const n=document.getElementById(Zn);if(!n)return;const e=n.querySelector(".mobius-mini-task-badge-row");if(!e)return;const o=pe>0?pe:be,t=e.querySelector(".mobius-mini-rec-message"),i=e.querySelector(".mobius-mini-rec-confidence"),s=e.querySelector(".mobius-mini-accept-btn"),r=fe&&null!==ge,a=me.problemStatement&&"No issues detected"!==me.problemStatement;if(!(o>0||a&&r))return void(e.style.display="none");e.style.display="";const d=ue?.current_step?.factor_type,c=ue?.factor_modes,l=d&&c&&"mobius"===c[d];if(r&&null!==ge){const n=ge;i&&(i.textContent=`(${Math.round(100*n)}%)`);const o=e.querySelector(".mobius-mini-review-btn");t&&s&&o&&fe&&(l?(t.textContent='Mobius: "I\'m handling this"',s.classList.add("delegated"),s.classList.remove("mobius-mini-btn-active"),s.textContent="Delegated to Mobius",s.style.display="",o.style.display=""):"mobius"===fe&&n>=80?(t.textContent='Mobius: "I can handle this"',s.classList.remove("delegated"),s.textContent="Let Mobius Handle",s.style.display="",o.style.display=""):"mobius"===fe?(t.textContent='Mobius: "I can help with this"',s.classList.remove("delegated"),s.textContent="Let Mobius Handle",s.style.display="",o.style.display=""):"together"===fe?(t.textContent='Mobius: "Let\'s work together"',s.style.display="none",o.style.display=""):(t.textContent='Mobius: "You should review this"',s.style.display="none",o.style.display=""))}else t&&(t.textContent=`${o} ${1===o?"item":"items"} remaining`),i&&(i.textContent=""),s&&(s.style.display="none")}let _e=!1,Ee=null,ze=null,Me=!1,Ae=null;const Ne=1e4;function Le(){Te(),Ae=setInterval(async()=>{const n=We();if(n)try{const e=await L(Jn,n),o=e.needs_attention?.user_status||null;if(console.log("[Mobius] Polling status check:",{current:me.userStatus,new:o,fullResponse:e.needs_attention}),o!==me.userStatus){console.log("[Mobius] Status changed via polling:",o),e.needs_attention&&(me={color:e.needs_attention.color,problemStatement:e.needs_attention.problem_statement??null,userStatus:e.needs_attention.user_status??null});const n=document.getElementById(Zn);n&&$e(n)}else if("resolved"===o&&"resolved"===me.userStatus){const n=document.getElementById(Zn);n&&$e(n)}}catch(n){console.debug("[Mobius] Polling error:",n)}},Ne),console.log("[Mobius] Status polling started")}function Te(){Ae&&(clearInterval(Ae),Ae=null,console.log("[Mobius] Status polling stopped"))}function $e(n){let e=me.color;"resolved"!==me.userStatus&&"unresolved"!==me.userStatus||(e="purple");const o=n.querySelector(".mobius-mini-attention-row");if(o){const n=o.querySelector(".mobius-mini-dot"),t=o.querySelector(".mobius-mini-problem-text"),i=o.querySelector(".mobius-mini-status-btn");n&&(n.className=`mobius-mini-dot ${Oe(e)}`),t&&(me.problemStatement?t.textContent=me.problemStatement:t.textContent="No issues detected"),i&&("resolved"===me.userStatus?(i.textContent="Resolved ▾",i.className="mobius-mini-status-btn resolved"):"unresolved"===me.userStatus?(i.textContent="Unresolved ▾",i.className="mobius-mini-status-btn unresolved"):(i.textContent="Set status ▾",i.className="mobius-mini-status-btn"))}const t=n.querySelector(".mobius-mini-minimized-info .mobius-mini-dot");t&&(t.className=`mobius-mini-dot ${Oe(e)}`)}function Pe(){try{return window.location.hostname.toLowerCase()}catch{return""}}async function qe(n){return new Promise(e=>{chrome.storage.local.get(n,n=>e(n))})}async function Ie(n){return new Promise(e=>{chrome.storage.local.set(n,()=>e())})}async function Be(){const n=(await qe([ne]))[ne];return Array.isArray(n)?n:[]}async function De(n,e){const o=(n||"").toLowerCase();if(!o)return;const t=await Be(),i=new Set(t.map(n=>String(n).toLowerCase()).filter(Boolean));e?i.add(o):i.delete(o),await Ie({[ne]:Array.from(i).sort()})}function Re(){const n=document.getElementById(Zn);n&&n.remove();const e=document.getElementById(Kn);e&&e.remove(),ce&&(ce.stop(),console.log("[Mobius] Patient context detection stopped")),Te()}function He(){const n=document.getElementById("mobius-os-sidebar");n&&n.remove();const e=document.getElementById("mobius-os-page-adjust");e&&e.remove(),Vn=null}function je(n){const e=document.getElementById(Qn);e&&e.remove();const o=document.createElement("div");o.id=Qn,o.className="mobius-mini-toast",o.textContent=n,document.body.appendChild(o),window.setTimeout(()=>o.remove(),1600)}function Ue(n,e,o,t={}){const{preferAbove:i=!0,gap:s=8}=t,r=window.innerWidth,a=window.innerHeight;window.scrollX,window.scrollY;let d,c,l="top left";const m=n.top,b=a-n.bottom;i&&m>=o+s?(d=n.top-o-s,l="bottom"):b>=o+s?(d=n.bottom+s,l="top"):m>b?(d=Math.max(s,n.top-o-s),l="bottom"):(d=n.bottom+s,l="top");const u=r-n.left,p=n.right;return u>=e?(c=n.left,l+=" left"):p>=e?(c=n.right-e,l+=" right"):(c=Math.max(s,Math.min(n.left,r-e-s)),l+=" center"),{top:d,left:c,transformOrigin:l}}function Oe(n){switch(n){case"green":return"dot-green";case"yellow":return"dot-yellow";case"blue":return"dot-blue";case"red":return"dot-red";case"purple":return"dot-purple";default:return"dot-grey"}}function Fe(n,e,o){return Math.max(e,Math.min(o,n))}async function Ge(n,e){const o=function(n,e){const o=e.getBoundingClientRect(),t=window.innerWidth-o.width-8,i=window.innerHeight-o.height-8;return{x:Fe(n.x,8,Math.max(8,t)),y:Fe(n.y,8,Math.max(8,i))}}(e,n);n.style.left=`${o.x}px`,n.style.top=`${o.y}px`,se=o,await Ie({[ee]:o})}function Ye(){return de||(le?.found?{name:le.display_name||"Unknown",id:le.patient_key||"",dob:""}:{name:"Unknown",id:"",dob:""})}function We(){return de?.id?de.id:le?.found&&le.patient_key?le.patient_key:void 0}async function Xe(n){if(!n)return void(le&&(le=null,console.log("[Mobius] Auto-detected patient cleared"),await oo()));console.log("[Mobius] Resolving detected patient:",n);const e=await async function(n){const e=window.location.hostname,o={id_type:n.id_type,id_value:n.id_value,source_hint:n.source_hint,domain:e,tenant_id:void 0};try{const e=await fetch(`${A}/context/detect`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(o)});if(!e.ok){const n=await e.json();throw new Error(n.error||"Failed to resolve patient context")}const t=await e.json();return{found:t.found,detected:n,patient_context_id:t.patient_context_id,patient_key:t.patient_key,display_name:t.display_name,id_masked:t.id_masked}}catch(e){return console.error("[API] Error resolving patient context:",e),{found:!1,detected:n}}}(n);e.found?(le=e,console.log("[Mobius] Patient resolved:",e),de&&(console.log("[Mobius] Clearing patient override in favor of auto-detected patient"),de=null,await Ie({[oe]:null})),await async function(n){const e=document.getElementById(Zn);if(!e)return;const o=e.querySelector(".mobius-mini-patient-name"),t=e.querySelector(".mobius-mini-patient-id");o&&(o.textContent=n.display_name||"Unknown"),t&&n.id_masked&&(t.textContent=`ID ${n.id_masked}`);const i=e.querySelector(".mobius-mini-minimized-patient");if(i&&(i.textContent=n.display_name||"Unknown"),n.patient_key)try{const o=await L(Jn,n.patient_key);if(re={color:o.proceed.color,text:o.proceed.text},o.tasking&&(ae={color:o.tasking.color,text:o.tasking.text,mode:o.tasking.mode,mode_text:o.tasking.mode_text}),o.needs_attention?(console.log("[Mobius] Loading status - needs_attention:",o.needs_attention),me={color:o.needs_attention.color,problemStatement:o.needs_attention.problem_statement??null,userStatus:o.needs_attention.user_status??null},console.log("[Mobius] Updated needsAttention.userStatus to:",me.userStatus)):console.warn("[Mobius] No needs_attention in status response:",o),be=o.task_count||0,ue=o.resolution_plan||null,pe=o.actions_for_user||0,null!==o.agentic_confidence&&void 0!==o.agentic_confidence){const n=o.agentic_confidence;ge=n>1?n/100:n}else ge=null;fe=o.recommended_mode??null,xe=o.recommendation_reason??null,he=o.agentic_actions??null,console.log("[Mobius] Recommendation data:",{agenticConfidence:ge,recommendedMode:fe,recommendationReason:xe,agenticActions:he,actionsForUser:pe,taskCount:be,problemStatement:me.problemStatement});const t=e.querySelector(".mobius-mini-attention-row");let i=me.color;if("resolved"!==me.userStatus&&"unresolved"!==me.userStatus||(i="purple"),t){const n=t.querySelector(".mobius-mini-dot"),e=t.querySelector(".mobius-mini-problem-text");n&&(n.className=`mobius-mini-dot ${Oe(i)}`),e&&("resolved"===me.userStatus?e.textContent="Resolved":me.problemStatement?e.textContent=me.problemStatement:e.textContent="No issues detected")}const s=e.querySelector(".mobius-mini-minimized-info .mobius-mini-dot");if(s&&(s.className=`mobius-mini-dot ${Oe(i)}`),Se(),Ce(),je(`Patient detected: ${n.display_name||"Unknown"}`),Le(),document.getElementById("mobius-os-sidebar")){console.log("[Mobius] Refreshing Sidecar with new patient");const e={patient:{name:n.display_name||"Unknown",id:n.patient_key||""},resolutionPlan:ue,userProfile:Ee,needsAttention:me};await Qe(e)}}catch(n){console.error("[Mobius] Error fetching status for auto-detected patient:",n)}}(e)):(console.log("[Mobius] Patient not found in system:",n),le=e)}function Je(){const n=document.createElement("div");n.id=Zn,n.className="mobius-mini";const e=document.createElement("div");e.className="mobius-mini-header";const o=document.createElement("div");o.className="mobius-mini-drag-handle",o.title="Drag",o.innerHTML='<div class="mobius-mini-drag-dots"></div>';const t=B({clientName:"CMHC",compact:!0}),i=document.createElement("div");i.className="mobius-mini-brand-divider";const s=document.createElement("div");s.className="mobius-mini-brand",s.appendChild(t),s.appendChild(i),s.appendChild(D({status:"idle"}));const r=document.createElement("div");r.className="mobius-mini-brand-text",r.textContent="Mobius",s.appendChild(r);const a=document.createElement("button");a.className="mobius-mini-minimize-btn",a.type="button",a.textContent="−",a.setAttribute("aria-label","Minimize");const d=document.createElement("div");d.className="mobius-mini-minimized-info",d.innerHTML='\n    <span class="mobius-mini-dot"></span>\n    <span class="mobius-mini-minimized-patient"></span>\n  ';const c=document.createElement("button");c.className="mobius-mini-expand-btn",c.type="button",c.textContent="›",c.setAttribute("aria-label","Expand");const l=document.createElement("button");l.className="mobius-mini-menu-btn",l.type="button",l.textContent="⋮",l.setAttribute("aria-label","Menu");const m=document.createElement("div");m.className="mobius-mini-menu",m.style.cssText="\n    display: none;\n    position: fixed;\n    background: #fff;\n    border: 1px solid rgba(11, 18, 32, 0.12);\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(2,6,23,0.15);\n    z-index: 2147483647;\n    min-width: 120px;\n    padding: 4px 0;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 11px;\n    pointer-events: auto;\n  ";let b=!1,u=!1;const p="padding:6px 12px;cursor:pointer;display:flex;align-items:center;gap:6px;color:#374151;",g=yn.map(n=>`<div class="mobius-mini-menu-item" data-theme="${n.id}" style="${p}font-size:var(--mobius-font-sm, 10px);">${n.icon} ${n.label}</div>`).join(""),f=wn.map(n=>`<div class="mobius-mini-menu-item" data-density="${n.id}" style="${p}font-size:var(--mobius-font-sm, 10px);flex-direction:column;align-items:flex-start;gap:2px;">\n      <span style="font-weight:500;">${n.label}</span>\n      <span style="font-size:var(--mobius-font-xs, 9px);color:#64748b;">${n.description}</span>\n    </div>`).join("");m.innerHTML=`\n    <div class="mobius-mini-menu-item mobius-mini-theme-trigger" style="${p}">\n      Theme <span style="margin-left:auto;font-size:9px;opacity:0.5;">›</span>\n    </div>\n    <div class="mobius-mini-theme-submenu" style="display:none;border-top:1px solid rgba(11,18,32,0.06);padding:2px 0;margin:0 4px;">\n      ${g}\n    </div>\n    <div class="mobius-mini-menu-item mobius-mini-density-trigger" style="${p}">\n      Text Size <span style="margin-left:auto;font-size:9px;opacity:0.5;">›</span>\n    </div>\n    <div class="mobius-mini-density-submenu" style="display:none;border-top:1px solid rgba(11,18,32,0.06);padding:2px 0;margin:0 4px;">\n      ${f}\n    </div>\n    <div style="height:1px;background:rgba(11,18,32,0.06);margin:2px 8px;"></div>\n    <div class="mobius-mini-menu-item danger" style="${p}color:#dc2626;font-size:var(--mobius-font-sm, 10px);">Disable on this site</div>\n  `;const x=m.querySelector(".mobius-mini-theme-submenu"),h=m.querySelector(".mobius-mini-density-submenu"),v=m.querySelector(".mobius-mini-theme-trigger");v&&(v.onmousedown=n=>{n.stopPropagation(),n.preventDefault(),b=!b,u=!1,x.style.display=b?"block":"none",h.style.display="none"});const y=m.querySelector(".mobius-mini-density-trigger");y&&(y.onmousedown=n=>{n.stopPropagation(),n.preventDefault(),u=!u,b=!1,h.style.display=u?"block":"none",x.style.display="none"}),m.querySelectorAll("[data-theme]").forEach(e=>{e.onmousedown=async o=>{o.stopPropagation(),o.preventDefault();const t=e.dataset.theme||"light";await(async e=>{console.log("[Mobius] Applying theme:",e),await pn(e),await async function(n,e){const o=e||await gn(),t=await xn();te=o,ie=t,hn(n,o,t)}(n,e);const o=document.getElementById("mobius-os-sidebar");o&&hn(o,e,ie),m.style.display="none",b=!1})(t)}}),m.querySelectorAll("[data-density]").forEach(e=>{e.onmousedown=async o=>{o.stopPropagation(),o.preventDefault();const t=e.dataset.density||"normal";await(async e=>{console.log("[Mobius] Applying density:",e),await fn(e),await async function(n,e){const o=await gn(),t=e||await xn();te=o,ie=t,hn(n,o,t)}(n,e);const o=document.getElementById("mobius-os-sidebar");o&&hn(o,te,e),m.style.display="none",u=!1})(t)}}),m.querySelectorAll(".mobius-mini-menu-item").forEach(n=>{const e=n;e.onmouseenter=()=>{e.style.background="rgba(59,130,246,0.08)"},e.onmouseleave=()=>{e.style.background="transparent"}});const w=m.querySelector(".danger");w&&(w.onmousedown=async n=>{n.stopPropagation(),n.preventDefault(),console.log("[Mobius] Disable clicked"),m.style.display="none";const e=Pe();try{await De(e,!1),console.log("[Mobius] Disabled on:",e),Re(),document.body.contains(m)&&m.remove()}catch(n){console.error("[Mobius] Failed to disable:",n)}}),m.onmousedown=n=>{console.log("[Mobius] Menu mousedown, target:",n.target.className)};let k=!1;l.onmousedown=n=>{if(n.stopPropagation(),n.preventDefault(),k=!0,setTimeout(()=>{k=!1},150),"none"===m.style.display||""===m.style.display){const n=l.getBoundingClientRect();m.style.top=`${n.bottom+4}px`,m.style.right=window.innerWidth-n.right+"px",m.style.left="auto",m.style.display="block",x.style.display="none",h.style.display="none",b=!1,u=!1,document.body.contains(m)||document.body.appendChild(m)}else m.style.display="none";console.log("[Mobius] Menu toggled:",m.style.display)},document.addEventListener("mousedown",e=>{k||m.contains(e.target)||n.contains(e.target)||"none"!==m.style.display&&(console.log("[Mobius] Closing menu - clicked outside"),m.style.display="none",x.style.display="none",h.style.display="none",b=!1,u=!1)}),e.appendChild(d),e.appendChild(s),e.appendChild(a),e.appendChild(c),e.appendChild(l),n.appendChild(e);const C=document.createElement("div");C.className="mobius-mini-greeting-row",C.style.display="none",C.innerHTML='\n    <button class="mobius-mini-greeting-main" type="button">\n      <span class="mobius-mini-greeting-text">Hello</span>\n      <svg class="mobius-mini-greeting-chevron" viewBox="0 0 24 24" width="14" height="14">\n        <path fill="currentColor" d="M7 10l5 5 5-5z"/>\n      </svg>\n    </button>\n    <button class="mobius-mini-greeting-dismiss" type="button" title="Hide greeting">\n      <svg viewBox="0 0 24 24" width="12" height="12">\n        <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n      </svg>\n    </button>\n  ',n.appendChild(C);let S=null;C.querySelector(".mobius-mini-greeting-main")?.addEventListener("click",n=>{n.stopPropagation(),(()=>{if(S)return S.remove(),void(S=null);const n=C.getBoundingClientRect();S=document.createElement("div"),S.className="mobius-mini-user-dropdown";const e=Math.max(n.width,200),o=Ue(n,e,180,{preferAbove:!1,gap:4});S.style.cssText=`\n      position: fixed;\n      top: ${o.top}px;\n      left: ${o.left}px;\n      width: ${e}px;\n      background: white;\n      border-radius: 8px;\n      box-shadow: 0 4px 16px rgba(0, 0, 0, 0.15);\n      z-index: 2147483647;\n      overflow: hidden;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      transform-origin: ${o.transformOrigin};\n    `;const t=Ee?.display_name||Ee?.email||"User",i=Ee?.email||"",s=(t||"?")[0].toUpperCase();S.innerHTML=`\n      <div style="display:flex;align-items:center;gap:10px;padding:12px;background:#f8fafc;">\n        <div style="width:36px;height:36px;border-radius:50%;background:#3b82f6;color:white;display:flex;align-items:center;justify-content:center;font-weight:600;font-size:14px;">${s}</div>\n        <div style="flex:1;min-width:0;">\n          <div style="font-size:11px;font-weight:600;color:#0b1220;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${t}</div>\n          ${i?`<div style="font-size:9px;color:#64748b;white-space:nowrap;overflow:hidden;text-overflow:ellipsis;">${i}</div>`:""}\n        </div>\n      </div>\n      <div style="height:1px;background:#e2e8f0;"></div>\n      <button class="mobius-mini-dropdown-item" data-action="preferences" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 12px;background:none;border:none;cursor:pointer;font-size:10px;color:#374151;text-align:left;">\n        <svg viewBox="0 0 24 24" width="14" height="14" style="color:#64748b;flex-shrink:0;">\n          <path fill="currentColor" d="M19.14 12.94c.04-.31.06-.63.06-.94 0-.31-.02-.63-.06-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.04.31-.06.63-.06.94s.02.63.06.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.56 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/>\n        </svg>\n        <span>My Preferences</span>\n      </button>\n      <button class="mobius-mini-dropdown-item" data-action="switch" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 12px;background:none;border:none;cursor:pointer;font-size:10px;color:#374151;text-align:left;">\n        <svg viewBox="0 0 24 24" width="14" height="14" style="color:#64748b;flex-shrink:0;">\n          <path fill="currentColor" d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm-1 17.93c-3.95-.49-7-3.85-7-7.93 0-.62.08-1.21.21-1.79L9 15v1c0 1.1.9 2 2 2v1.93zm6.9-2.54c-.26-.81-1-1.39-1.9-1.39h-1v-3c0-.55-.45-1-1-1H8v-2h2c.55 0 1-.45 1-1V7h2c1.1 0 2-.9 2-2v-.41c2.93 1.19 5 4.06 5 7.41 0 2.08-.8 3.97-2.1 5.39z"/>\n        </svg>\n        <span>Not you? Sign in differently</span>\n      </button>\n      <div style="height:1px;background:#e2e8f0;"></div>\n      <button class="mobius-mini-dropdown-item" data-action="signout" style="display:flex;align-items:center;gap:10px;width:100%;padding:10px 12px;background:none;border:none;cursor:pointer;font-size:10px;color:#dc2626;text-align:left;">\n        <svg viewBox="0 0 24 24" width="14" height="14" style="color:#dc2626;flex-shrink:0;">\n          <path fill="currentColor" d="M17 7l-1.41 1.41L18.17 11H8v2h10.17l-2.58 2.58L17 17l5-5zM4 5h8V3H4c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h8v-2H4V5z"/>\n        </svg>\n        <span>Sign out</span>\n      </button>\n    `,document.body.appendChild(S),S.querySelectorAll(".mobius-mini-dropdown-item").forEach(n=>{n.addEventListener("mouseenter",()=>{n.style.background="#f8fafc"}),n.addEventListener("mouseleave",()=>{n.style.background="transparent"}),n.addEventListener("click",async()=>{const e=n.dataset.action;if("signout"===e){const n=M();await n.logout(),_e=!1,Ee=null,ze=null,await oo(),je("Signed out")}else if("preferences"===e)_();else if("switch"===e){const n=M();await n.logout(),_e=!1,Ee=null,await oo()}S&&(S.remove(),S=null)})});const r=n=>{!S||S.contains(n.target)||C.contains(n.target)||(S.remove(),S=null,document.removeEventListener("click",r))};setTimeout(()=>document.addEventListener("click",r),0)})()}),C.querySelector(".mobius-mini-greeting-dismiss")?.addEventListener("click",n=>{n.stopPropagation(),Me=!0,C.style.display="none"});const _=async()=>{if(!document.getElementById("mobius-prefs-styles")){const n=document.createElement("style");n.id="mobius-prefs-styles",n.textContent="\n.mobius-prefs-modal {\n  position: fixed;\n  inset: 0;\n  z-index: 10000;\n}\n\n.mobius-prefs-backdrop {\n  position: absolute;\n  inset: 0;\n  background: rgba(0, 0, 0, 0.5);\n}\n\n.mobius-prefs-container {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n  background: white;\n  border-radius: 12px;\n  width: 90%;\n  max-width: 420px;\n  max-height: 85vh;\n  display: flex;\n  flex-direction: column;\n  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.2);\n}\n\n.mobius-prefs-header {\n  display: flex;\n  align-items: center;\n  justify-content: space-between;\n  padding: 16px 20px;\n  border-bottom: 1px solid #e2e8f0;\n}\n\n.mobius-prefs-header h2 {\n  margin: 0;\n  font-size: 14px;\n  font-weight: 600;\n  color: #0b1220;\n}\n\n.mobius-prefs-close {\n  background: none;\n  border: none;\n  cursor: pointer;\n  padding: 4px;\n  color: #64748b;\n}\n\n.mobius-prefs-close:hover {\n  color: #374151;\n}\n\n.mobius-prefs-tabs {\n  display: flex;\n  border-bottom: 1px solid #e2e8f0;\n  padding: 0 12px;\n}\n\n.mobius-prefs-tab {\n  padding: 10px 12px;\n  background: none;\n  border: none;\n  border-bottom: 2px solid transparent;\n  font-size: 11px;\n  color: #64748b;\n  cursor: pointer;\n  transition: all 0.15s;\n}\n\n.mobius-prefs-tab:hover {\n  color: #374151;\n}\n\n.mobius-prefs-tab.active {\n  color: #3b82f6;\n  border-bottom-color: #3b82f6;\n}\n\n.mobius-prefs-content {\n  flex: 1;\n  overflow-y: auto;\n  padding: 16px 20px;\n}\n\n.mobius-prefs-section {\n  margin-bottom: 16px;\n}\n\n.mobius-prefs-section:last-child {\n  margin-bottom: 0;\n}\n\n.mobius-prefs-label {\n  display: block;\n  font-size: 11px;\n  font-weight: 500;\n  color: #374151;\n  margin-bottom: 8px;\n}\n\n.mobius-prefs-desc {\n  font-size: 10px;\n  color: #64748b;\n  margin: 0 0 12px;\n}\n\n.mobius-prefs-input,\n.mobius-prefs-select {\n  width: 100%;\n  padding: 8px 10px;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  font-size: 12px;\n  box-sizing: border-box;\n}\n\n.mobius-prefs-input:focus,\n.mobius-prefs-select:focus {\n  outline: none;\n  border-color: #3b82f6;\n}\n\n/* Activities */\n.mobius-prefs-activities {\n  display: flex;\n  flex-wrap: wrap;\n  gap: 6px;\n}\n\n.mobius-prefs-activity {\n  display: flex;\n  align-items: center;\n  gap: 6px;\n  padding: 6px 10px;\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 10px;\n  color: #374151;\n  transition: all 0.15s;\n}\n\n.mobius-prefs-activity:hover {\n  background: #f1f5f9;\n}\n\n.mobius-prefs-activity.selected {\n  background: #eff6ff;\n  border-color: #3b82f6;\n}\n\n.mobius-prefs-activity input {\n  display: none;\n}\n\n.mobius-prefs-activity-check {\n  width: 14px;\n  height: 14px;\n  border: 1px solid #cbd5e1;\n  border-radius: 3px;\n  display: flex;\n  align-items: center;\n  justify-content: center;\n  color: white;\n}\n\n.mobius-prefs-activity.selected .mobius-prefs-activity-check {\n  background: #3b82f6;\n  border-color: #3b82f6;\n}\n\n/* Options */\n.mobius-prefs-options {\n  display: flex;\n  flex-direction: column;\n  gap: 6px;\n}\n\n.mobius-prefs-option {\n  display: flex;\n  align-items: center;\n  gap: 8px;\n  padding: 10px 12px;\n  background: #f8fafc;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  cursor: pointer;\n  font-size: 11px;\n  color: #374151;\n  transition: all 0.15s;\n}\n\n.mobius-prefs-option:hover {\n  background: #f1f5f9;\n}\n\n.mobius-prefs-option.selected {\n  background: #eff6ff;\n  border-color: #3b82f6;\n}\n\n.mobius-prefs-option input {\n  display: none;\n}\n\n/* Toggle */\n.mobius-prefs-toggle {\n  display: flex;\n  align-items: center;\n  gap: 10px;\n  cursor: pointer;\n}\n\n.mobius-prefs-toggle input {\n  display: none;\n}\n\n.mobius-prefs-toggle-slider {\n  width: 36px;\n  height: 20px;\n  background: #e2e8f0;\n  border-radius: 10px;\n  position: relative;\n  transition: background 0.2s;\n}\n\n.mobius-prefs-toggle-slider::after {\n  content: '';\n  position: absolute;\n  width: 16px;\n  height: 16px;\n  background: white;\n  border-radius: 50%;\n  top: 2px;\n  left: 2px;\n  transition: transform 0.2s;\n  box-shadow: 0 1px 3px rgba(0,0,0,0.2);\n}\n\n.mobius-prefs-toggle input:checked + .mobius-prefs-toggle-slider {\n  background: #3b82f6;\n}\n\n.mobius-prefs-toggle input:checked + .mobius-prefs-toggle-slider::after {\n  transform: translateX(16px);\n}\n\n.mobius-prefs-toggle-label {\n  font-size: 11px;\n  color: #374151;\n}\n\n/* Footer */\n.mobius-prefs-footer {\n  display: flex;\n  justify-content: flex-end;\n  gap: 10px;\n  padding: 16px 20px;\n  border-top: 1px solid #e2e8f0;\n}\n\n.mobius-prefs-btn-cancel {\n  padding: 8px 16px;\n  background: none;\n  border: 1px solid #e2e8f0;\n  border-radius: 6px;\n  font-size: 11px;\n  color: #64748b;\n  cursor: pointer;\n}\n\n.mobius-prefs-btn-cancel:hover {\n  background: #f8fafc;\n}\n\n.mobius-prefs-btn-save {\n  padding: 8px 16px;\n  background: #3b82f6;\n  border: none;\n  border-radius: 6px;\n  font-size: 11px;\n  font-weight: 500;\n  color: white;\n  cursor: pointer;\n}\n\n.mobius-prefs-btn-save:hover {\n  background: #2563eb;\n}\n",document.head.appendChild(n)}const n=Ee?.activities||ze?.activities?.map(n=>n.code)||[],e={preferred_name:Ee?.preferred_name||Ee?.first_name||"",timezone:Ee?.timezone||"America/New_York",activities:n,tone:Ee?.tone||"professional",greeting_enabled:!1!==Ee?.greeting_enabled,autonomy_routine_tasks:Ee?.autonomy_routine_tasks||"confirm_first",autonomy_sensitive_tasks:Ee?.autonomy_sensitive_tasks||"manual"},o=await async function(n){const{preferences:e,onSave:o,onClose:t}=n;let i=n.activities||[];if(0===i.length)try{const n=await fetch(`${jn}/auth/activities`),e=await n.json();e.ok&&(i=e.activities)}catch(n){console.error("[PreferencesModal] Error fetching activities:",n)}const s={...e},r=[...s.activities||[]],a=document.createElement("div");a.className="mobius-prefs-modal";let d="profile";const c=()=>{a.innerHTML=`\n      <div class="mobius-prefs-backdrop"></div>\n      <div class="mobius-prefs-container">\n        <div class="mobius-prefs-header">\n          <h2>My Preferences</h2>\n          <button class="mobius-prefs-close" type="button">\n            <svg viewBox="0 0 24 24" width="18" height="18">\n              <path fill="currentColor" d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/>\n            </svg>\n          </button>\n        </div>\n        \n        <div class="mobius-prefs-tabs">\n          <button class="mobius-prefs-tab ${"profile"===d?"active":""}" data-tab="profile">Profile</button>\n          <button class="mobius-prefs-tab ${"activities"===d?"active":""}" data-tab="activities">Activities</button>\n          <button class="mobius-prefs-tab ${"ai"===d?"active":""}" data-tab="ai">AI Comfort</button>\n          <button class="mobius-prefs-tab ${"display"===d?"active":""}" data-tab="display">Display</button>\n        </div>\n        \n        <div class="mobius-prefs-content">\n          ${l()}\n        </div>\n        \n        <div class="mobius-prefs-footer">\n          <button class="mobius-prefs-btn-cancel" type="button">Cancel</button>\n          <button class="mobius-prefs-btn-save" type="button">Save Changes</button>\n        </div>\n      </div>\n    `,m()},l=()=>{switch(d){case"profile":return`\n          <div class="mobius-prefs-section">\n            <label class="mobius-prefs-label">Preferred Name</label>\n            <input type="text" class="mobius-prefs-input" id="pref-name" \n                   value="${Un(s.preferred_name||"")}" \n                   placeholder="How should we greet you?" />\n          </div>\n          <div class="mobius-prefs-section">\n            <label class="mobius-prefs-label">Timezone</label>\n            <select class="mobius-prefs-select" id="pref-timezone">\n              <option value="America/New_York" ${"America/New_York"===s.timezone?"selected":""}>Eastern Time (ET)</option>\n              <option value="America/Chicago" ${"America/Chicago"===s.timezone?"selected":""}>Central Time (CT)</option>\n              <option value="America/Denver" ${"America/Denver"===s.timezone?"selected":""}>Mountain Time (MT)</option>\n              <option value="America/Los_Angeles" ${"America/Los_Angeles"===s.timezone?"selected":""}>Pacific Time (PT)</option>\n            </select>\n          </div>\n        `;case"activities":return`\n          <p class="mobius-prefs-desc">Select the activities you work on. This helps Mobius show you relevant quick actions and tasks.</p>\n          <div class="mobius-prefs-activities">\n            ${i.map(n=>`\n              <label class="mobius-prefs-activity ${r.includes(n.activity_code)?"selected":""}">\n                <input type="checkbox" value="${n.activity_code}" ${r.includes(n.activity_code)?"checked":""} />\n                <span class="mobius-prefs-activity-check">\n                  <svg viewBox="0 0 24 24" width="14" height="14">\n                    <path fill="currentColor" d="M9 16.17L4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"/>\n                  </svg>\n                </span>\n                <span>${Un(n.label)}</span>\n              </label>\n            `).join("")}\n          </div>\n        `;case"ai":return`\n          <div class="mobius-prefs-section">\n            <label class="mobius-prefs-label">For routine tasks (eligibility checks, status updates):</label>\n            <div class="mobius-prefs-options">\n              <label class="mobius-prefs-option ${"automatic"===s.autonomy_routine_tasks?"selected":""}">\n                <input type="radio" name="routine" value="automatic" ${"automatic"===s.autonomy_routine_tasks?"checked":""} />\n                <span>Do it automatically</span>\n              </label>\n              <label class="mobius-prefs-option ${"confirm_first"===s.autonomy_routine_tasks?"selected":""}">\n                <input type="radio" name="routine" value="confirm_first" ${"confirm_first"===s.autonomy_routine_tasks?"checked":""} />\n                <span>Show me first, then confirm</span>\n              </label>\n              <label class="mobius-prefs-option ${"manual"===s.autonomy_routine_tasks?"selected":""}">\n                <input type="radio" name="routine" value="manual" ${"manual"===s.autonomy_routine_tasks?"checked":""} />\n                <span>Just guide me, I'll do it</span>\n              </label>\n            </div>\n          </div>\n          <div class="mobius-prefs-section">\n            <label class="mobius-prefs-label">For sensitive tasks (billing, patient records):</label>\n            <div class="mobius-prefs-options">\n              <label class="mobius-prefs-option ${"automatic"===s.autonomy_sensitive_tasks?"selected":""}">\n                <input type="radio" name="sensitive" value="automatic" ${"automatic"===s.autonomy_sensitive_tasks?"checked":""} />\n                <span>Do it automatically</span>\n              </label>\n              <label class="mobius-prefs-option ${"confirm_first"===s.autonomy_sensitive_tasks?"selected":""}">\n                <input type="radio" name="sensitive" value="confirm_first" ${"confirm_first"===s.autonomy_sensitive_tasks?"checked":""} />\n                <span>Always show me before acting</span>\n              </label>\n              <label class="mobius-prefs-option ${"manual"===s.autonomy_sensitive_tasks?"selected":""}">\n                <input type="radio" name="sensitive" value="manual" ${"manual"===s.autonomy_sensitive_tasks?"checked":""} />\n                <span>Never act without my approval</span>\n              </label>\n            </div>\n          </div>\n        `;case"display":return`\n          <div class="mobius-prefs-section">\n            <label class="mobius-prefs-label">Communication Tone</label>\n            <div class="mobius-prefs-options">\n              <label class="mobius-prefs-option ${"professional"===s.tone?"selected":""}">\n                <input type="radio" name="tone" value="professional" ${"professional"===s.tone?"checked":""} />\n                <span>Professional</span>\n              </label>\n              <label class="mobius-prefs-option ${"friendly"===s.tone?"selected":""}">\n                <input type="radio" name="tone" value="friendly" ${"friendly"===s.tone?"checked":""} />\n                <span>Friendly</span>\n              </label>\n              <label class="mobius-prefs-option ${"concise"===s.tone?"selected":""}">\n                <input type="radio" name="tone" value="concise" ${"concise"===s.tone?"checked":""} />\n                <span>Concise</span>\n              </label>\n            </div>\n          </div>\n          <div class="mobius-prefs-section">\n            <label class="mobius-prefs-toggle">\n              <input type="checkbox" id="pref-greeting" ${s.greeting_enabled?"checked":""} />\n              <span class="mobius-prefs-toggle-slider"></span>\n              <span class="mobius-prefs-toggle-label">Show personalized greeting</span>\n            </label>\n          </div>\n        `;default:return""}},m=()=>{a.querySelector(".mobius-prefs-close")?.addEventListener("click",t),a.querySelector(".mobius-prefs-backdrop")?.addEventListener("click",t),a.querySelector(".mobius-prefs-btn-cancel")?.addEventListener("click",t),a.querySelector(".mobius-prefs-btn-save")?.addEventListener("click",async()=>{await u()}),a.querySelectorAll(".mobius-prefs-tab").forEach(n=>{n.addEventListener("click",()=>{d=n.dataset.tab||"profile",c()})}),a.querySelector("#pref-name")?.addEventListener("input",n=>{s.preferred_name=n.target.value}),a.querySelector("#pref-timezone")?.addEventListener("change",n=>{s.timezone=n.target.value}),a.querySelectorAll(".mobius-prefs-activity input").forEach(n=>{n.addEventListener("change",n=>{const e=n.target.value,o=n.target.checked,t=n.target.closest(".mobius-prefs-activity");if(o)r.includes(e)||r.push(e),t?.classList.add("selected");else{const n=r.indexOf(e);n>-1&&r.splice(n,1),t?.classList.remove("selected")}s.activities=[...r]})}),["routine","sensitive","tone"].forEach(n=>{a.querySelectorAll(`input[name="${n}"]`).forEach(e=>{e.addEventListener("change",e=>{const o=e.target.value;"routine"===n&&(s.autonomy_routine_tasks=o),"sensitive"===n&&(s.autonomy_sensitive_tasks=o),"tone"===n&&(s.tone=o),b(n)})})}),a.querySelector("#pref-greeting")?.addEventListener("change",n=>{s.greeting_enabled=n.target.checked})},b=n=>{a.querySelectorAll(`input[name="${n}"]`).forEach(n=>{const e=n.closest(".mobius-prefs-option");n.checked?e?.classList.add("selected"):e?.classList.remove("selected")})},u=async()=>{const n=a.querySelector(".mobius-prefs-btn-save");n&&(n.textContent="Saving...",n.disabled=!0);try{const n=M(),e=await n.getAccessToken();if(e){const t=await fetch(`${jn}/auth/preferences`,{method:"PUT",headers:{Authorization:`Bearer ${e}`,"Content-Type":"application/json"},body:JSON.stringify({preferred_name:s.preferred_name,timezone:s.timezone,activities:r,tone:s.tone,greeting_enabled:s.greeting_enabled,autonomy_routine_tasks:s.autonomy_routine_tasks,autonomy_sensitive_tasks:s.autonomy_sensitive_tasks})});if(t.ok){console.log("[PreferencesModal] Preferences saved");const e=await n.getCurrentUser();e&&console.log("[PreferencesModal] User profile refreshed:",e),s.activities=[...r],o(s)}else{const n=await t.json().catch(()=>({}));console.error("[PreferencesModal] Error saving preferences:",n),alert("Failed to save preferences. Please try again.")}}}catch(n){console.error("[PreferencesModal] Error saving preferences:",n),alert("Failed to save preferences. Please try again.")}finally{n&&(n.textContent="Save Changes",n.disabled=!1)}};return c(),a}({preferences:e,onSave:async n=>{je("Preferences saved!"),Ee=null,ze=null;const e=M();Ee=await e.getCurrentUser(),await oo(),o.remove()},onClose:()=>{o.remove()}});document.body.appendChild(o)};let E=!1;a.onclick=e=>{e.stopPropagation(),E=!E,E?(n.classList.add("mobius-mini-minimized"),a.textContent="+",a.setAttribute("aria-label","Restore")):(n.classList.remove("mobius-mini-minimized"),a.textContent="−",a.setAttribute("aria-label","Minimize"))};const z=document.createElement("div");z.className="mobius-mini-row",z.innerHTML='\n    <div class="mobius-mini-row-label">PATIENT</div>\n    <div class="mobius-mini-row-body">\n      <div class="mobius-mini-patient-name"></div>\n      <div class="mobius-mini-patient-id"></div>\n      <div class="mobius-mini-patient-dob"></div>\n    </div>\n    <button class="mobius-mini-icon-btn" type="button" aria-label="Edit patient" title="Edit patient">\n      <svg viewBox="0 0 24 24" aria-hidden="true">\n        <path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zm2.92 2.83H5v-.92l9.06-9.06.92.92L5.92 20.08zM20.71 7.04a1.003 1.003 0 0 0 0-1.42l-2.34-2.34a1.003 1.003 0 0 0-1.42 0l-1.83 1.83 3.75 3.75 1.84-1.82z"/>\n      </svg>\n    </button>\n  ',n.appendChild(z);const P=document.createElement("div");P.className="mobius-mini-row mobius-mini-attention-row",P.innerHTML='\n    <div class="mobius-mini-row-label">STATUS</div>\n    <div class="mobius-mini-attention-content">\n      <span class="mobius-mini-dot"></span>\n      <span class="mobius-mini-question-text">No issues detected</span>\n      <button class="mobius-mini-status-badge" type="button" aria-label="Answer">\n        <span class="mobius-mini-badge-text">Set status</span>\n        <span class="mobius-mini-dropdown-icon">▼</span>\n      </button>\n    </div>\n  ',n.appendChild(P);const q=document.createElement("div");q.className="mobius-mini-row mobius-mini-task-badge-row",q.style.display="none",q.innerHTML='\n    <div class="mobius-mini-row-label">PLAN</div>\n    <div class="mobius-mini-recommendation">\n      <div class="mobius-mini-recommendation-text">\n        <span class="mobius-mini-rec-message">Loading...</span>\n        <span class="mobius-mini-rec-confidence"></span>\n      </div>\n      <div class="mobius-mini-recommendation-actions">\n        <button class="mobius-mini-accept-btn" type="button">Accept</button>\n        <button class="mobius-mini-review-btn" type="button">Review →</button>\n      </div>\n    </div>\n  ',n.appendChild(q);const I=document.createElement("div");I.className="mobius-mini-row",I.style.display="none";const R=document.createElement("div");R.className="mobius-mini-row",R.style.display="none";const H=document.createElement("div");H.className="mobius-mini-row",H.innerHTML='\n    <div class="mobius-mini-row-label">NOTE</div>\n    <div class="mobius-mini-note-wrap">\n      <input class="mobius-mini-note-input" type="text" placeholder="Quick note…" />\n      <button class="mobius-mini-send-btn" type="button" aria-label="Send note">\n        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>\n      </button>\n    </div>\n  ',n.appendChild(H);const j=()=>{const e=Ye(),o=n.querySelector(".mobius-mini-patient-name"),t=n.querySelector(".mobius-mini-patient-id"),i=n.querySelector(".mobius-mini-patient-dob");o&&(o.textContent=e.name||"Unknown"),t&&(t.textContent=e.id?`ID ${e.id}`:""),i&&(i.textContent=e.dob?`DOB ${e.dob}`:"");const s=d.querySelector(".mobius-mini-minimized-patient");s&&(s.textContent=e.name||"Unknown")};j();const U=(n,e,o=!1)=>{const t=n.querySelector(".mobius-mini-dot"),i=n.querySelector(".mobius-mini-status-text");if(t&&(t.className=`mobius-mini-dot ${Oe(e.color)}`),i)if(o&&e.mode){const n=(n=>{switch(n){case"agentic":return"🤖";case"copilot":return"👤✓";case"user_driven":return"👤";default:return""}})(e.mode),o=e.mode_text||"";i.textContent=`${n} ${o}`}else i.textContent=e.text},O=()=>{const n=P.querySelector(".mobius-mini-dot"),e=P.querySelector(".mobius-mini-problem-text"),o=P.querySelector(".mobius-mini-badge-text"),t=P.querySelector(".mobius-mini-status-badge");let i=me.color;"resolved"!==me.userStatus&&"unresolved"!==me.userStatus||(i="purple"),n&&(n.className=`mobius-mini-dot ${Oe(i)}`);const s=d.querySelector(".mobius-mini-dot");s&&(s.className=`mobius-mini-dot ${Oe(i)}`),e&&(e.textContent=me.problemStatement||"No issues detected"),o&&t&&("resolved"===me.userStatus?(o.textContent="Resolved",t.className="mobius-mini-status-badge status-resolved"):"unresolved"===me.userStatus?(o.textContent="Unresolved",t.className="mobius-mini-status-badge status-unresolved"):(o.textContent="Set status",t.className="mobius-mini-status-badge"))},F=()=>{const n=pe>0?pe:be,e=q.querySelector(".mobius-mini-rec-message"),o=q.querySelector(".mobius-mini-rec-confidence"),t=q.querySelector(".mobius-mini-accept-btn");q.querySelector(".mobius-mini-review-btn"),console.log("[Mobius] applyTaskCount:",{count:n,actionsForUser:pe,taskCount:be,recommendedMode:fe,agenticConfidence:ge,hasProblem:!!me.problemStatement,hasMessageEl:!!e});const i=fe&&null!==ge,s=me.problemStatement&&"No issues detected"!==me.problemStatement;if(!(n>0||s&&i))return console.log("[Mobius] Hiding recommendation row - no actions and no recommendation"),void(q.style.display="none");q.style.display="";const r=ue?.current_step?.factor_type,a=ue?.factor_modes,d=r&&a&&"mobius"===a[r];if(i&&null!==ge){console.log("[Mobius] Showing recommendation:",{recommendedMode:fe,agenticConfidence:ge,isAlreadyDelegated:d});const n=ge;o&&(o.textContent=`(${Math.round(100*n)}%)`);const i=q.querySelector(".mobius-mini-review-btn");e&&t&&i&&fe&&(d?(e.textContent='Mobius: "I\'m handling this"',t.classList.add("delegated"),t.classList.remove("mobius-mini-btn-active"),t.textContent="Delegated to Mobius",t.style.display="",i.style.display=""):"mobius"===fe&&n>=80?(e.textContent='Mobius: "I can handle this"',t.classList.remove("delegated"),t.textContent="Let Mobius Handle",t.style.display="",i.style.display=""):"mobius"===fe?(e.textContent='Mobius: "I can help with this"',t.classList.remove("delegated"),t.textContent="Let Mobius Handle",t.style.display="",i.style.display=""):"together"===fe?(e.textContent='Mobius: "Let\'s work together"',t.style.display="none",i.style.display=""):(e.textContent='Mobius: "You should review this"',t.style.display="none",i.style.display=""))}else e&&(e.textContent=`${n} ${1===n?"item":"items"} remaining`),o&&(o.textContent=""),t&&(t.style.display="none")},G=()=>{Ce()};O(),F(),G(),(()=>{const n=d.querySelector(".mobius-mini-dot"),e=d.querySelector(".mobius-mini-minimized-patient"),o=Ye();if(e&&(e.textContent=o.name||"Unknown"),n){let e=me.color;"resolved"!==me.userStatus&&"unresolved"!==me.userStatus||(e="purple"),n.className=`mobius-mini-dot ${Oe(e)}`}})(),U(I,re),U(R,ae,!0);const Y=[{status:"resolved",label:"Resolved",icon:"✓",description:"Problem fixed, no further action"},{status:"unresolved",label:"Unresolved",icon:"✗",description:"Issue remains unresolved"}],W=P.querySelector(".mobius-mini-status-badge");W?.addEventListener("click",async n=>{n.stopPropagation(),document.querySelectorAll(".mobius-mini-status-dropdown").forEach(n=>n.remove());const e=W.getBoundingClientRect(),o=((n,e,o,t)=>{const i=document.createElement("div");i.className="mobius-mini-status-dropdown mobius-mini-attention-dropdown";const s=Ue(t,220,150,{preferAbove:!0,gap:4});i.style.cssText=`\n      position: fixed;\n      top: ${s.top}px;\n      left: ${s.left}px;\n      background: white;\n      border: 1px solid #e2e8f0;\n      border-radius: 6px;\n      box-shadow: 0 4px 16px rgba(0,0,0,0.18);\n      z-index: 2147483647;\n      min-width: 220px;\n      padding: 4px 0;\n      transform-origin: ${s.transformOrigin};\n    `,Y.forEach(e=>{const o=e.status===n,t=document.createElement("button");t.type="button",t.style.cssText=`\n        display: flex;\n        flex-direction: column;\n        align-items: flex-start;\n        gap: 1px;\n        width: 100%;\n        padding: 6px 8px;\n        border: none;\n        background: ${o?"#f1f5f9":"transparent"};\n        cursor: pointer;\n        text-align: left;\n      `,t.innerHTML=`\n        <div style="display:flex;align-items:center;gap:6px;font-size:10px;font-weight:500;">\n          <span>${e.icon}</span>\n          <span>${e.label}</span>\n        </div>\n        <div style="font-size:8px;color:#64748b;padding-left:16px;">${e.description}</div>\n      `,t.addEventListener("click",n=>{n.stopPropagation(),console.log("[Mobius DEBUG] Dropdown item clicked:",e.status),(async n=>{console.log("[Mobius DEBUG] onSelect called with status:",n);const e=Ye().id;if(console.log("[Mobius DEBUG] patientId from getPatientDisplay():",e),console.log("[Mobius DEBUG] autoDetectedPatient:",le),console.log("[Mobius DEBUG] patientOverride:",de),e)try{console.log("[Mobius DEBUG] Calling submitAttentionStatus with:",{sessionId:Jn,patientId:e,status:n});const o=await T(Jn,e,n);console.log("[Mobius DEBUG] submitAttentionStatus response:",o);const t=await L(Jn,e);if(t.needs_attention){me={color:t.needs_attention.color,problemStatement:t.needs_attention.problem_statement??null,userStatus:t.needs_attention.user_status??null};const e=document.getElementById(Zn);e&&($e(e),Ce()),console.log("[Mobius] Status updated and refreshed from database:",t.needs_attention.user_status),je("resolved"===n?"Marked as resolved":"unresolved"===n?"Marked as unresolved":"Status updated")}o.open_sidecar&&await Ve()}catch(n){if(console.error("[Mobius] Failed to update attention status:",n),je("Failed to update status"),e)try{const n=await L(Jn,e);if(n.needs_attention){me={color:n.needs_attention.color,problemStatement:n.needs_attention.problem_statement??null,userStatus:n.needs_attention.user_status??null};const e=document.getElementById(Zn);e&&($e(e),Ce())}}catch(n){console.error("[Mobius] Failed to refresh status on error:",n)}}else console.log("[Mobius DEBUG] No patientId found - status update skipped!")})(e.status),i.remove()}),t.addEventListener("mouseenter",()=>{t.style.background="#f1f5f9"}),t.addEventListener("mouseleave",()=>{t.style.background=o?"#f1f5f9":"transparent"}),i.appendChild(t)});const r=document.createElement("div");r.style.cssText="\n      height: 1px;\n      background: #e2e8f0;\n      margin: 4px 8px;\n    ",i.appendChild(r);const a=document.createElement("button");return a.type="button",a.style.cssText="\n      display: flex;\n      flex-direction: column;\n      align-items: flex-start;\n      gap: 1px;\n      width: 100%;\n      padding: 6px 8px;\n      border: none;\n      background: transparent;\n      cursor: pointer;\n      text-align: left;\n    ",a.innerHTML='\n      <div style="display:flex;align-items:center;gap:6px;font-size:10px;font-weight:500;color:#2563eb;">\n        <span>+</span>\n        <span>Report new issue</span>\n      </div>\n      <div style="font-size:8px;color:#64748b;padding-left:16px;">Add a new problem</div>\n    ',a.addEventListener("click",n=>{n.stopPropagation(),i.remove(),(()=>{const n=(n=>{const e=document.createElement("div");e.className="mobius-mini-modal-overlay",e.style.cssText="\n      position: fixed;\n      inset: 0;\n      background: rgba(0,0,0,0.3);\n      z-index: 2147483647;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n    ";const o=document.createElement("div");o.className="mobius-mini-issue-modal",o.style.cssText="\n      background: white;\n      border-radius: 8px;\n      box-shadow: 0 8px 32px rgba(0,0,0,0.2);\n      width: 280px;\n      overflow: hidden;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    ",o.innerHTML='\n      <div style="display:flex;align-items:center;justify-content:space-between;padding:10px 12px;border-bottom:1px solid #e2e8f0;">\n        <span style="font-size:11px;font-weight:600;color:#0b1220;">Report Issue</span>\n        <button type="button" class="modal-close" style="background:none;border:none;cursor:pointer;font-size:16px;color:#64748b;padding:0;line-height:1;">&times;</button>\n      </div>\n      <div style="padding:12px;">\n        <input type="text" class="issue-input" placeholder="Describe the issue..." style="\n          width:100%;\n          box-sizing:border-box;\n          padding:8px 10px;\n          border:1px solid #e2e8f0;\n          border-radius:6px;\n          font-size:10px;\n          outline:none;\n        " />\n      </div>\n      <div style="display:flex;gap:8px;justify-content:flex-end;padding:0 12px 12px;">\n        <button type="button" class="modal-cancel" style="\n          padding:6px 12px;\n          border:1px solid #e2e8f0;\n          border-radius:6px;\n          background:white;\n          font-size:10px;\n          cursor:pointer;\n        ">Cancel</button>\n        <button type="button" class="modal-submit" style="\n          padding:6px 12px;\n          border:none;\n          border-radius:6px;\n          background:#2563eb;\n          color:white;\n          font-size:10px;\n          font-weight:500;\n          cursor:pointer;\n        ">Submit</button>\n      </div>\n    ',e.appendChild(o);const t=o.querySelector(".issue-input"),i=o.querySelector(".modal-close"),s=o.querySelector(".modal-cancel"),r=o.querySelector(".modal-submit"),a=()=>e.remove();return i.addEventListener("click",a),s.addEventListener("click",a),e.addEventListener("click",n=>{n.target===e&&a()}),r.addEventListener("click",()=>{const e=t.value.trim();e&&(n(e),a())}),t.addEventListener("keydown",e=>{if("Enter"===e.key){const e=t.value.trim();e&&(n(e),a())}"Escape"===e.key&&a()}),setTimeout(()=>t.focus(),50),e})(async n=>{const e=Ye().id;if(e)try{await async function(n,e,o){const t=await fetch(`${A}/mini/issue`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({session_id:n,patient_key:e,issue_text:o})});if(!t.ok){const n=await t.json();throw new Error(n.error||"Failed to report issue")}return t.json()}(Jn,e,n),je("Issue reported")}catch(n){console.error("[Mobius] Failed to report issue:",n),je("Failed to report issue")}});document.body.appendChild(n)})()}),a.addEventListener("mouseenter",()=>{a.style.background="#eff6ff"}),a.addEventListener("mouseleave",()=>{a.style.background="transparent"}),i.appendChild(a),i})(me.userStatus,0,0,e);document.body.appendChild(o)});const X=q.querySelector(".mobius-mini-accept-btn");X?.addEventListener("click",async n=>{if(n.stopPropagation(),X.classList.contains("delegated"))return;if(!fe||"mobius"!==fe)return void je("Please review in Sidecar");const e=ue?.current_step?.factor_type||ue?.gap_types?.[0]||null;if(!e)return void je("No bottleneck factor found");X.classList.add("mobius-mini-btn-active"),X.disabled=!0;const o=We();if(!o)return X.classList.remove("mobius-mini-btn-active"),X.disabled=!1,void je("No patient selected");try{if((await $(o,e,"mobius")).ok){je(`Delegated ${e} to Mobius`),X.classList.remove("mobius-mini-btn-active"),X.classList.add("delegated"),X.textContent="Delegated to Mobius",X.disabled=!1;const n=We();n&&await L(Jn,n).then(n=>{if(n.needs_attention&&(me={color:n.needs_attention.color,problemStatement:n.needs_attention.problem_statement??null,userStatus:n.needs_attention.user_status??null}),be=n.task_count||0,ue=n.resolution_plan||null,pe=n.actions_for_user||0,null!==n.agentic_confidence&&void 0!==n.agentic_confidence){const e=n.agentic_confidence;ge=e>1?e/100:e}else ge=null;fe=n.recommended_mode??null,xe=n.recommendation_reason??null,he=n.agentic_actions??null,Se()})}else X.classList.remove("mobius-mini-btn-active"),X.disabled=!1,je("Failed to delegate")}catch(n){console.error("[Mobius] Failed to set factor mode:",n),X.classList.remove("mobius-mini-btn-active"),X.disabled=!1,je("Failed to delegate")}});const J=q.querySelector(".mobius-mini-review-btn");J?.addEventListener("click",async n=>{n.stopPropagation(),J.classList.add("mobius-mini-btn-active"),setTimeout(()=>{J.classList.remove("mobius-mini-btn-active")},200),await Ve()}),document.addEventListener("click",()=>{document.querySelectorAll(".mobius-mini-status-dropdown").forEach(n=>n.remove())}),z.querySelector(".mobius-mini-icon-btn")?.addEventListener("click",()=>{!function(n){const e=document.getElementById(Kn);e&&e.remove();const o=document.createElement("div");o.id=Kn,o.className="mobius-mini-modal-overlay",o.innerHTML='\n    <div class="mobius-mini-modal" role="dialog" aria-modal="true" aria-label="Edit patient">\n      <div class="mobius-mini-modal-header">\n        <div class="mobius-mini-modal-title">Patient</div>\n        <button class="mobius-mini-modal-close" type="button" aria-label="Close">×</button>\n      </div>\n      <div class="mobius-mini-modal-body">\n        <div class="mobius-mini-field">\n          <div class="mobius-mini-field-label">Name</div>\n          <div class="mobius-mini-search-input">\n            <span class="mobius-mini-search-icon" aria-hidden="true">\n              <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20 15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>\n            </span>\n            <input class="mobius-mini-input mobius-mini-input-with-icon" id="mobius-mini-patient-name" autocomplete="off" />\n          </div>\n          <div class="mobius-mini-suggestions" data-for="name" aria-label="Name suggestions"></div>\n        </div>\n\n        <div class="mobius-mini-field">\n          <div class="mobius-mini-field-label">Patient ID</div>\n          <div class="mobius-mini-search-input">\n            <span class="mobius-mini-search-icon" aria-hidden="true">\n              <svg viewBox="0 0 24 24"><path d="M15.5 14h-.79l-.28-.27A6.471 6.471 0 0 0 16 9.5 6.5 6.5 0 1 0 9.5 16c1.61 0 3.09-.59 4.23-1.57l.27.28v.79L20 21.5 21.5 20 15.5 14zm-6 0C7.01 14 5 11.99 5 9.5S7.01 5 9.5 5 14 7.01 14 9.5 11.99 14 9.5 14z"/></svg>\n            </span>\n            <input class="mobius-mini-input mobius-mini-input-with-icon" id="mobius-mini-patient-id" autocomplete="off" />\n          </div>\n          <div class="mobius-mini-suggestions" data-for="id" aria-label="ID suggestions"></div>\n        </div>\n\n        <div class="mobius-mini-field">\n          <div class="mobius-mini-field-label">Date of birth</div>\n          <input class="mobius-mini-input" id="mobius-mini-patient-dob" placeholder="YYYY-MM-DD" inputmode="numeric" autocomplete="bday" />\n        </div>\n\n        <div class="mobius-mini-field-hint">Start typing to search; select a suggestion to fill both fields.</div>\n      </div>\n      <div class="mobius-mini-modal-actions">\n        <button class="mobius-mini-btn-secondary" type="button" data-action="cancel">Cancel</button>\n        <button class="mobius-mini-btn-primary" type="button" data-action="save">Save</button>\n      </div>\n    </div>\n  ',document.body.appendChild(o);const t=()=>o.remove(),i=o.querySelector(".mobius-mini-modal-close");i?.addEventListener("click",t),o.addEventListener("click",n=>{n.target===o&&t()});const{name:s,id:r,dob:a}=Ye(),d=o.querySelector("#mobius-mini-patient-name"),c=o.querySelector("#mobius-mini-patient-id"),l=o.querySelector("#mobius-mini-patient-dob");d&&(d.value=s),c&&(c.value=r),l&&(l.value=a||"");const m=o.querySelector('.mobius-mini-suggestions[data-for="name"]'),b=o.querySelector('.mobius-mini-suggestions[data-for="id"]');let u,p="name",g=[],f=-1;const x=()=>{g=[],f=-1,m&&(m.innerHTML=""),b&&(b.innerHTML=""),m&&(m.style.display="none"),b&&(b.style.display="none")},h=n=>{const e="name"===n?m:b;if(e){if(0===g.length)return e.innerHTML="",void(e.style.display="none");e.style.display="block",e.innerHTML=g.map((n,e)=>`<button type="button" class="${e===f?"mobius-mini-suggestion active":"mobius-mini-suggestion"}" data-idx="${e}"><span class="name">${n.name.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</span><span class="id">ID ${n.id.replace(/</g,"&lt;").replace(/>/g,"&gt;")}</span></button>`).join(""),e.querySelectorAll(".mobius-mini-suggestion").forEach(n=>{n.addEventListener("click",()=>{const e=Number(n.getAttribute("data-idx")||"-1"),o=g[e];o&&(d&&(d.value=o.name),c&&(c.value=o.id),x())})})}},v=(n,e)=>{const o=e.trim();o.length<2?x():(u&&window.clearTimeout(u),u=window.setTimeout(async()=>{try{const e=await async function(n,e=8){const o=(n||"").trim(),t=new URL(`${A}/mini/patient/search`);t.searchParams.set("q",o),t.searchParams.set("limit",String(e));const i=await fetch(t.toString(),{method:"GET"});if(!i.ok){const n=await i.json();throw new Error(n.error||"Failed to search patients")}return i.json()}(o,8);((n,e)=>{g=e,f=-1,"name"===n?b&&(b.style.display="none"):m&&(m.style.display="none"),h(n)})(n,Array.isArray(e.results)?e.results:[])}catch{x()}},180))},y=n=>{if(g.length>0)if("ArrowDown"===n.key)n.preventDefault(),f=Math.min(g.length-1,f+1),h(p);else if("ArrowUp"===n.key)n.preventDefault(),f=Math.max(0,f-1),h(p);else if("Enter"===n.key){if(f>=0&&f<g.length){n.preventDefault();const e=g[f];d&&(d.value=e.name),c&&(c.value=e.id),x()}}else"Escape"===n.key&&x()};d?.addEventListener("focus",()=>{p="name"}),c?.addEventListener("focus",()=>{p="id"}),d?.addEventListener("input",()=>v("name",d.value)),c?.addEventListener("input",()=>v("id",c.value)),d?.addEventListener("keydown",y),c?.addEventListener("keydown",y),o.querySelector(".mobius-mini-modal")?.addEventListener("click",n=>{n.stopPropagation()}),o.addEventListener("click",()=>x()),o.querySelector('[data-action="cancel"]')?.addEventListener("click",t),o.querySelector('[data-action="save"]')?.addEventListener("click",()=>{const e=(l?.value||"").trim(),o={name:(d?.value||"").trim()||"Unknown",id:(c?.value||"").trim(),dob:e};n(o),t()}),d?.focus()}(n=>{(async n=>{if(de=n,await Ie({[oe]:n}),j(),n.id)try{const e=await L(Jn,n.id);if(re={color:e.proceed.color,text:e.proceed.text},e.tasking&&(ae={color:e.tasking.color,text:e.tasking.text,mode:e.tasking.mode,mode_text:e.tasking.mode_text}),U(I,re),U(R,ae,!0),me=e.needs_attention?{color:e.needs_attention.color,problemStatement:e.needs_attention.problem_statement??null,userStatus:e.needs_attention.user_status??null}:{color:e.proceed.color,problemStatement:e.proceed.text??null,userStatus:null},O(),be=e.task_count||0,ue=e.resolution_plan||null,pe=e.actions_for_user||0,null!==e.agentic_confidence&&void 0!==e.agentic_confidence){const n=e.agentic_confidence;ge=n>1?n/100:n}else ge=null;fe=e.recommended_mode??null,xe=e.recommendation_reason??null,he=e.agentic_actions??null,console.log("[Mobius] Recommendation data:",{agenticConfidence:ge,recommendedMode:fe,recommendationReason:xe,agenticActions:he,actionsForUser:pe,taskCount:be,problemStatement:me.problemStatement}),F(),G(),Le()}catch(n){console.error("[Mobius] Failed to fetch status for patient:",n)}})(n)})});const V=n.querySelector(".mobius-mini-note-input"),Z=n.querySelector(".mobius-mini-send-btn"),K=async()=>{const n=(V?.value||"").trim();if(n)try{const e=ue?{resolution_plan_id:ue.plan_id,plan_step_id:ue.current_step?.step_id}:void 0;await async function(n,e,o,t){const i=await N(`${A}/mini/ack`,{method:"POST",body:JSON.stringify({session_id:n,note:e,patient_key:o?.id||"",resolution_plan_id:t?.resolution_plan_id,plan_step_id:t?.plan_step_id})});if(!i.ok){const n=await i.json();throw new Error(n.error||"Failed to submit note")}return i.json()}(Jn,n,Ye(),e),V&&(V.value=""),je("Note sent")}catch(n){je(n instanceof Error?n.message:"Failed to send")}};Z?.addEventListener("click",()=>{K()}),V?.addEventListener("keydown",n=>{"Enter"===n.key&&(n.preventDefault(),K())}),c.addEventListener("click",()=>{(async()=>{m.style.display="none",await Ve()})()}),m.querySelector('[data-action="disable-site"]')?.addEventListener("click",()=>{m.style.display="none";const n=Pe();(async()=>{await De(n,!1),Re(),He(),je("Disabled on this site")})()});let Q=!1,nn={x:0,y:0,left:0,top:0};const en=e=>{Q=!0,e.currentTarget.setPointerCapture(e.pointerId);const o=n.getBoundingClientRect();nn={x:e.clientX,y:e.clientY,left:o.left,top:o.top},e.preventDefault()},on=e=>{if(!Q)return;const o=e.clientX-nn.x,t=e.clientY-nn.y;n.style.left=`${nn.left+o}px`,n.style.top=`${nn.top+t}px`},tn=()=>{if(!Q)return;Q=!1;const e=n.getBoundingClientRect();Ge(n,{x:e.left,y:e.top})};return e.addEventListener("pointerdown",n=>{(n=>{const e=n;return!!e&&!(e.closest("button")||e.closest("input")||e.closest("select")||e.closest("textarea"))})(n.target)&&en(n)}),e.addEventListener("pointermove",on),e.addEventListener("pointerup",tn),o.addEventListener("pointerdown",en),o.addEventListener("pointermove",on),o.addEventListener("pointerup",tn),window.addEventListener("resize",()=>{const e=n.getBoundingClientRect();Ge(n,{x:e.left,y:e.top})}),n}async function Ve(){console.log("[Mobius OS] Expanding to sidebar...");const n=document.getElementById(Zn);if(n){const e=n.getBoundingClientRect();se={x:e.left,y:e.top},await Ie({[ee]:se}),n.style.display="none"}const e={patient:de||(le?.found?{name:le.display_name||"Patient",id:le.patient_key||""}:null),resolutionPlan:ue,userProfile:Ee,needsAttention:me};await Ze(e)}async function Ze(n){if(console.log("[Mobius OS] Initializing Sidecar UI..."),document.getElementById("mobius-os-sidebar"))return void console.log("[Mobius OS] Sidebar already exists, skipping initialization");Jn=await y(),ye=await F.isEnabled();const e=n.patient,o=e?function(n,e){const o=e.split(/\s+/)[0]||e,t=o.endsWith("s")?`${o}'`:`${o}'s`;return{type:"patient",id:n,displayName:e,shortName:o,possessive:t}}(e.id,e.name):{type:"patient",id:"",displayName:"Unknown Patient",shortName:"Patient",possessive:"Patient's"},t=function(n,e,o=!1){return{isPrivate:o,record:n,staff:e?{displayName:e,shortName:e.split(/\s+/)[0]||e}:void 0}}(o,n.userProfile?.greeting_name||n.userProfile?.display_name,ye);try{const t=e?.id||"",i=new URLSearchParams({session_id:Jn,...t&&{patient_key:t}});console.log("[Mobius] Fetching sidecar state for patient:",t);const s=await fetch(`${x}/api/v1/sidecar/state?${i}`,{method:"GET",headers:{"Content-Type":"application/json",...await no()}});if(s.ok){const n=await s.json();console.log("[Mobius] Sidecar state fetched, factors:",n.factors?.length||0),ve=n}else{const e=await s.text();console.warn("[Mobius] Failed to fetch sidecar state:",s.status,e),ve&&ve.factors&&0!==ve.factors.length?console.log("[Mobius] Keeping existing sidecar state"):ve=Ke(n,o)}}catch(e){console.error("[Mobius] Error fetching sidecar state:",e),ve&&ve.factors&&0!==ve.factors.length?console.log("[Mobius] Keeping existing sidecar state after error"):ve=Ke(n,o)}Vn=document.createElement("div"),Vn.id="mobius-os-sidebar",Vn.setAttribute("style","\n    position: fixed !important;\n    top: 0 !important;\n    right: 0 !important;\n    width: 400px !important;\n    height: 100vh !important;\n    min-height: 100vh !important;\n    max-height: 100vh !important;\n    z-index: 2147483646 !important;\n    overflow: hidden !important;\n    display: flex !important;\n    flex-direction: column !important;\n    margin: 0 !important;\n    padding: 0 !important;\n  ");const{theme:i,density:s}=await vn(Vn);te=i,ie=s,Xn();const r=document.createElement("style");r.id="mobius-os-page-adjust",r.textContent="\n    body {\n      margin-right: 400px !important;\n      transition: margin-right 0.3s ease !important;\n    }\n    html {\n      overflow-x: hidden !important;\n    }\n  ",document.head.appendChild(r);const a=document.createElement("div");a.className="top-row",a.setAttribute("style","display: flex; align-items: center; justify-content: space-between; padding: 6px 12px; border-bottom: 1px solid rgba(11, 18, 32, 0.08); background: rgba(11, 18, 32, 0.02);");const d=document.createElement("div");d.className="header-left",d.setAttribute("style","display: flex; align-items: center; gap: 8px;"),d.appendChild(B({clientName:"CMHC"}));const c=document.createElement("div");c.className="logo-section",c.setAttribute("style","display: flex; align-items: center; gap: 4px;"),c.appendChild(D({status:"idle"}));const l=document.createElement("span");l.className="logo-label",l.setAttribute("style","font-size: 11px; font-weight: 600; color: #0b1220;"),l.textContent="Mobius OS",c.appendChild(l),d.appendChild(c),a.appendChild(d);const m=document.createElement("div");m.setAttribute("style","display: flex; align-items: center; gap: 4px;");const b=function(n){const{alerts:e,onClick:o}=n,t=document.createElement("button");t.className="sidecar-alert-indicator",t.title="View alerts",t.addEventListener("click",o);const i=document.createElement("span");i.className="sidecar-alert-icon",i.innerHTML='\n    <svg viewBox="0 0 24 24" aria-hidden="true">\n      <path d="M12 3c-3.314 0-6 2.686-6 6v3.5l-1.5 2h15L18 12.5V9c0-3.314-2.686-6-6-6z" />\n      <path d="M9.5 17a2.5 2.5 0 0 0 5 0" />\n    </svg>\n  ',t.appendChild(i);const s=e.filter(n=>!n.read).length;if(s>0){const n=document.createElement("span");n.className="sidecar-alert-badge",n.textContent=s>9?"9+":String(s),t.appendChild(n),e.some(n=>!n.read&&"high"===n.priority)&&n.classList.add("sidecar-alert-badge--high")}return t}({alerts:ve?.alerts||[],onClick:()=>{je("Inbox coming soon")}});if(m.appendChild(b),ye){const n=document.createElement("span");n.className="sidecar-privacy-indicator",n.textContent="🔒",n.title="Privacy mode enabled",m.appendChild(n)}const u="mobius_sidecar_view_pref",p=Cn({onCollapse:()=>{eo()},onHistoryClick:()=>je("History coming soon"),onSettingsClick:()=>je("Settings coming soon"),onHelpClick:()=>je("Help coming soon"),onPrivacyChange:async e=>{ye=e,He(),await Ze(n)},onNotificationsChange:n=>{console.log("[Mobius] Notifications:",n)},currentView:(()=>{try{return localStorage.getItem(u)||"focus"}catch{return"focus"}})(),onViewChange:async e=>{(n=>{try{localStorage.setItem(u,n)}catch{}})(e),await Qe(n)}});m.appendChild(p);const g=function(){const n=document.createElement("button");return n.className="sidecar-collapse-btn",n.innerHTML='<svg viewBox="0 0 24 24"><path d="M15.41 7.41L14 6l-6 6 6 6 1.41-1.41L10.83 12z"/></svg>',n.title="Collapse to mini",n.addEventListener("click",()=>{eo()}),n}();if(m.appendChild(g),a.appendChild(m),Vn.appendChild(a),ve?.care_readiness){const n=function({careReadiness:n}){const e=document.createElement("div");e.className="sidecar-status-bar";const o=n.position,t=document.createElement("div");t.className="sidecar-status-bar-title-row";const i=document.createElement("div");i.className="sidecar-status-bar-title",i.textContent="Care Readiness",t.appendChild(i);const s=document.createElement("div");var r;s.className="sidecar-status-bar-context",s.textContent=(r=o,n.direction,r>=90?"Ready for affordable care":r>=70?"Enabling affordable care":r>=50?"Securing care access":r>=30?"Preparing care pathway":"Starting care journey"),t.appendChild(s),e.appendChild(t);const a=document.createElement("div");a.className="sidecar-status-bar-progress-row";const d=document.createElement("div");d.className="sidecar-status-bar-track-wrapper";const c=document.createElement("div");c.className="sidecar-status-bar-track";const l=document.createElement("div");l.className="sidecar-status-bar-progress",l.style.width=`${o}%`,c.appendChild(l);const m=document.createElement("div");m.className="sidecar-status-bar-marker",m.style.left=`${o}%`,c.appendChild(m),d.appendChild(c),a.appendChild(d);const b=document.createElement("div");return b.className="sidecar-status-bar-percent",b.textContent=`${Math.round(o)}%`,a.appendChild(b),e.appendChild(a),e.title=function(n){const e=[];e.push(`Care Readiness: ${Math.round(n.position)}%`);const o=n.factors,t=Object.values(o).filter(n=>"complete"===n.status).length,i=Object.values(o).length;return i>0&&e.push(`${t}/${i} milestones complete`),"improving"===n.direction?e.push("↑ Improving"):"declining"===n.direction&&e.push("↓ Needs attention"),e.join("\n")}(n),e}({careReadiness:ve.care_readiness});Vn.appendChild(n)}const f=document.createElement("div");f.className="sidecar-main-content",f.setAttribute("style","flex: 1; min-height: 0; display: flex; flex-direction: column;");const h=document.createElement("div");h.className="sidecar-cards-container",h.setAttribute("style","flex: 1; min-height: 0; overflow-y: auto; padding: 6px 10px;");const v=document.createElement("div");v.className="sidecar-greeting";const w=Ee?.display_name?.split(" ")[0]||"there",k=(new Date).getHours(),C=k<12?"Good morning":k<17?"Good afternoon":"Good evening";if(v.innerHTML=`\n    <span class="sidecar-greeting-text">${C}, ${w}.</span>\n    <span class="sidecar-greeting-subtext">I'm here to help.</span>\n  `,h.appendChild(v),e){const n=document.createElement("div");n.className="sidecar-patient-row",n.setAttribute("style","\n      display: flex;\n      align-items: center;\n      gap: 6px;\n      padding: 4px 0;\n      border-bottom: 1px solid rgba(11, 18, 32, 0.08);\n      margin-bottom: 6px;\n    ");const o=document.createElement("div");o.setAttribute("style","\n      width: 40px;\n      flex: 0 0 auto;\n      font-size: 7px;\n      letter-spacing: 0.04em;\n      text-transform: uppercase;\n      color: rgba(91, 102, 122, 0.95);\n      font-weight: 600;\n    "),o.textContent="PATIENT",n.appendChild(o);const t=document.createElement("div");t.setAttribute("style","flex: 1; min-width: 0; display: flex; flex-direction: row; align-items: baseline; gap: 6px;");const i=document.createElement("span");i.setAttribute("style","font-size: 10px; font-weight: 500; color: #0b1220; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;"),i.textContent=ye?"Patient":e.name;const s=document.createElement("span");s.setAttribute("style","font-size: 9px; font-weight: 400; color: rgba(91, 102, 122, 0.7); white-space: nowrap;"),s.textContent=ye?"****":`· ${e.id.slice(-4).padStart(8,"*")}`,t.appendChild(i),t.appendChild(s),n.appendChild(t);const r=document.createElement("button");r.className="sidecar-icon-btn",r.innerHTML='<svg viewBox="0 0 24 24"><path d="M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z"/></svg>',r.title="Change patient",r.addEventListener("click",()=>{je("Patient search coming soon")}),n.appendChild(r),h.appendChild(n)}const S=(()=>{try{return localStorage.getItem("mobius_sidecar_view_pref")||"focus"}catch{return"focus"}})(),_=ve?.factors||[];let E=_;if("focus"===S&&(E=_.filter(n=>n.steps&&n.steps.length>0||n.is_focus||"blocked"===n.status||"waiting"===n.status||"unresolved"===n.user_override),0===E.length&&(E=_)),E.length>0){const o=function(n){const{factors:e,onModeSelect:o,onStepAction:t,onEvidenceClick:i,onResolve:s,onAddRemedy:r}=n,a={expandedFactors:new Set};for(const n of e)n.is_focus&&a.expandedFactors.add(n.factor_type);const d=document.createElement("div");return d.className="factor-list",function n(){d.innerHTML="";const c=[...e].sort((n,e)=>n.order-e.order);for(const e of c){const l=An({factor:e,isExpanded:a.expandedFactors.has(e.factor_type),onModeSelect:o,onStepAction:t,onEvidenceClick:i,onToggleExpand:e=>{a.expandedFactors.has(e)?a.expandedFactors.delete(e):a.expandedFactors.add(e),n()},onResolve:s,onAddRemedy:r});if(d.appendChild(l),e.order<c.length){const n=document.createElement("div");n.className="factor-separator",d.appendChild(n)}}}(),d}({factors:E,onModeSelect:async(o,t)=>{console.log("[Mobius] Factor mode selected:",o,t);const i=e?.id||Ye().id;if(i)try{await $(i,o,t),je({mobius:"Mobius is handling this factor.",together:"Working together on this.",manual:"You're handling this."}[t]||"Mode set"),await Qe(n)}catch(n){console.error("[Mobius] Failed to set factor mode:",n),je("Failed to set mode")}else je("No patient selected")},onStepAction:async(o,t,i)=>{console.log("[Mobius] Step action:",o,t,i);const s=e?.id||Ye().id;try{"done"===t?(await fetch(`${x}/api/v1/sidecar/answer`,{method:"POST",headers:{"Content-Type":"application/json",...await no()},body:JSON.stringify({session_id:Jn,patient_key:s,bottleneck_id:o,answer_id:i||"done"})}),je("Answer recorded")):"skip"===t?(await fetch(`${x}/api/v1/sidecar/answer`,{method:"POST",headers:{"Content-Type":"application/json",...await no()},body:JSON.stringify({session_id:Jn,patient_key:s,bottleneck_id:o,answer_id:"skip"})}),je("Step skipped")):"delegate"===t&&(await fetch(`${x}/api/v1/sidecar/assign`,{method:"POST",headers:{"Content-Type":"application/json",...await no()},body:JSON.stringify({bottleneck_id:o,mode:"agentic"})}),je("Delegated to Mobius")),await Qe(n)}catch(n){console.error("[Mobius] Failed step action:",n),je("Action failed")}},onEvidenceClick:async n=>{console.log("[Mobius] Evidence click:",n),je(`Evidence for ${n} - coming soon`)},onResolve:async(o,t)=>{console.log("[Mobius] Factor resolve:",o,t);const i=e?.id||Ye().id;if(i)try{await T(Jn,i,t,o),je("resolved"===t?`${o} marked as resolved`:`${o} reopened`),await Qe(n)}catch(n){console.error("[Mobius] Failed to update status:",n),je("Failed to update status")}else je("No patient selected")},onAddRemedy:async(o,t,i,s)=>{console.log("[Mobius] Add remedy:",o,t,i);const r=e?.id||Ye().id;if(r)try{const e=await fetch(`${x}/api/v1/sidecar/remedy`,{method:"POST",headers:{"Content-Type":"application/json",...await no()},body:JSON.stringify({patient_key:r,factor_type:o,remedy_text:t,outcome:i,outcome_notes:s})}),a=await e.json();a.ok?(je("Thanks! Remedy recorded."),await Qe(n)):je(a.error||"Failed to save remedy")}catch(n){console.error("[Mobius] Failed to add remedy:",n),je("Failed to save remedy")}else je("No patient selected")}});h.appendChild(o)}else{const o=function(n){const{bottlenecks:e,privacyContext:o,recommendedMode:t,agenticConfidence:i,recommendationReason:s,agenticActions:r,onWorkflowSelect:a,onStatusOverride:d,onAnswer:c,onAddNote:l,currentStatus:m}=n,b=document.createElement("div");if(b.className="sidecar-bottleneck-card",0===e.length)return b.innerHTML='\n      <div class="sidecar-bottleneck-clear">\n        <span class="sidecar-bottleneck-clear-icon">✓</span>\n        <span class="sidecar-bottleneck-clear-text">All clear! No issues detected.</span>\n      </div>\n    ',b;let u=t||null;const p=document.createElement("div");p.className="sidecar-workflow-override-row";const g=document.createElement("button");g.className="sidecar-workflow-status-btn",g.type="button","resolved"===m?(g.textContent="Resolved ▾",g.classList.add("status-resolved")):"unresolved"===m?(g.textContent="Unresolved ▾",g.classList.add("status-unresolved")):g.textContent="Set status ▾",p.appendChild(g),b.appendChild(p),g.addEventListener("click",n=>{n.stopPropagation(),document.querySelectorAll(".sidecar-status-dropdown").forEach(n=>n.remove());const e=function(n,e,o){const t=document.createElement("div");t.className="sidecar-status-dropdown";const i=n.top>window.innerHeight-n.bottom?n.top-100-4:n.bottom+4;t.style.cssText=`\n    position: fixed;\n    top: ${i}px;\n    left: ${n.left}px;\n    width: 200px;\n    background: white;\n    border: 1px solid #e2e8f0;\n    border-radius: 6px;\n    box-shadow: 0 4px 16px rgba(0,0,0,0.18);\n    z-index: 2147483647;\n    padding: 4px 0;\n  `,[{status:"resolved",label:"Resolved",icon:"✓",description:"Problem fixed, no further action"},{status:"unresolved",label:"Unresolved",icon:"✗",description:"Issue remains unresolved"}].forEach(n=>{const i=e===n.status,s=document.createElement("button");s.type="button",s.style.cssText=`\n      display: flex;\n      flex-direction: column;\n      align-items: flex-start;\n      gap: 1px;\n      width: 100%;\n      padding: 8px 12px;\n      border: none;\n      background: ${i?"#f1f5f9":"transparent"};\n      cursor: pointer;\n      text-align: left;\n    `,s.innerHTML=`\n      <div style="display:flex;align-items:center;gap:6px;font-size:11px;font-weight:500;color:#1e293b;">\n        <span>${n.icon}</span>\n        <span>${n.label}</span>\n      </div>\n      <div style="font-size:9px;color:#64748b;padding-left:18px;">${n.description}</div>\n    `,s.addEventListener("click",e=>{e.stopPropagation(),o(n.status),t.remove()}),s.addEventListener("mouseenter",()=>{s.style.background="#f1f5f9"}),s.addEventListener("mouseleave",()=>{s.style.background=i?"#f1f5f9":"transparent"}),t.appendChild(s)});const s=n=>{t.contains(n.target)||(t.remove(),document.removeEventListener("click",s))};return setTimeout(()=>document.addEventListener("click",s),0),t}(g.getBoundingClientRect(),m,d);document.body.appendChild(e)});const f=document.createElement("div");if(f.className="sidecar-workflow-problem",f.textContent=function(n,e){const{isPrivate:o,record:t,staff:i}=e,s={"{{name}}":j(t,o),"{{shortName}}":U(t,o),"{{possessive}}":O(t,o),"{{staffName}}":i?o?H(i.displayName):i.displayName:"Team member","{{staffShortName}}":i?o?i.shortName.charAt(0)+".":i.shortName:""};let r=n;for(const[n,e]of Object.entries(s))r=r.replace(new RegExp(n.replace(/[{}]/g,"\\$&"),"g"),e);return r}(e[0].question_text,o),b.appendChild(f),t&&void 0!==i){const n=document.createElement("div");n.className="sidecar-workflow-recommendation";let e="";e="mobius"===t&&i>=80?`Mobius recommends: Let me handle this (${i}% confident)`:"mobius"===t||"together"===t?`Mobius recommends: ${"mobius"===t?"Let me handle this":"Let's work together"} (${i}% confident)`:"Mobius recommends: You should review this",n.innerHTML=`\n      <span class="sidecar-workflow-rec-icon">✦</span>\n      <span class="sidecar-workflow-rec-text">${e}</span>\n    `,b.appendChild(n)}const x=document.createElement("div");x.className="sidecar-workflow-mode-selector";const h=[{id:"mobius",label:"Mobius handle",hint:"Fully automated"},{id:"together",label:"Do together",hint:"Collaborative"},{id:"manual",label:"I'll handle",hint:"Track my work"}];for(const n of h){const e=document.createElement("button");e.className="sidecar-workflow-mode-btn",e.dataset.mode=n.id,u===n.id&&e.classList.add("sidecar-workflow-mode-btn--selected"),e.innerHTML=`\n      <span class="sidecar-workflow-mode-radio">${u===n.id?"●":"○"}</span>\n      <span class="sidecar-workflow-mode-label">${n.label}</span>\n    `,e.title=n.hint,e.addEventListener("click",()=>{u=n.id,x.querySelectorAll(".sidecar-workflow-mode-btn").forEach(n=>{const e=n.dataset.mode===u;n.classList.toggle("sidecar-workflow-mode-btn--selected",e);const o=n.querySelector(".sidecar-workflow-mode-radio");o&&(o.textContent=e?"●":"○")}),_(),a(n.id)}),x.appendChild(e)}b.appendChild(x);const v=document.createElement("div");v.className="sidecar-workflow-divider",b.appendChild(v);const y=document.createElement("div");y.className="sidecar-workflow-content",b.appendChild(y);const w=document.createElement("div");w.className="sidecar-workflow-note-row",w.innerHTML='\n    <div class="sidecar-workflow-note-wrap">\n      <input type="text" class="sidecar-workflow-note-input" placeholder="Add note..." />\n      <button type="button" class="sidecar-workflow-note-send" title="Send note">\n        <svg viewBox="0 0 24 24" aria-hidden="true"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path></svg>\n      </button>\n    </div>\n  ',b.appendChild(w);const k=w.querySelector(".sidecar-workflow-note-input"),C=w.querySelector(".sidecar-workflow-note-send"),S=()=>{const n=k?.value.trim();n&&e[0]&&(l(e[0].id,n),k&&(k.value=""))};function _(){y.innerHTML="";const n=function(){const n=[];for(const o of e)for(const e of o.answer_options)n.push({option:e,bottleneck:o,fullId:`${o.id}:${e.id}`});return n}();if("mobius"===u){const e=document.createElement("div");e.className="sidecar-workflow-mobius-content",r&&r.length>0?e.innerHTML=`\n          <div class="sidecar-workflow-mobius-message">\n            Mobius will handle this automatically.\n          </div>\n          <div class="sidecar-workflow-mobius-actions">\n            <span class="sidecar-workflow-mobius-actions-label">Planned actions:</span>\n            <ul class="sidecar-workflow-mobius-actions-list">\n              ${r.map(n=>{return`<li>${e=n,{search_history:"Search patient history for prior coverage",check_medicaid:"Check Medicaid/Medicare eligibility",send_portal:"Send portal message to patient",send_sms:"Send SMS request",run_eligibility_check:"Run 270/271 eligibility check",check_portal_uploads:"Check portal for recent uploads",send_card_request:"Send insurance card request",run_verification:"Run eligibility verification",check_benefits:"Check benefit details",send_sms_reminder:"Send SMS reminder",book_medicaid_transport:"Book Medicaid transportation",check_transport_status:"Check transport booking status",send_scheduling_link:"Send scheduling link",submit_auth:"Submit authorization request",review_docs:"Review clinical documentation",check_portal_status:"Check payer portal status",compile_docs:"Compile documentation package",submit_renewal:"Submit renewal request",verify_coverage:"Verify coverage status",send_confirmation:"Send confirmation request"}[e]||e.replace(/_/g," ")}</li>`;var e}).join("")}\n            </ul>\n          </div>\n        `:e.innerHTML='\n          <div class="sidecar-workflow-mobius-message">\n            Mobius will handle this automatically. You\'ll be notified when complete.\n          </div>\n        ';const o=n.filter(n=>n.bottleneck.mobius_can_handle);if(o.length>0){const n=document.createElement("div");n.className="sidecar-workflow-mobius-options",n.innerHTML='\n          <div class="sidecar-workflow-option-group-header">\n            <span class="sidecar-workflow-option-group-icon">✓</span>\n            <span class="sidecar-workflow-option-group-title">Mobius will resolve:</span>\n          </div>\n        ';const t=document.createElement("div");t.className="sidecar-workflow-options-list";for(const{option:n,fullId:e}of o){const o=G({...n,id:e},()=>{}),i=o.querySelector('input[type="checkbox"]');i&&(i.disabled=!0,i.checked=!0),t.appendChild(o)}n.appendChild(t),e.appendChild(n)}y.appendChild(e)}else if("together"===u){const e=document.createElement("div");e.className="sidecar-workflow-together-content";const o=[],t=[];for(const e of n)e.bottleneck.mobius_can_handle?o.push(e):t.push(e);if(o.length>0){const n=document.createElement("div");n.className="sidecar-workflow-option-group",n.innerHTML='\n          <div class="sidecar-workflow-option-group-header">\n            <span class="sidecar-workflow-option-group-icon">✦</span>\n            <span class="sidecar-workflow-option-group-title">Mobius can handle</span>\n          </div>\n        ';const t=document.createElement("div");t.className="sidecar-workflow-options-list";for(const{option:n,fullId:e}of o){const o=G({...n,id:e},n=>{if(n){const[n,o]=e.split(":");c(n,o)}});t.appendChild(o)}n.appendChild(t),e.appendChild(n)}if(t.length>0){const n=document.createElement("div");n.className="sidecar-workflow-option-group",n.innerHTML='\n          <div class="sidecar-workflow-option-group-header">\n            <span class="sidecar-workflow-option-group-icon">👤</span>\n            <span class="sidecar-workflow-option-group-title">You\'ll need to handle</span>\n          </div>\n        ';const o=document.createElement("div");o.className="sidecar-workflow-options-list";for(const{option:n,fullId:e}of t){const t=G({...n,id:e},n=>{if(n){const[n,o]=e.split(":");c(n,o)}});o.appendChild(t)}n.appendChild(o),e.appendChild(n)}0===n.length&&(e.innerHTML='\n          <div class="sidecar-workflow-prompt">\n            No options available for this issue.\n          </div>\n        '),y.appendChild(e)}else if("manual"===u){const n=document.createElement("div");n.className="sidecar-workflow-manual-content",n.innerHTML='\n        <div class="sidecar-workflow-manual-message">\n          Select an option below to resolve each task. Mobius will monitor and remind if needed.\n        </div>\n      ';const o=document.createElement("div");o.className="sidecar-manual-tasks-container";for(const n of e.slice(0,2)){const e=Y(n,c);o.appendChild(e)}n.appendChild(o),y.appendChild(n)}else y.innerHTML='\n        <div class="sidecar-workflow-prompt">\n          Select how you\'d like to handle this issue above.\n        </div>\n      '}return C?.addEventListener("click",S),k?.addEventListener("keydown",n=>{"Enter"===n.key&&(n.preventDefault(),S())}),_(),b}({bottlenecks:ve?.bottlenecks||[],privacyContext:t,recommendedMode:fe??void 0,agenticConfidence:ge??void 0,recommendationReason:xe??void 0,agenticActions:he??void 0,onWorkflowSelect:async(n,o)=>{console.log("[Mobius] Workflow mode selected:",n);try{await fetch(`${x}/api/v1/sidecar/workflow`,{method:"POST",headers:{"Content-Type":"application/json",...await no()},body:JSON.stringify({patient_key:e?.id,mode:n,note:o})}),je({mobius:"Mobius is on it. You'll be notified when complete.",together:"Let's work on this together.",manual:"Got it. Tracking your progress."}[n]||"Workflow mode set")}catch(n){console.error("[Mobius] Failed to set workflow mode:",n),je("Failed to set workflow mode")}},onStatusOverride:async o=>{console.log("[Mobius] Status override:",o);const t=e?.id||Ye().id;if(t)try{await T(Jn,t,o);const e=await L(Jn,t);e.needs_attention&&(me={color:e.needs_attention.color,problemStatement:e.needs_attention.problem_statement??null,userStatus:e.needs_attention.user_status??null}),je("resolved"===o?"Marked as resolved":"Marked as unresolved"),await Qe(n)}catch(n){console.error("[Mobius] Failed to update status:",n),je("Failed to update status")}else je("No patient selected")},currentStatus:me.userStatus,onAnswer:async(n,o)=>{console.log("[Mobius] Answer:",n,o);try{await fetch(`${x}/api/v1/sidecar/answer`,{method:"POST",headers:{"Content-Type":"application/json",...await no()},body:JSON.stringify({session_id:Jn,patient_key:e?.id,bottleneck_id:n,answer_id:o})}),je("Answer recorded")}catch(n){console.error("[Mobius] Failed to submit answer:",n),je("Failed to submit answer")}},onAddNote:async(n,o)=>{try{await fetch(`${x}/api/v1/sidecar/note`,{method:"POST",headers:{"Content-Type":"application/json",...await no()},body:JSON.stringify({session_id:Jn,patient_key:e?.id,bottleneck_id:n,note_text:o})}),je("Note added")}catch(n){console.error("[Mobius] Failed to add note:",n)}}});h.appendChild(o)}if(ve?.milestones&&ve?.knowledge_context){const e=function(n){const{milestones:e,knowledgeContext:o,privacyContext:t,resolutionPlan:i,resolvedSteps:s=[],defaultExpanded:r=!1}=n,a=document.createElement("div");a.className="sidecar-context-expander";const d=document.createElement("button");d.className="sidecar-context-expander-toggle",d.innerHTML=`\n    <span class="sidecar-context-expander-arrow">${r?"▾":"▸"}</span>\n    <span class="sidecar-context-expander-label">Prior Runs</span>\n  `;const c=document.createElement("div");c.className="sidecar-context-expander-content",c.style.display=r?"block":"none",d.addEventListener("click",()=>{const n="none"!==c.style.display;c.style.display=n?"none":"block";const e=d.querySelector(".sidecar-context-expander-arrow");e&&(e.textContent=n?"▸":"▾")});const l=function(){const n=document.createElement("div");n.className="sidecar-prior-runs-section";const e=[{date:"Jan 8, 2026",type:"Office Visit",outcome:"Paid",summary:"Eligibility issue resolved via phone call to Aetna. Policy confirmed active."},{date:"Nov 15, 2025",type:"Lab Work",outcome:"Paid",summary:"Coverage verified automatically. No issues."},{date:"Sep 3, 2025",type:"Office Visit",outcome:"Paid (delayed)",summary:"Auth required but not obtained. Resolved with retroactive auth after peer-to-peer."}],o=document.createElement("div");o.className="sidecar-prior-runs-list";for(const n of e){const e=document.createElement("div");e.className="sidecar-prior-run",e.innerHTML=`\n      <div class="sidecar-prior-run-header">\n        <span class="sidecar-prior-run-date">${n.date}</span>\n        <span class="sidecar-prior-run-type">${n.type}</span>\n        <span class="sidecar-prior-run-outcome sidecar-prior-run-outcome--${n.outcome.toLowerCase().includes("paid")?"paid":"issue"}">${n.outcome}</span>\n      </div>\n      <div class="sidecar-prior-run-summary">${n.summary}</div>\n    `,o.appendChild(e)}return n.appendChild(o),n}();return c.appendChild(l),a.appendChild(d),a.appendChild(c),a}({milestones:ve.milestones,knowledgeContext:ve.knowledge_context,privacyContext:t,resolutionPlan:n.resolutionPlan,resolvedSteps:ve.resolved_steps||[]});h.appendChild(e)}f.appendChild(h);const z=function(n){const{record:e,onSend:o,placeholder:t}=n,i=document.createElement("div");i.className="sidecar-quick-chat";const s=document.createElement("div");s.className="sidecar-chat-messages";const r=document.createElement("div");r.className="sidecar-chat-empty",r.textContent="Ask questions about coverage, auth requirements, history...",s.appendChild(r),i.appendChild(s);const a=document.createElement("div");a.className="sidecar-quick-chat-wrapper";const d=document.createElement("input");d.type="text",d.className="sidecar-quick-chat-input",d.placeholder=t||`Ask about ${e.shortName}...`;const c=document.createElement("button");return c.className="sidecar-quick-chat-send",c.innerHTML='\n    <svg viewBox="0 0 24 24" aria-hidden="true">\n      <path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z"></path>\n    </svg>\n  ',c.disabled=!0,c.title="Send",d.addEventListener("input",()=>{c.disabled=0===d.value.trim().length}),c.addEventListener("click",()=>{const n=d.value.trim();n&&(o(n),d.value="",c.disabled=!0)}),d.addEventListener("keydown",n=>{if("Enter"===n.key&&!n.shiftKey){n.preventDefault();const e=d.value.trim();e&&(o(e),d.value="",c.disabled=!0)}}),a.appendChild(d),a.appendChild(c),i.appendChild(a),i}({record:o,knowledgeContext:ve?.knowledge_context||{payer:{name:""},policy_excerpts:[],relevant_history:[]},onSend:async n=>{console.log("[Mobius] Chat:",n),je("Chat coming soon")}});f.appendChild(z),Vn.appendChild(f),document.body.appendChild(Vn),Wn(Vn),console.log("[Mobius OS] Sidecar UI initialized")}function Ke(n,e){const o=[];if(n.resolutionPlan?.current_step){const e=n.resolutionPlan.current_step;o.push({id:e.step_id,milestone_id:e.factor_type||"unknown",question_text:e.question_text,answer_options:(e.answer_options||[]).map(n=>({id:n.code,label:n.label,description:n.description})),mobius_can_handle:!0,mobius_mode:e.system_suggestion?"agentic":"copilot",mobius_action:e.system_suggestion?.source||"Mobius will verify this for you",sources:{}})}return{ok:!0,session_id:Jn,surface:"sidecar",record:e,care_readiness:{position:50,direction:"stable",factors:{visit_confirmed:{status:"pending"},eligibility_verified:{status:"pending"},authorization_secured:{status:"pending"},documentation_ready:{status:"pending"}}},factors:[],bottlenecks:o,resolved_steps:[],milestones:[],knowledge_context:{payer:{name:""},policy_excerpts:[],relevant_history:[]},alerts:[],user_owned_tasks:[],computed_at:(new Date).toISOString()}}async function Qe(n){const e=ve;He();try{await Ze(n),e?.factors&&e.factors.length>0&&(!ve?.factors||0===ve.factors.length)&&(console.warn("[Mobius] Refresh resulted in empty factors, restoring previous state"),ve=e,He(),await Ze(n))}catch(o){if(console.error("[Mobius] Error refreshing sidecar, restoring previous state:",o),e){ve=e;try{await Ze(n)}catch(n){console.error("[Mobius] Failed to restore previous sidecar state:",n)}}}}async function no(){const n=M(),e=await n.getAccessToken();return e?{Authorization:`Bearer ${e}`}:{}}async function eo(){He(),await oo(),Ce(),Se()}async function oo(){await async function(){const n=await qe([ee,oe]),e=n[ee];e&&"number"==typeof e.x&&"number"==typeof e.y&&(se={x:e.x,y:e.y});const o=n[oe];o&&"string"==typeof o.name&&"string"==typeof o.id&&(de={name:o.name,id:o.id,dob:"string"==typeof o.dob?o.dob:void 0})}();const n=Pe(),e=await async function(n){const e=(n||"").toLowerCase();return!!e&&(await Be()).map(n=>n.toLowerCase()).includes(e)}(n);if(!e)return void Re();Jn||(Jn=await y());const o=M();_e=await o.isAuthenticated(),_e&&(Ee=await o.getUserProfile());let t=document.getElementById(Zn);if(t)t.style.display="";else{t=Je(),document.body.appendChild(t);const n=se||{x:14,y:14};await Ge(t,n);const{theme:e,density:o}=await vn(t);te=e,ie=o,Xn()}const i=t.querySelector(".mobius-mini-greeting-row"),s=t.querySelector(".mobius-mini-row"),r=t.querySelector(".mobius-mini-attention-row"),a=t.querySelector(".mobius-mini-task-badge-row"),d=t.querySelectorAll(".mobius-mini-row")[3];let c=t.querySelector(".mobius-mini-locked-overlay");const l=x;if(!_e){if(!c){c=document.createElement("div"),c.className="mobius-mini-locked-overlay",c.style.cssText="\n        padding: 12px;\n        background: linear-gradient(180deg, rgba(248, 250, 252, 0.98), rgba(241, 245, 249, 0.98));\n      ",c.innerHTML='\n        <div style="text-align: center; margin-bottom: 10px;">\n          <div style="font-size: 20px; margin-bottom: 4px;">🔒</div>\n          <div style="font-size: 10px; font-weight: 600; color: #0b1220;">Sign in to Mobius</div>\n        </div>\n        <div class="mobius-mini-login-form">\n          <input type="email" class="mobius-mini-login-email" placeholder="Email" style="\n            width: 100%;\n            box-sizing: border-box;\n            padding: 8px 10px;\n            border: 1px solid rgba(11, 18, 32, 0.15);\n            border-radius: 6px;\n            font-size: 10px;\n            margin-bottom: 6px;\n            outline: none;\n          " value="sarah.chen@demo.clinic" />\n          <input type="password" class="mobius-mini-login-password" placeholder="Password" style="\n            width: 100%;\n            box-sizing: border-box;\n            padding: 8px 10px;\n            border: 1px solid rgba(11, 18, 32, 0.15);\n            border-radius: 6px;\n            font-size: 10px;\n            margin-bottom: 8px;\n            outline: none;\n          " value="demo1234" />\n          <button class="mobius-mini-signin-btn" style="\n            width: 100%;\n            padding: 8px 12px;\n            background: #2563eb;\n            color: white;\n            border: none;\n            border-radius: 6px;\n            font-size: 10px;\n            font-weight: 500;\n            cursor: pointer;\n          ">Sign in</button>\n          <div class="mobius-mini-login-error" style="\n            font-size: 9px;\n            color: #dc2626;\n            margin-top: 6px;\n            display: none;\n          "></div>\n          \n          \x3c!-- Divider --\x3e\n          <div style="display: flex; align-items: center; margin: 12px 0 10px;">\n            <div style="flex: 1; height: 1px; background: rgba(11, 18, 32, 0.1);"></div>\n            <span style="padding: 0 8px; font-size: 8px; color: #94a3b8;">or continue with</span>\n            <div style="flex: 1; height: 1px; background: rgba(11, 18, 32, 0.1);"></div>\n          </div>\n          \n          \x3c!-- OAuth options --\x3e\n          <div style="display: flex; gap: 8px; margin-bottom: 10px;">\n            <button class="mobius-mini-oauth-btn" data-provider="google" style="\n              flex: 1;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 6px;\n              padding: 8px;\n              background: white;\n              border: 1px solid rgba(11, 18, 32, 0.15);\n              border-radius: 6px;\n              font-size: 9px;\n              color: #374151;\n              cursor: pointer;\n            ">\n              <svg width="12" height="12" viewBox="0 0 24 24">\n                <path fill="#4285F4" d="M22.56 12.25c0-.78-.07-1.53-.2-2.25H12v4.26h5.92c-.26 1.37-1.04 2.53-2.21 3.31v2.77h3.57c2.08-1.92 3.28-4.74 3.28-8.09z"/>\n                <path fill="#34A853" d="M12 23c2.97 0 5.46-.98 7.28-2.66l-3.57-2.77c-.98.66-2.23 1.06-3.71 1.06-2.86 0-5.29-1.93-6.16-4.53H2.18v2.84C3.99 20.53 7.7 23 12 23z"/>\n                <path fill="#FBBC05" d="M5.84 14.09c-.22-.66-.35-1.36-.35-2.09s.13-1.43.35-2.09V7.07H2.18C1.43 8.55 1 10.22 1 12s.43 3.45 1.18 4.93l2.85-2.22.81-.62z"/>\n                <path fill="#EA4335" d="M12 5.38c1.62 0 3.06.56 4.21 1.64l3.15-3.15C17.45 2.09 14.97 1 12 1 7.7 1 3.99 3.47 2.18 7.07l3.66 2.84c.87-2.6 3.3-4.53 6.16-4.53z"/>\n              </svg>\n              Google\n            </button>\n            <button class="mobius-mini-oauth-btn" data-provider="microsoft" style="\n              flex: 1;\n              display: flex;\n              align-items: center;\n              justify-content: center;\n              gap: 6px;\n              padding: 8px;\n              background: white;\n              border: 1px solid rgba(11, 18, 32, 0.15);\n              border-radius: 6px;\n              font-size: 9px;\n              color: #374151;\n              cursor: pointer;\n            ">\n              <svg width="12" height="12" viewBox="0 0 23 23">\n                <path fill="#f35325" d="M1 1h10v10H1z"/>\n                <path fill="#81bc06" d="M12 1h10v10H12z"/>\n                <path fill="#05a6f0" d="M1 12h10v10H1z"/>\n                <path fill="#ffba08" d="M12 12h10v10H12z"/>\n              </svg>\n              Microsoft\n            </button>\n          </div>\n          \n          \x3c!-- Enterprise SSO --\x3e\n          <button class="mobius-mini-sso-btn" style="\n            width: 100%;\n            padding: 8px 12px;\n            background: #f8fafc;\n            border: 1px solid rgba(11, 18, 32, 0.15);\n            border-radius: 6px;\n            font-size: 9px;\n            color: #374151;\n            cursor: pointer;\n            margin-bottom: 10px;\n          ">\n            <span style="display: flex; align-items: center; justify-content: center; gap: 6px;">\n              <svg width="12" height="12" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">\n                <path d="M12 2L2 7l10 5 10-5-10-5z"/>\n                <path d="M2 17l10 5 10-5"/>\n                <path d="M2 12l10 5 10-5"/>\n              </svg>\n              Enterprise SSO\n            </span>\n          </button>\n          \n          \x3c!-- Create account link --\x3e\n          <div style="text-align: center; font-size: 9px; color: #64748b;">\n            Don\'t have an account? \n            <a href="#" class="mobius-mini-create-account" style="color: #2563eb; text-decoration: none; font-weight: 500;">Create one</a>\n          </div>\n          \n          <div style="font-size: 8px; color: #94a3b8; margin-top: 8px; text-align: center;">\n            Demo: sarah.chen@demo.clinic\n          </div>\n        </div>\n      ',t.appendChild(c);const n=c.querySelector(".mobius-mini-login-email"),e=c.querySelector(".mobius-mini-login-password"),o=c.querySelector(".mobius-mini-signin-btn"),i=c.querySelector(".mobius-mini-login-error"),s=async()=>{const t=n?.value.trim()||"",s=e?.value||"";if(t&&s){o&&(o.textContent="Signing in...",o.disabled=!0);try{const n=M(),e=await n.login(t,s);e.success?(je("Signed in successfully!"),await oo()):i&&(i.textContent=e.error||"Login failed",i.style.display="block")}catch(n){i&&(i.textContent="Connection error",i.style.display="block")}finally{o&&(o.textContent="Sign in",o.disabled=!1)}}else i&&(i.textContent="Please enter email and password",i.style.display="block")};o?.addEventListener("click",()=>{s()}),e?.addEventListener("keydown",n=>{"Enter"===n.key&&s()}),c.querySelectorAll(".mobius-mini-oauth-btn").forEach(n=>{n.addEventListener("click",()=>{const e=n.dataset.provider;je(("google"===e?"Google":"Microsoft")+" sign-in coming soon"),console.log(`[Mobius] OAuth login with ${e}`)}),n.addEventListener("mouseenter",()=>{n.style.background="#f1f5f9"}),n.addEventListener("mouseleave",()=>{n.style.background="white"})});const r=c.querySelector(".mobius-mini-sso-btn");r?.addEventListener("click",()=>{je("Enterprise SSO coming soon"),console.log("[Mobius] Enterprise SSO login")}),r?.addEventListener("mouseenter",()=>{r.style.background="#f1f5f9"}),r?.addEventListener("mouseleave",()=>{r.style.background="#f8fafc"});const a=c.querySelector(".mobius-mini-create-account");a?.addEventListener("click",n=>{n.preventDefault(),(()=>{c||(c=document.createElement("div"),c.className="mobius-mini-locked-overlay",c.style.cssText="\n        padding: 12px;\n        background: linear-gradient(180deg, rgba(248, 250, 252, 0.98), rgba(241, 245, 249, 0.98));\n      ",t.appendChild(c)),c.innerHTML='\n      <div style="text-align: center; margin-bottom: 12px;">\n        <div style="font-size: 18px; margin-bottom: 4px;">✨</div>\n        <div style="font-size: 11px; font-weight: 600; color: #0b1220;">Create Your Account</div>\n        <div style="font-size: 9px; color: #64748b; margin-top: 2px;">Step 1 of 2</div>\n      </div>\n      <div class="mobius-mini-register-form">\n        <input type="text" class="mobius-mini-reg-firstname" placeholder="First name *" style="\n          width: 100%;\n          box-sizing: border-box;\n          padding: 8px 10px;\n          border: 1px solid rgba(11, 18, 32, 0.15);\n          border-radius: 6px;\n          font-size: 10px;\n          margin-bottom: 6px;\n          outline: none;\n        " />\n        <input type="text" class="mobius-mini-reg-lastname" placeholder="Last name (optional)" style="\n          width: 100%;\n          box-sizing: border-box;\n          padding: 8px 10px;\n          border: 1px solid rgba(11, 18, 32, 0.15);\n          border-radius: 6px;\n          font-size: 10px;\n          margin-bottom: 6px;\n          outline: none;\n        " />\n        <input type="email" class="mobius-mini-reg-email" placeholder="Email address *" style="\n          width: 100%;\n          box-sizing: border-box;\n          padding: 8px 10px;\n          border: 1px solid rgba(11, 18, 32, 0.15);\n          border-radius: 6px;\n          font-size: 10px;\n          margin-bottom: 6px;\n          outline: none;\n        " />\n        <input type="password" class="mobius-mini-reg-password" placeholder="Password (8+ characters) *" style="\n          width: 100%;\n          box-sizing: border-box;\n          padding: 8px 10px;\n          border: 1px solid rgba(11, 18, 32, 0.15);\n          border-radius: 6px;\n          font-size: 10px;\n          margin-bottom: 6px;\n          outline: none;\n        " />\n        <input type="password" class="mobius-mini-reg-confirm" placeholder="Confirm password *" style="\n          width: 100%;\n          box-sizing: border-box;\n          padding: 8px 10px;\n          border: 1px solid rgba(11, 18, 32, 0.15);\n          border-radius: 6px;\n          font-size: 10px;\n          margin-bottom: 8px;\n          outline: none;\n        " />\n        <button class="mobius-mini-reg-submit" style="\n          width: 100%;\n          padding: 8px 12px;\n          background: #2563eb;\n          color: white;\n          border: none;\n          border-radius: 6px;\n          font-size: 10px;\n          font-weight: 500;\n          cursor: pointer;\n        ">Continue</button>\n        <div class="mobius-mini-reg-error" style="\n          font-size: 9px;\n          color: #dc2626;\n          margin-top: 6px;\n          display: none;\n        "></div>\n        <div style="text-align: center; font-size: 9px; color: #64748b; margin-top: 10px;">\n          Already have an account? \n          <a href="#" class="mobius-mini-back-to-login" style="color: #2563eb; text-decoration: none; font-weight: 500;">Sign in</a>\n        </div>\n      </div>\n    ';const n=c.querySelector(".mobius-mini-reg-firstname"),e=c.querySelector(".mobius-mini-reg-lastname"),o=c.querySelector(".mobius-mini-reg-email"),i=c.querySelector(".mobius-mini-reg-password"),s=c.querySelector(".mobius-mini-reg-confirm"),r=c.querySelector(".mobius-mini-reg-submit"),a=c.querySelector(".mobius-mini-reg-error"),d=c.querySelector(".mobius-mini-back-to-login"),m=n=>{a&&(a.textContent=n,a.style.display="block")},b=async()=>{const t=n?.value.trim()||"",d=e?.value.trim()||"",b=o?.value.trim()||"",u=i?.value||"",p=s?.value||"";if(t)if(b)if(u)if(u.length<8)m("Password must be at least 8 characters");else if(u===p){r&&(r.textContent="Creating account...",r.disabled=!0),a&&(a.style.display="none");try{const n=await fetch(`${l}/api/v1/auth/register`,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({email:b,password:u,first_name:t,display_name:d?`${t} ${d}`:t})}),e=await n.json();if(e.ok&&e.access_token){const n=M();await n.storeTokens({access_token:e.access_token,refresh_token:e.refresh_token,expires_in:e.expires_in||3600}),(async(n,e)=>{if(!c)return;const o=await(async()=>{try{const n=await fetch(`${l}/api/v1/auth/activities`),e=await n.json();if(e.ok&&e.activities)return e.activities}catch(n){console.error("[Mobius] Failed to fetch activities:",n)}return[{activity_code:"verify_eligibility",label:"Verify Insurance Eligibility"},{activity_code:"check_in_patients",label:"Check In Patients"},{activity_code:"schedule_appointments",label:"Schedule Appointments"},{activity_code:"submit_claims",label:"Submit Claims"},{activity_code:"rework_claims",label:"Rework Denied Claims"},{activity_code:"prior_auth",label:"Prior Authorizations"},{activity_code:"patient_collections",label:"Patient Collections"},{activity_code:"post_payments",label:"Post Payments"}]})();c.style.cssText="\n      display: flex;\n      flex-direction: column;\n      height: 100%;\n      max-height: 500px;\n      padding: 12px;\n      background: linear-gradient(180deg, rgba(248, 250, 252, 0.98), rgba(241, 245, 249, 0.98));\n      overflow: hidden;\n    ",c.innerHTML=`\n      <div style="text-align: center; margin-bottom: 10px; flex-shrink: 0;">\n        <div style="font-size: 16px; margin-bottom: 4px;">👋</div>\n        <div style="font-size: 11px; font-weight: 600; color: #0b1220;">Welcome, ${n}!</div>\n        <div style="font-size: 9px; color: #64748b; margin-top: 2px;">Step 2 of 2 - Your preferences</div>\n      </div>\n      \n      <div class="mobius-mini-onboarding-form" style="flex: 1; overflow-y: auto; padding-right: 4px; min-height: 0;">\n        \x3c!-- Preferred Name --\x3e\n        <div style="margin-bottom: 10px;">\n          <label style="font-size: 9px; font-weight: 500; color: #374151; display: block; margin-bottom: 4px;">What should we call you?</label>\n          <input type="text" class="mobius-mini-onb-name" placeholder="${n}" value="${n}" style="\n            width: 100%;\n            box-sizing: border-box;\n            padding: 6px 8px;\n            border: 1px solid rgba(11, 18, 32, 0.15);\n            border-radius: 6px;\n            font-size: 10px;\n            outline: none;\n          " />\n        </div>\n        \n        \x3c!-- Activities --\x3e\n        <div style="margin-bottom: 10px;">\n          <label style="font-size: 9px; font-weight: 500; color: #374151; display: block; margin-bottom: 4px;">What do you do? (select all that apply)</label>\n          <div class="mobius-mini-onb-activities" style="display: flex; flex-wrap: wrap; gap: 4px;">\n            ${o.map(n=>`\n              <label style="display: flex; align-items: center; gap: 4px; padding: 4px 8px; background: #f8fafc; border-radius: 12px; cursor: pointer; font-size: 9px; color: #374151; border: 1px solid transparent; transition: all 0.15s;">\n                <input type="checkbox" value="${n.activity_code}" style="width: 12px; height: 12px; margin: 0;" />\n                <span>${n.label}</span>\n              </label>\n            `).join("")}\n          </div>\n        </div>\n        \n        \x3c!-- AI Experience --\x3e\n        <div style="margin-bottom: 10px;">\n          <label style="font-size: 9px; font-weight: 500; color: #374151; display: block; margin-bottom: 4px;">How familiar are you with AI tools?</label>\n          <div class="mobius-mini-onb-experience" style="display: flex; flex-direction: column; gap: 4px;">\n            <label style="display: flex; align-items: center; gap: 6px; padding: 6px 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px;">\n              <input type="radio" name="ai_exp" value="beginner" style="margin: 0;" />\n              <span><strong>New to AI</strong> - I haven't used ChatGPT or similar tools</span>\n            </label>\n            <label style="display: flex; align-items: center; gap: 6px; padding: 6px 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px;">\n              <input type="radio" name="ai_exp" value="regular" checked style="margin: 0;" />\n              <span><strong>Regular user</strong> - I've used AI tools for work or personal use</span>\n            </label>\n            <label style="display: flex; align-items: center; gap: 6px; padding: 6px 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px;">\n              <input type="radio" name="ai_exp" value="power_user" style="margin: 0;" />\n              <span><strong>Power user</strong> - I use AI daily and understand its capabilities</span>\n            </label>\n          </div>\n        </div>\n        \n        \x3c!-- Autonomy - Routine Tasks --\x3e\n        <div style="margin-bottom: 10px;">\n          <label style="font-size: 9px; font-weight: 500; color: #374151; display: block; margin-bottom: 4px;">For routine tasks (like sending reminders), should Mobius:</label>\n          <div class="mobius-mini-onb-routine" style="display: flex; flex-direction: column; gap: 4px;">\n            <label style="display: flex; align-items: center; gap: 6px; padding: 6px 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px;">\n              <input type="radio" name="routine" value="automatic" style="margin: 0;" />\n              <span><strong>Act automatically</strong> - Just do it and let me know</span>\n            </label>\n            <label style="display: flex; align-items: center; gap: 6px; padding: 6px 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px;">\n              <input type="radio" name="routine" value="confirm_first" checked style="margin: 0;" />\n              <span><strong>Ask first</strong> - Show me what you'll do before doing it</span>\n            </label>\n            <label style="display: flex; align-items: center; gap: 6px; padding: 6px 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px;">\n              <input type="radio" name="routine" value="manual" style="margin: 0;" />\n              <span><strong>I'll do it</strong> - Just guide me, I'll take action myself</span>\n            </label>\n          </div>\n        </div>\n        \n        \x3c!-- Autonomy - Sensitive Tasks --\x3e\n        <div style="margin-bottom: 10px;">\n          <label style="font-size: 9px; font-weight: 500; color: #374151; display: block; margin-bottom: 4px;">For sensitive tasks (like submitting claims), should Mobius:</label>\n          <div class="mobius-mini-onb-sensitive" style="display: flex; flex-direction: column; gap: 4px;">\n            <label style="display: flex; align-items: center; gap: 6px; padding: 6px 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px;">\n              <input type="radio" name="sensitive" value="confirm_first" style="margin: 0;" />\n              <span><strong>Ask first</strong> - Always confirm before taking action</span>\n            </label>\n            <label style="display: flex; align-items: center; gap: 6px; padding: 6px 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px;">\n              <input type="radio" name="sensitive" value="manual" checked style="margin: 0;" />\n              <span><strong>I'll do it</strong> - Just prepare it, I'll submit myself</span>\n            </label>\n          </div>\n        </div>\n        \n        \x3c!-- Communication Style --\x3e\n        <div style="margin-bottom: 12px;">\n          <label style="font-size: 9px; font-weight: 500; color: #374151; display: block; margin-bottom: 4px;">How should Mobius communicate with you?</label>\n          <div class="mobius-mini-onb-tone" style="display: flex; gap: 6px;">\n            <label style="flex: 1; display: flex; flex-direction: column; align-items: center; padding: 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px; border: 2px solid transparent;" class="tone-option" data-tone="professional">\n              <input type="radio" name="tone" value="professional" checked style="margin: 0 0 4px 0;" />\n              <span style="font-weight: 500;">Professional</span>\n              <span style="color: #64748b; font-size: 8px;">Clear & formal</span>\n            </label>\n            <label style="flex: 1; display: flex; flex-direction: column; align-items: center; padding: 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px; border: 2px solid transparent;" class="tone-option" data-tone="friendly">\n              <input type="radio" name="tone" value="friendly" style="margin: 0 0 4px 0;" />\n              <span style="font-weight: 500;">Friendly</span>\n              <span style="color: #64748b; font-size: 8px;">Warm & helpful</span>\n            </label>\n            <label style="flex: 1; display: flex; flex-direction: column; align-items: center; padding: 8px; background: #f8fafc; border-radius: 6px; cursor: pointer; font-size: 9px; border: 2px solid transparent;" class="tone-option" data-tone="concise">\n              <input type="radio" name="tone" value="concise" style="margin: 0 0 4px 0;" />\n              <span style="font-weight: 500;">Concise</span>\n              <span style="color: #64748b; font-size: 8px;">Brief & direct</span>\n            </label>\n          </div>\n        </div>\n      </div>\n      \n      <div style="flex-shrink: 0; padding-top: 8px;">\n        <button class="mobius-mini-onb-submit" style="\n          width: 100%;\n          padding: 10px 12px;\n          background: #2563eb;\n          color: white;\n          border: none;\n          border-radius: 6px;\n          font-size: 10px;\n          font-weight: 500;\n          cursor: pointer;\n        ">Get Started</button>\n        <div class="mobius-mini-onb-error" style="\n          font-size: 9px;\n          color: #dc2626;\n          margin-top: 6px;\n          display: none;\n        "></div>\n        <div style="text-align: center; font-size: 8px; color: #94a3b8; margin-top: 6px;">\n          You can change these anytime in preferences\n        </div>\n      </div>\n    `;const t=c.querySelector(".mobius-mini-onb-name"),i=c.querySelector(".mobius-mini-onb-submit"),s=c.querySelector(".mobius-mini-onb-error");c.querySelectorAll(".tone-option").forEach(n=>{const e=n.querySelector('input[type="radio"]');e?.checked&&(n.style.borderColor="#2563eb",n.style.background="#eff6ff"),n.addEventListener("click",()=>{c.querySelectorAll(".tone-option").forEach(n=>{n.style.borderColor="transparent",n.style.background="#f8fafc"}),n.style.borderColor="#2563eb",n.style.background="#eff6ff"})}),c.querySelectorAll('.mobius-mini-onb-activities input[type="checkbox"]').forEach(n=>{n.addEventListener("change",()=>{const e=n.closest("label");n.checked?(e.style.borderColor="#2563eb",e.style.background="#eff6ff"):(e.style.borderColor="transparent",e.style.background="#f8fafc")})}),i?.addEventListener("click",()=>{(async()=>{const o=t?.value.trim()||n,r=[];c.querySelectorAll('.mobius-mini-onb-activities input[type="checkbox"]:checked').forEach(n=>{r.push(n.value)});const a=c.querySelector('input[name="ai_exp"]:checked')?.value||"regular",d=c.querySelector('input[name="routine"]:checked')?.value||"confirm_first",m=c.querySelector('input[name="sensitive"]:checked')?.value||"manual",b=c.querySelector('input[name="tone"]:checked')?.value||"professional";i&&(i.textContent="Setting up...",i.disabled=!0);try{const n=await fetch(`${l}/api/v1/auth/onboarding`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${e}`},body:JSON.stringify({preferred_name:o,activities:r,ai_experience_level:a,autonomy_routine_tasks:d,autonomy_sensitive_tasks:m,tone:b,greeting_enabled:!0})}),t=await n.json();if(t.ok){je(`Welcome to Mobius, ${o}!`);const n=M();Ee=await n.getCurrentUser(),_e=!0,await oo()}else s&&(s.textContent=t.error||"Failed to save preferences",s.style.display="block"),i&&(i.textContent="Get Started",i.disabled=!1)}catch(n){s&&(s.textContent="Connection error. Please try again.",s.style.display="block"),i&&(i.textContent="Get Started",i.disabled=!1)}})()})})(t,e.access_token)}else m(e.error||"Registration failed"),r&&(r.textContent="Continue",r.disabled=!1)}catch(n){m("Connection error. Please try again."),r&&(r.textContent="Continue",r.disabled=!1)}}else m("Passwords do not match");else m("Password is required");else m("Email is required");else m("First name is required")};r?.addEventListener("click",()=>{b()}),s?.addEventListener("keydown",n=>{"Enter"===n.key&&b()}),d?.addEventListener("click",n=>{n.preventDefault(),oo()})})()})}return c.style.display="",i&&(i.style.display="none"),s&&(s.style.display="none"),r&&(r.style.display="none"),a&&(a.style.display="none"),void(d&&(d.style.display="none"))}c&&(c.style.display="none"),s&&(s.style.display=""),r&&(r.style.display=""),d&&(d.style.display="");try{const n=We();console.log("[Mobius] renderMiniIfAllowed - fetching status for patientKey:",n);const e=await L(Jn,n);if(re={color:e.proceed.color||"grey",text:e.proceed.text||""},e.tasking&&(ae={color:e.tasking.color||"grey",text:e.tasking.text||"",mode:e.tasking.mode,mode_text:e.tasking.mode_text}),e.user&&(Ee={...Ee,user_id:e.user.user_id,display_name:e.user.display_name,greeting_name:e.user.greeting_name,is_onboarded:e.user.is_onboarded}),e.personalization){if(ze=e.personalization,i&&ze.greeting&&!Me){const n=i.querySelector(".mobius-mini-greeting-text");n&&(n.textContent=ze.greeting),i.style.display=""}}else if(Ee&&!Me){const n=Ee.display_name||Ee.email?.split("@")[0]||"there",e=i?.querySelector(".mobius-mini-greeting-text");e&&(e.textContent=`Hello, ${n}`),i&&(i.style.display="")}if(me=e.needs_attention?{color:e.needs_attention.color||"grey",problemStatement:e.needs_attention.problem_statement||null,userStatus:e.needs_attention.user_status||null}:{color:e.proceed.color||"grey",problemStatement:e.proceed.text||null,userStatus:null},be=e.task_count||0,ue=e.resolution_plan||null,pe=e.actions_for_user||0,null!==e.agentic_confidence&&void 0!==e.agentic_confidence){const n=e.agentic_confidence;ge=n>1?n/100:n,console.log("[Mobius] agentic_confidence conversion - received:",n,"converted to:",ge)}else ge=null;if(fe=e.recommended_mode??null,xe=e.recommendation_reason??null,he=e.agentic_actions??null,console.log("[Mobius] Recommendation state after fetch:",{agenticConfidence:ge,recommendedMode:fe,hasProblem:!!me.problemStatement,problemStatement:me.problemStatement}),e.patient?.found&&e.patient.display_name){const n=t.querySelector(".mobius-mini-patient-name"),o=t.querySelector(".mobius-mini-patient-id");n&&(n.textContent=e.patient.display_name),o&&e.patient.id_masked&&(o.textContent=`ID ${e.patient.id_masked}`);const i=t.querySelector(".mobius-mini-minimized-patient");i&&(i.textContent=e.patient.display_name)}}catch{}let m=me.color;if("resolved"!==me.userStatus&&"unresolved"!==me.userStatus||(m="purple"),r){const n=r.querySelector(".mobius-mini-dot"),e=r.querySelector(".mobius-mini-problem-text"),o=r.querySelector(".mobius-mini-badge-text"),t=r.querySelector(".mobius-mini-status-badge");n&&(n.className=`mobius-mini-dot ${Oe(m)}`),e&&(e.textContent=me.problemStatement||"No issues detected"),o&&t&&("resolved"===me.userStatus?(o.textContent="Resolved",t.className="mobius-mini-status-badge status-resolved"):"unresolved"===me.userStatus?(o.textContent="Unresolved",t.className="mobius-mini-status-badge status-unresolved"):(o.textContent="Set status",t.className="mobius-mini-status-badge"))}const b=t.querySelector(".mobius-mini-minimized-info");if(b){const n=b.querySelector(".mobius-mini-dot");n&&(n.className=`mobius-mini-dot ${Oe(m)}`)}Ce(),Se(),t.querySelectorAll(".mobius-mini-row"),ce||(ce?console.log("[Mobius] Patient context detector already initialized"):(ce=new Hn({debounceMs:500,strategies:["dataAttributes","url","domText"],observeMutations:!0,autoStart:!1}),ce.on("patientDetected",n=>{n&&Xe(n)}),ce.on("patientChanged",n=>{n&&Xe(n)}),ce.on("patientCleared",()=>{Xe(null)}),ce.on("detectionError",()=>{console.warn("[Mobius] Patient detection error")}),async function(n){const e=new URL(`${A}/context/config`);e.searchParams.set("domain",n);try{const n=await fetch(e.toString(),{method:"GET"});if(!n.ok){const e=await n.json();throw new Error(e.error||"Failed to fetch detection config")}const o=await n.json();return o.has_config?o.patterns:null}catch(n){return console.error("[API] Error fetching detection config:",n),null}}(window.location.hostname).then(n=>{n&&ce&&(console.log("[Mobius] Applying tenant detection config:",n),ce.updatePatterns(n))}),console.log("[Mobius] Patient context detector initialized"))),ce&&!ce.isActive()&&(ce.start(),console.log("[Mobius] Patient context detection started")),Wn(t)}console.log("[Mobius OS] Content script loaded. URL:",window.location.href),chrome.runtime.onMessage.addListener((n,e,o)=>{const t=n&&n.type;if(t)return(async()=>{try{if("mobius:setDomainAllowed"===t)return await De(String(n.hostname||""),Boolean(n.allowed)),Boolean(n.allowed)||He(),await oo(),void o({ok:!0});if("mobius:expand"===t)return await Ve(),void o({ok:!0});if("mobius:collapse"===t)return await eo(),void o({ok:!0});if("mobius:refreshMini"===t)return await oo(),void o({ok:!0});o({ok:!1,error:"unknown_message"})}catch(n){const e=n instanceof Error?n.message:String(n);o({ok:!1,error:e})}})(),!0}),(async()=>{Jn=await y(),await ke(),await oo()})()})();